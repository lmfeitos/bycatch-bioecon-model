---
title: "simulation-plots"
author: "Leonardo Feitosa"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
library(tidyverse)
library(here)
library(patchwork)
library(gt)
library(paletteer)
library(gridExtra)
library(janitor)
library(plotly)
library(ggthemes)
# file path
basedir <- "G:/Meu Drive/PhD Project - Fisheries bycatch/Bycatch project/Chapter 1/analyses/"
outdir <- file.path(basedir, "model_outs") # calls present data from raster files
```

```{r, include = FALSE}
# Results from the parameter per parameter simulations

output_s_ranges_w_one <- read_csv(file.path(outdir, "output_s_ranges_w_one.csv"))

#output_s_ranges_w_ranges2 <- read_csv(file.path(outdir, "output_s_ranges_w_ranges2.csv"))

output_w_ranges_s_one <- read_csv(file.path(outdir, "output_w_ranges_s_one.csv"))

output_msy1 <- read_csv(file.path(outdir, "output_msy1.csv"))

output_msy2 <- read_csv(file.path(outdir, "output_msy2.csv"))

output_subs1 <- read_csv(file.path(outdir, "output_sub1.csv"))

output_subs2 <- read_csv(file.path(outdir, "output_sub2.csv"))
#output_full <- read_csv(file.path(outdir, "output_full.csv"))
```

```{r, echo = FALSE}
# read in the output from the test with prices varying as a function of catch

## pw as a function of catch
# output_fcn_test_pw <- read_csv(file.path(outdir, "output_w_fcn.csv"))
# 
# ## ps as a function of catch
# output_fcn_test_ps <- read_csv(file.path(outdir, "output_s_fcn.csv"))
```


```{r data wrangling, echo = FALSE}
# wrangling dataset with outputs from the test with weak stock price as a function of catch
# output_fcn_test_pw_proc <- output_fcn_test_pw %>% 
#   mutate(b_v_k_s = N_s / k_s,
#          b_v_k_w = N_w / k_w,
#          b_v_k_s2 = N_s2 / k_s,
#          b_v_k_w2 = N_w2 / k_w) %>% 
#   mutate(vuln_ratio_w = (q_w/r_w) / (q_s/r_s)) %>% 
#   mutate(vuln_ratio_s = (q_s/r_s) / (q_w/r_w)) %>% 
#   mutate(vuln_ratio_w = round(vuln_ratio_w, 5),
#          vuln_ratio_s = round(vuln_ratio_s, 5)) %>% 
#   mutate(st_stock_rev = (p_s * q_s * k_s) / c) %>% 
#   mutate(w_stock_rev = (p_w * q_w * k_w) / c)

# wrangling dataset with outputs from the test with strong stock price as a function of catch
s_w_range_proc <- output_s_ranges_w_one %>% 
  mutate(b_v_k_s = N_s / k_s,
         b_v_k_w = N_w / k_w) %>% 
  mutate(vuln_ratio_w = (q_w/r_w) / (q_s/r_s)) %>% 
  mutate(vuln_ratio_s = (q_s/r_s) / (q_w/r_w)) %>% 
  mutate(vuln_ratio_w = round(vuln_ratio_w, 5),
         vuln_ratio_s = round(vuln_ratio_s, 5)) %>% 
  mutate(st_stock_rev = (p_s * q_s * k_s) / c) %>% 
  mutate(w_stock_rev = (p_w * q_w * k_w) / c) %>% 
  mutate(log_bvkw = log1p(b_v_k_w)) %>% 
  mutate(c = as.factor(c))


# wrangling dataset with outputs from the test with strong stock price as a function of catch
w_s_range_proc <- output_w_ranges_s_one %>% 
  mutate(b_v_k_s = N_s / k_s,
         b_v_k_w = N_w / k_w) %>% 
  mutate(vuln_ratio_w = (q_w/r_w) / (q_s/r_s)) %>% 
  mutate(vuln_ratio_s = (q_s/r_s) / (q_w/r_w)) %>% 
  mutate(vuln_ratio_w = round(vuln_ratio_w, 5),
         vuln_ratio_s = round(vuln_ratio_s, 5)) %>% 
  mutate(st_stock_rev = (p_s * q_s * k_s) / c) %>% 
  mutate(w_stock_rev = (p_w * q_w * k_w) / c) %>% 
  mutate(log_bvkw = log1p(b_v_k_w))

# wrangling dataset with outputs from the test with prices constant (strong stock price varying) and strong stock managed to MSY
output_msy1_proc <- output_msy1 %>% 
  mutate(b_v_k_s = N_s / k_s,
         b_v_k_w = N_w / k_w) %>%  
  mutate(vuln_ratio_w = (q_w/r_w) / (q_s/r_s)) %>% 
  mutate(vuln_ratio_s = (q_s/r_s) / (q_w/r_w)) %>% 
  mutate(vuln_ratio_w = round(vuln_ratio_w, 5),
         vuln_ratio_s = round(vuln_ratio_s, 5)) %>% 
  mutate(st_stock_rev = (p_s * q_s * k_s) / c) %>% 
  mutate(w_stock_rev = (p_w * q_w * k_w) / c)

# wrangling dataset with outputs from the test with prices constant (weak stock price varying) and strong stock managed to MSY
output_msy2_proc <- output_msy2 %>% 
   mutate(b_v_k_s = N_s / k_s,
         b_v_k_w = N_w / k_w) %>%  
  mutate(vuln_ratio_w = (q_w/r_w) / (q_s/r_s)) %>% 
  mutate(vuln_ratio_s = (q_s/r_s) / (q_w/r_w)) %>% 
  mutate(vuln_ratio_w = round(vuln_ratio_w, 5),
         vuln_ratio_s = round(vuln_ratio_s, 5)) %>% 
  mutate(st_stock_rev = (p_s * q_s * k_s) / c) %>% 
  mutate(w_stock_rev = (p_w * q_w * k_w) / c)


# wrangling dataset with outputs from the test with prices constant (strong stock price varying) and cost varying (subsidies)
output_subs1_proc <- output_subs1 %>%  
   mutate(b_v_k_s = N_s / k_s,
         b_v_k_w = N_w / k_w) %>%  
  mutate(vuln_ratio_w = (q_w/r_w) / (q_s/r_s)) %>% 
  mutate(vuln_ratio_s = (q_s/r_s) / (q_w/r_w)) %>% 
  mutate(vuln_ratio_w = round(vuln_ratio_w, 5),
         vuln_ratio_s = round(vuln_ratio_s, 5)) %>% 
  mutate(st_stock_rev = (p_s * q_s * k_s) / c) %>% 
  mutate(w_stock_rev = (p_w * q_w * k_w) / c) %>% 
  mutate(log_b_v_k_w = log1p(b_v_k_w)) %>% 
  mutate(log_b_v_k_w = round(log_b_v_k_w, 3)) %>% 
  mutate(c = as.factor(c))

# wrangling dataset with outputs from the test with prices constant (strong stock price varying) and cost varying (subsidies)
output_subs2_proc <- output_subs2 %>%  
   mutate(b_v_k_s = N_s / k_s,
         b_v_k_w = N_w / k_w) %>%  
  mutate(vuln_ratio_w = (q_w/r_w) / (q_s/r_s)) %>% 
  mutate(vuln_ratio_s = (q_s/r_s) / (q_w/r_w)) %>% 
  mutate(vuln_ratio_w = round(vuln_ratio_w, 5),
         vuln_ratio_s = round(vuln_ratio_s, 5)) %>% 
  mutate(st_stock_rev = (p_s * q_s * k_s) / c) %>% 
  mutate(w_stock_rev = (p_w * q_w * k_w) / c) %>% 
  mutate(log_b_v_k_w = log1p(b_v_k_w)) %>% 
  mutate(log_b_v_k_w = round(log_b_v_k_w, 3)) %>% 
  mutate(c = as.factor(c))
```


# Results from the parameter per parameter simulation


## Model equations:

- Strong stock size ($N_s$)

$$
\frac{dN_s}{N_wdt} = r_s (1 - \frac{N_s}{K_s}) - q_s E
$$

- Weak stock size ($N_w$):

$$
\frac{dN_w}{N_wdt} = r_w (1 - \frac{N_w}{K_w}) - q_w E
$$

- Effort ($E$):

$$
\frac{dE}{Edt} = (p_s q_s N_s + p_w q_w N_w) - C
$$

## Equilibrium points for the three variables:

- Strong stock ($N_s$):

$$
N_s = \frac{K_s * (c * q_s * r_w + K_w * p_w * q_w * (q_w * r_s - q_s * r_w))} {(K_w * p_w * q_w^2 * r_s + K_s * p_s * q_s^2 * r_w)}
$$

- Weak stock ($N_w$):

$$
N_w = \frac{K_w * (c * q_w * r_s + K_s * p_s * q_s * (- q_w * r_s + q_s * r_w))} {(K_w * p_w * q_w^2 * r_s + K_s * p_s * q_s^2 * r_w)}
$$

- Effort ($E$):

$$
E = \frac{(-c + K_s * p_s * q_s + K_w * p_w * q_w) * r_s * r_w} {K_w * p_w * q_w^2 r_s + K_s * p_s * q_s^2 * r_w}
$$

### List of parameters:
- K = carrying capacity
- r = per capita growth rate
- q = catchability of stocks
- c = cost of fishing
- p = price

### Parameter space for both species:

- Catchability (q) varies from 0.1 to 0.5 at intervals of 0.2 for both species.
- Growth rate (r) varies from 0.35 to 1.05 at intervals of 0.35 for the strong stock and from 0.1 to 0.3 at intervals of 0.1 for the weak stock.
- Carrying capacity (k) varies from 3 to 5 at intervals of 1 for the strong stock and from 1 to 3 at intervals of 1 for the weak stock.
- Price ranges (p) from 0.1 to 10 at intervals of 0.5 for both species.





### First test plot with weak stock having zero price

```{r}
s_w_range_proc_test <-
  s_w_range_proc %>% 
           filter(p_w == 1 & st_stock_rev <= 8 & vuln_ratio_w <= 4) %>% 
  distinct_all()
```

```{r, echo = FALSE}
col_limit <- c(0, 0.63)



s_w_range_proc_plot <-
  ggplot(data = s_w_range_proc %>% 
           filter(p_w < 1 & st_stock_rev <= 8 & vuln_ratio_w <= 4) %>% 
           distinct_all()) +
  geom_tile(aes(x = vuln_ratio_w, y = st_stock_rev, fill = b_v_k_w, width = .04)) +
  scale_fill_paletteer_c("grDevices::Blues 3",
                          #rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.6, 0.1),
                         direction = -1,
                         limits = col_limit) +
   scale_x_continuous(breaks = seq(1, 4, 0.5),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(1, 8, 1),
                     expand = c(0,0)) +
  labs(x = "",
       y = "Strong stock economic potential",
       fill = "Weak stock depletion (B/K)",
       title = "Weak stock price = 0") +
#  coord_equal() +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))

s_w_range_proc_plot2 <-
  ggplot(data = s_w_range_proc %>% 
           filter(p_w == 1 & st_stock_rev <= 8 & vuln_ratio_w <= 4) %>% 
           distinct_all()) +
  geom_tile(aes(x = vuln_ratio_w, y = st_stock_rev, fill = b_v_k_w, width = .04)) +
  scale_fill_paletteer_c("grDevices::Blues 3",
                         # rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.6, 0.1),
                         direction = -1,
                         limits = col_limit) +
  scale_x_continuous(breaks = seq(1, 4, 0.5),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(1, 8, 1),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "Weak stock depletion (B/K)",
       title = "Weak stock price = 1") +
  #coord_equal() +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


w_s_range_proc_plot1 <-
  ggplot(data = w_s_range_proc %>%
           filter(p_s == 1 & vuln_ratio_w <= 4) %>% 
           distinct_all()) + 
  geom_tile(aes(x = vuln_ratio_w, y = w_stock_rev, fill = b_v_k_w, width = .04)) +
  scale_fill_paletteer_c("grDevices::Blues 3",
                         # rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.6, 0.1),
                         direction = -1,
                         limits = col_limit) +
  scale_x_continuous(breaks = seq(0, 4, 0.5),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 8, 1),
                     expand = c(0,0)) +
  labs(x = "",
       y = "Weak stock economic potential",
       fill = "Weak stock depletion (B/K)",
       title = "Strong stock price = 1") +
#  coord_equal() +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))
  
w_s_range_proc_plot2 <- 
  ggplot(data = w_s_range_proc %>% 
           filter(p_s == 2 & vuln_ratio_w <= 4) %>% 
           distinct_all()) + 
  geom_tile(aes(x = vuln_ratio_w, y = w_stock_rev, fill = b_v_k_w, width = .04)) +
  scale_fill_paletteer_c("grDevices::Blues 3",
                         # rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.6, 0.1),
                         direction = -1,
                         limits = col_limit) +
  scale_x_continuous(breaks = seq(0, 4, 0.5),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 8, 1),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "Weak stock depletion (B/K)",
       title = "Strong stock price = 2") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))

```

### Vulnerability ratios vs revenue stream with prices as constants
- in the top plots, $p_w$ = 1
- in the bottom plots, $p_s$ = 1

```{r, fig.height=8, fig.width=12, echo = FALSE}
range_plot_1 <- 
  (s_w_range_proc_plot +
  s_w_range_proc_plot2)  

range_plot_2 <-
  (w_s_range_proc_plot1 +
  w_s_range_proc_plot2) 

plot_1 <- grid.arrange(patchworkGrob(range_plot_1 /
                                       range_plot_2 +
  plot_annotation(tag_levels = "A") +
    plot_layout(guides = "collect")),
  bottom = "Vulnerability ratios\n(Vw/Vs)")
  
 # ggsave(file.path(outdir, "plot_1.png"), plot = plot_1,
 #       width = 12, height = 8, bg = "white", dpi = 300)
```

```{r, echo = FALSE}
s_w_range_proc_plot <-
  ggplot(data = s_w_range_proc %>% 
           filter(p_w < 1 & st_stock_rev <= 5 & vuln_ratio_w <= 4)) +
  geom_tile(aes(x = vuln_ratio_w, y = st_stock_rev, fill = log1p(b_v_k_w), width = .1)) +
  scale_fill_paletteer_c("viridis::viridis",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.5, 0.1)) +
  scale_x_continuous(breaks = seq(1, 4, 0.5),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(1, 5, 0.5),
                     expand = c(0,0)) +
  labs(x = "",
       y = "Strong stock revenue stream",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


s_w_range_proc_plot2 <-
  ggplot(data = s_w_range_proc %>% 
           filter(p_w == 1 & st_stock_rev <= 5 & vuln_ratio_w <= 4)) +
  geom_tile(aes(x = vuln_ratio_w, y = st_stock_rev, fill = log1p(b_v_k_w), width = .1)) +
  scale_fill_paletteer_c("viridis::viridis",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.35, 0.1)) +
  scale_x_continuous(breaks = seq(1, 4, 0.5),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(1, 5, 0.5),
                     expand = c(0,0)) +
  labs(x = "",
       y = "Strong stock revenue stream",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


w_s_range_proc_plot1 <-
  ggplot(data = w_s_range_proc %>%
           filter(p_s == 1 & vuln_ratio_w <= 4)) + 
  geom_tile(aes(x = vuln_ratio_w, y = w_stock_rev, fill = log1p(b_v_k_w), width = .1)) +
  scale_fill_paletteer_c("viridis::viridis",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.4, 0.1)) +
  scale_x_continuous(breaks = seq(0, 4, 0.5),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 8, 1),
                     expand = c(0,0)) +
  labs(x = "Vw/Vs",
       y = "Weak stock revenue stream",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))
  
w_s_range_proc_plot2 <- 
  ggplot(data = w_s_range_proc %>% 
           filter(p_s == 2 & vuln_ratio_w <= 4)) + 
  geom_tile(aes(x = vuln_ratio_w, y = w_stock_rev, fill = log1p(b_v_k_w), width = .1)) +
  scale_fill_paletteer_c("viridis::viridis",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.25, 0.05)) +
  scale_x_continuous(breaks = seq(0, 4, 0.5),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 8, 1),
                     expand = c(0,0)) +
  labs(x = "Vw/Vs",
       y = "Weak stock revenue stream",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))
```



### Vulnerability ratios vs revenue stream with prices as constants
- in the top plots, $p_w$ = 1
- in the bottom plots, $p_s$ = 1

```{r, fig.height=10, fig.width=10, echo = FALSE}
range_plot_1 <- 
  (s_w_range_proc_plot +
  s_w_range_proc_plot2)  

range_plot_2 <-
  (w_s_range_proc_plot1 +
  w_s_range_proc_plot2) 

plot_1 <-
  range_plot_1 / 
  range_plot_2 +
  plot_annotation(tag_levels = "A")

plot_1

# ggsave(file.path(outdir, "plot_1.png"),
#        width = 12, height = 8, bg = "white", dpi = 300)
```

```{r, echo = FALSE}
s_w_range_proc %>% 
  mutate(extinct = case_when(
    b_v_k_w == 0 ~ "yes",
    b_v_k_w > 0 ~ "no",
  )) %>% 
  filter(p_w == 1) %>% 
  group_by(extinct) %>% 
  count() %>% 
  ungroup() %>% 
  mutate(prop = n * 100/ sum(n)) %>% 
  mutate(sum = sum(prop))

w_s_range_proc %>% 
  mutate(extinct = case_when(
    b_v_k_w == 0 ~ "yes",
    b_v_k_w > 0 ~ "no",
  )) %>% 
  filter(p_s == 2) %>% 
  group_by(extinct) %>% 
  count() %>% 
  ungroup() %>% 
  mutate(prop = n * 100/ sum(n)) %>% 
  mutate(sum = sum(prop))
```


### Tests for management at MSY for the strong stock

```{r, echo = FALSE}
# msy1_s_proc_plot <-
#   ggplot(data = output_msy1_proc %>% 
#            filter(p_w < 1)) +
#   geom_tile(aes(x = vuln_ratio_w, y = st_stock_rev, fill = log1p(b_v_k_w), width = .1)) +
#   scale_fill_paletteer_c("viridis::viridis",
#                           rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
#                          breaks = seq(0, 0.5, 0.1)) +
#   facet_wrap(~ c,)
#   scale_x_continuous(expand = c(0,0)) +
#   scale_y_continuous(expand = c(0,0)) +
#   labs(x = "Vw/Vs",
#        y = "Strong stock revenue stream",
#        fill = "log(B/K)") +
#   theme_bw() +
#   theme(panel.grid.major = element_blank(),
#         panel.grid.minor = element_blank(),
#         axis.title = element_text(size = 12, color = "black"),
#         axis.text = element_text(size = 10, color = "black"),
#         strip.background = element_rect(fill = "transparent"),
#         panel.spacing = unit(3, "mm"))
# 
# 
# msy1_s_proc_plot2 <-
#   ggplot(data = output_msy1_proc %>% 
#            filter(p_w == 1)) +
#   geom_tile(aes(x = vuln_ratio_w, y = st_stock_rev, fill = log1p(b_v_k_w), width = .1)) +
#   scale_fill_paletteer_c("viridis::viridis",
#                           rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
#                          breaks = seq(0, 0.35, 0.1)) +
#   scale_x_continuous(expand = c(0,0)) +
#   scale_y_continuous(expand = c(0,0)) +
#   labs(x = "Vw/Vs",
#        y = "Strong stock revenue stream",
#        fill = "log(B/K)") +
#   theme_bw() +
#   theme(panel.grid.major = element_blank(),
#         panel.grid.minor = element_blank(),
#         axis.title = element_text(size = 12, color = "black"),
#         axis.text = element_text(size = 10, color = "black"),
#         strip.background = element_rect(fill = "transparent"),
#         panel.spacing = unit(3, "mm"))
# 
# 
# msy2_w_proc_plot1 <-
#   ggplot(data = output_msy2_proc %>%
#            filter(p_s == 1)) + 
#   geom_tile(aes(x = vuln_ratio_w, y = w_stock_rev, fill = log1p(b_v_k_w), width = .1)) +
#   scale_fill_paletteer_c("viridis::viridis",
#                           rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
#                          breaks = seq(0, 0.4, 0.1)) +
#   scale_x_continuous(expand = c(0,0)) +
#   scale_y_continuous(expand = c(0,0)) +
#   labs(x = "Vw/Vs",
#        y = "Weak stock revenue stream",
#        fill = "log(B/K)") +
#   theme_bw() +
#   theme(panel.grid.major = element_blank(),
#         panel.grid.minor = element_blank(),
#         axis.title = element_text(size = 12, color = "black"),
#         axis.text = element_text(size = 10, color = "black"),
#         strip.background = element_rect(fill = "transparent"),
#         panel.spacing = unit(3, "mm"))
#   
# msy2_w_proc_plot2 <- 
#   ggplot(data = output_msy2_proc %>% 
#            filter(p_s == 2)) + 
#   geom_tile(aes(x = vuln_ratio_w, y = w_stock_rev, fill = log1p(b_v_k_w), width = .1)) +
#   scale_fill_paletteer_c("viridis::viridis",
#                           rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
#                          breaks = seq(0, 0.25, 0.05)) +
#   scale_x_continuous(expand = c(0,0)) +
#   scale_y_continuous(expand = c(0,0)) +
#   labs(x = "Vw/Vs",
#        y = "Weak stock revenue stream",
#        fill = "log(B/K)") +
#   theme_bw() +
#   theme(panel.grid.major = element_blank(),
#         panel.grid.minor = element_blank(),
#         axis.title = element_text(size = 12, color = "black"),
#         axis.text = element_text(size = 10, color = "black"),
#         strip.background = element_rect(fill = "transparent"),
#         panel.spacing = unit(3, "mm"))
```


```{r, echo = FALSE, fig.height=8, fig.width=8}
# msy_plot_1 <- 
#   (msy1_s_proc_plot +
#   msy1_s_proc_plot2)  
# 
# msy_plot_2 <-
#   (msy2_w_proc_plot1 +
#   msy2_w_proc_plot2) 
# 
# msy_gather <-
#   msy_plot_1 / 
#   msy_plot_2 +
#   plot_annotation(tag_levels = "A")
# 
# msy_gather
```


## Fisheries subsidy analyses

```{r plot first scenario of fishery subsidies where the strong stock price increases and weak stock price remains constabt, echo = FALSE, include = FALSE}
# Create facet labels
sub1_label1 <- c("-10%")
names(sub1_label1) <- c("0.045")

sub1_label2 <- c("-25%")
names(sub1_label2) <- c("0.0375")

sub1_label3 <- c("-50%")
names(sub1_label3) <- c("0.025")

no_sub <- c("0%")
names(no_sub) <- c("0.05")


# Create series of plots for pw = 0.1
subs1_s_proc_plot0 <-
  ggplot(data = s_w_range_proc %>% 
           filter(p_w == 1)) +
  geom_tile(aes(x = vuln_ratio_w, y = st_stock_rev, fill = log1p(b_v_k_w), width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.35, 0.1),
                         direction = -1) +
  facet_wrap(~ c,
             labeller = labeller(c = no_sub)) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 16, 4),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))

subs1_s_proc_plot1 <-
  ggplot(data = output_subs1_proc %>% 
           filter(p_w == 1 & c == 0.045)) +
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(st_stock_rev, 8), fill = log_b_v_k_w, height = 1, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.4, 0.1),
                         direction = -1) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label1)) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 16, 4),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


subs1_s_proc_plot2 <-
  ggplot(data = output_subs1_proc %>% 
           filter(p_w == 1 & c == 0.0375 & st_stock_rev <= 20)) + 
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(st_stock_rev, 8), fill = log_b_v_k_w, height = 1.2, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.3, 0.1),
                         direction = -1) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label2)) +
  scale_x_continuous(breaks = seq(1, 10, 3),
                     expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))

subs1_s_proc_plot3 <-
  ggplot(data = output_subs1_proc %>% 
           filter(p_w == 1 & c == 0.025 & st_stock_rev <= 20)) + 
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(st_stock_rev, 8), fill = log_b_v_k_w, height = 1.6, width = .1)) +
  scale_fill_gradient2(breaks = seq(0, 0.2, 0.05),
                         low = "#2A5783FF", 
                         mid = "#FCFEFBFF",
                         high = "#408749FF",
                         midpoint = 0.1,
                         limits = col_limit) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label3)) +
  scale_x_continuous(breaks = seq(1, 10, 3),
                     expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


# Create plots for a smaller range of Vw/Vs
subs1_s_proc_plot0.1 <-
  ggplot(data = s_w_range_proc %>% 
           filter(p_w == 1 & vuln_ratio_w <= 4 & st_stock_rev <= 12)) +
  geom_tile(aes(x = vuln_ratio_w, y = st_stock_rev, fill = log1p(b_v_k_w), width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.55, 0.1),
                         direction = -1,
                         limits = col_limit) +
  facet_wrap(~ c,
             labeller = labeller(c = no_sub)) +
  scale_x_continuous(breaks = seq(1, 4, 1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 12, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))

subs1_s_proc_plot1.1 <-
  ggplot(data = output_subs1_proc %>% 
           filter(p_w == 1 & c == 0.045 & vuln_ratio_w <= 4 & st_stock_rev <= 12)) +
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(st_stock_rev, 8), fill = log_b_v_k_w, height = 1, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.55, 0.1),
                         direction = -1,
                         limits = col_limit) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label1)) +
  scale_x_continuous(breaks = seq(1, 4, 1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 12, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


subs1_s_proc_plot2.1 <-
  ggplot(data = output_subs1_proc %>% 
           filter(p_w == 1 & c == 0.0375 & st_stock_rev <= 12 & vuln_ratio_w <= 4)) + 
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(st_stock_rev, 8), fill = log_b_v_k_w, height = 1.2, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.55, 0.1),
                         direction = -1,
                         limits = col_limit) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label2)) +
  scale_x_continuous(breaks = seq(1, 4, 1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 12, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))

subs1_s_proc_plot3.1 <-
  ggplot(data = output_subs1_proc %>% 
           filter(p_w == 1 & c == 0.025 & st_stock_rev <= 12 & vuln_ratio_w <= 4)) + 
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(st_stock_rev, 8), fill = log_b_v_k_w, height = 1.6, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.55, 0.1),
                         direction = -1,
                         limits = col_limit) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label3)) +
  scale_x_continuous(breaks = seq(1, 4, 1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 12, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))

```

- 0.045 = 10% subsidy
- 0.0375 = 25% subsidy
- 0.025 = 50% subsidy

```{r, echo = FALSE, include = FALSE}
output_subs1_proc %>% 
  mutate(extinct = case_when(
    b_v_k_w == 0 ~ "yes",
    b_v_k_w > 0 ~ "no",
  )) %>% 
  filter(p_w == 1 & c == 0.025) %>% 
  group_by(extinct) %>% 
  count() %>% 
  ungroup() %>%  
  mutate(prop = prop.table(n)) %>% 
  mutate(sum = sum(prop))

output_subs1_proc %>% 
  mutate(extinct = case_when(
    b_v_k_w == 0 ~ "yes",
    b_v_k_w > 0 ~ "no",
  )) %>% 
  filter(p_w == 1 & c == 0.0375) %>% 
  group_by(extinct) %>% 
  count() %>% 
  ungroup() %>%  
  mutate(prop = prop.table(n)) %>% 
  mutate(sum = sum(prop))

output_subs1_proc %>% 
  mutate(extinct = case_when(
    b_v_k_w == 0 ~ "yes",
    b_v_k_w > 0 ~ "no",
  )) %>% 
  filter(p_w == 1 & c == 0.045) %>% 
  group_by(extinct) %>% 
  count() %>% 
  ungroup() %>%  
  mutate(prop = prop.table(n)) %>% 
  mutate(sum = sum(prop))
```


```{r, echo = FALSE, fig.height=7, fig.width=8, include = FALSE}
# Gather all plots for pw = 1 
sub1 <- grid.arrange(patchworkGrob(subs1_s_proc_plot0 /
                                     subs1_s_proc_plot1 / 
                                     subs1_s_proc_plot2 /
                                     subs1_s_proc_plot3 +
  plot_layout(ncol = 2)),
  left = "Strong stock revenue stream",
  bottom = "Vw/Vs")  

# ggsave(file.path(outdir, "subsidy_ps1.png"), plot = sub1,
#     width = 6, height = 7, bg = "white", dpi = 300)
```

```{r, include = FALSE}
sub1.1 <- grid.arrange(patchworkGrob(subs1_s_proc_plot0.1 /
                                     subs1_s_proc_plot1.1 /
                                     subs1_s_proc_plot2.1 /
                                     subs1_s_proc_plot3.1 +
  plot_layout(guides = "collect",
                ncol = 2)),
  left = "Strong stock revenue stream",
  bottom = "Vw/Vs")  

# ggsave(file.path(outdir, "subsidy_ps1.1.png"), plot = sub1.1,
#     width = 6, height = 7, bg = "white", dpi = 300)
```


```{r, echo = FALSE, include = FALSE}
# Create series of plots for pw = 0.1 with full range of vulnerabilities
subs2_s_proc_plot0 <-
  ggplot(data = s_w_range_proc %>% 
           filter(p_w < 1)) +
  geom_tile(aes(x = vuln_ratio_w, y = st_stock_rev, fill = log1p(b_v_k_w), width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         #breaks = seq(0, 0.35, 0.1),
                         direction = -1) +
  facet_wrap(~ c,
             labeller = labeller(c = no_sub)) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


subs2_s_proc_plot1 <-
  ggplot(data = output_subs1_proc %>% 
           filter(p_w < 1 & c == 0.045)) +
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(st_stock_rev, 8), fill = log_b_v_k_w, height = 1, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.4, 0.1),
                         direction = -1) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label1)) +
  scale_x_continuous(breaks = seq(1, 10, 3),
                     expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


subs2_s_proc_plot2 <-
  ggplot(data = output_subs1_proc %>% 
           filter(p_w < 1 & c == 0.0375 & st_stock_rev <= 20)) + 
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(st_stock_rev, 8), fill = log_b_v_k_w, height = 1.2, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.3, 0.1),
                         direction = -1) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label2)) +
  scale_x_continuous(breaks = seq(1, 10, 3),
                     expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))

subs2_s_proc_plot3 <-
  ggplot(data = output_subs1_proc %>% 
           filter(p_w < 1 & c == 0.025 & st_stock_rev <= 20)) + 
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(st_stock_rev, 8), fill = log_b_v_k_w, height = 1.6, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.2, 0.05),
                         direction = -1) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label3)) +
  scale_x_continuous(breaks = seq(1, 10, 3),
                     expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))

# Create series of plots for pw = 0.1 with vulnerabilities ranging from 1 to 4
subs2_s_proc_plot0.1 <-
  ggplot(data = s_w_range_proc %>% 
           filter(p_w < 1 & vuln_ratio_w <= 4 & st_stock_rev <= 12)) +
  geom_tile(aes(x = vuln_ratio_w, y = st_stock_rev, fill = log1p(b_v_k_w), width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.55, 0.1),
                         direction = -1,
                         limits = col_limit) +
  facet_wrap(~ c,
             labeller = labeller(c = no_sub)) +
  scale_x_continuous(breaks = seq(1, 4, 1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 12, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


subs2_s_proc_plot1.1 <-
  ggplot(data = output_subs1_proc %>% 
           filter(p_w < 1 & c == 0.045 & vuln_ratio_w <= 4 & st_stock_rev <= 12)) +
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(st_stock_rev, 8), fill = log_b_v_k_w, height = 1, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.55, 0.1),
                         direction = -1,
                         limits = col_limit) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label1)) +
  scale_x_continuous(breaks = seq(1, 4, 1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 12, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


subs2_s_proc_plot2.1 <-
  ggplot(data = output_subs1_proc %>% 
           filter(p_w < 1 & c == 0.0375 & vuln_ratio_w <= 4 & st_stock_rev <= 12)) + 
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(st_stock_rev, 8), fill = log_b_v_k_w, height = 1.2, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.55, 0.1),
                         direction = -1,
                         limits = col_limit) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label2)) +
  scale_x_continuous(breaks = seq(1, 4, 1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 12, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))

subs2_s_proc_plot3.1 <-
  ggplot(data = output_subs1_proc %>% 
           filter(p_w < 1 & c == 0.025 & st_stock_rev <= 12 & vuln_ratio_w <= 4)) + 
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(st_stock_rev, 8), fill = log_b_v_k_w, height = 1.6, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.55, 0.1),
                         direction = -1,
                         limits = col_limit) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label3)) +
  scale_x_continuous(breaks = seq(1, 4, 1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 12, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))

```

```{r, echo = FALSE, fig.height=7, fig.width=7, include = FALSE}
# Gather all plots for pw = 0.1 
sub2 <- grid.arrange(patchworkGrob(subs2_s_proc_plot0 / 
                                     subs2_s_proc_plot1 / 
                                     subs2_s_proc_plot2 /
                                     subs2_s_proc_plot3 +
  plot_layout(ncol = 2)),
  left = "Strong stock revenue stream",
  bottom = "Vw/Vs")  

#ggsave(file.path(outdir, "subsidy_ps2.png"), plot =  sub2,
#       width = 6, height = 7, bg = "white", dpi = 300)
```

```{r, echo = FALSE, include = FALSE}
# Gather all plots for pw = 0.1 with vulnerabiliy range subset
sub2.1 <- grid.arrange(patchworkGrob(subs2_s_proc_plot0.1 / 
                                     subs2_s_proc_plot1.1 / 
                                     subs2_s_proc_plot2.1 /
                                     subs2_s_proc_plot3.1 +
  plot_layout(ncol = 2,
              guides = "collect")),
  left = "Strong stock revenue stream",
  bottom = "Vw/Vs")  

 # ggsave(file.path(outdir, "subsidy_ps2.1.png"), plot = sub2.1,
 #     width = 6, height = 7, bg = "white", dpi = 300)

```


```{r plot second scenario of fishery subsidies where the weak stock price increases and strong stock price remains constabt, echo = FALSE, include = FALSE}
# Create facet labels
sub1_label1 <- c("-10%")
names(sub1_label1) <- c("0.045")

sub1_label2 <- c("-25%")
names(sub1_label2) <- c("0.0375")

sub1_label3 <- c("-50%")
names(sub1_label3) <- c("0.025")

no_sub <- c("0%")
names(no_sub) <- c("0.05")

# Create series of plots for pw = 0.1
subs1_w_proc_plot0 <-
  ggplot(data = w_s_range_proc %>% 
           filter(p_s == 1)) +
  geom_tile(aes(x = vuln_ratio_w, y = w_stock_rev, fill = log1p(b_v_k_w), width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                         direction = -1,
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.35, 0.1)) +
  facet_wrap(~ c,
             labeller = labeller(c = no_sub)) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 8, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))

subs1_w_proc_plot1 <-
  ggplot(data = output_subs2_proc %>% 
           filter(p_s == 1 & c == 0.045)) +
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(w_stock_rev, 8), fill = log_b_v_k_w, height = 1, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                         direction = -1,
                         rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.4, 0.1)) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label1)) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 8, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


subs1_w_proc_plot2 <-
  ggplot(data = output_subs2_proc %>% 
           filter(p_s == 1 & c == 0.0375)) + 
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(w_stock_rev, 8), fill = log_b_v_k_w, height = 1.2, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                         direction = -1,
                         rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.3, 0.1)) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label2)) +
  scale_x_continuous(breaks = seq(1, 10, 3),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 12, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))

subs1_w_proc_plot3 <-
  ggplot(data = output_subs2_proc %>% 
           filter(p_s == 1 & c == 0.025)) + 
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(w_stock_rev, 8), fill = log_b_v_k_w, height = 1.6, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                         direction = -1,
                         rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.2, 0.05)) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label3)) +
  scale_x_continuous(breaks = seq(1, 10, 3),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 16, 4),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))



# Create plots for a smaller range of Vw/Vs
subs1_w_proc_plot0.1 <-
  ggplot(data = w_s_range_proc %>% 
           filter(p_s == 1 & vuln_ratio_w <= 4)) +
  geom_tile(aes(x = vuln_ratio_w, y = w_stock_rev, fill = log1p(b_v_k_w), width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.55, 0.1),
                         direction = -1,
                         limits = col_limit) +
  facet_wrap(~ c,
             labeller = labeller(c = no_sub)) +
  scale_x_continuous(breaks = seq(1, 4, 1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 8, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))

subs1_w_proc_plot1.1 <-
  ggplot(data = output_subs2_proc %>% 
           filter(p_s == 1 & c == 0.045 & vuln_ratio_w <= 4)) +
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(w_stock_rev, 8), fill = log_b_v_k_w, height = 1, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.55, 0.1),
                         direction = -1,
                         limits = col_limit) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label1)) +
  scale_x_continuous(breaks = seq(1, 4, 1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 8, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


subs1_w_proc_plot2.1 <-
  ggplot(data = output_subs2_proc %>% 
           filter(p_s == 1 & c == 0.0375  & vuln_ratio_w <= 4)) + 
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(w_stock_rev, 8), fill = log_b_v_k_w, height = 1.2, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.55, 0.1),
                         direction = -1,
                         limits = col_limit) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label2)) +
  scale_x_continuous(breaks = seq(1, 4, 1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 12, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))

subs1_w_proc_plot3.1 <-
  ggplot(data = output_subs2_proc %>% 
           filter(p_s == 1 & c == 0.025  & vuln_ratio_w <= 4 & w_stock_rev <= 10)) + 
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(w_stock_rev, 8), fill = log_b_v_k_w, height = 1.6, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.55, 0.1),
                         direction = -1,
                         limits = col_limit) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label3)) +
  scale_x_continuous(breaks = seq(1, 4, 1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 10, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


```

- 0.045 = 10% subsidy
- 0.0375 = 25% subsidy
- 0.025 = 50% subsidy

```{r, echo = FALSE, fig.height=7, fig.width=8, include = FALSE}
# Gather all plots for pw = 1 
sub_w1 <- grid.arrange(patchworkGrob(subs1_w_proc_plot0 /
                                     subs1_w_proc_plot1 / 
                                     subs1_w_proc_plot2 /
                                     subs1_w_proc_plot3 +
  plot_layout(ncol = 2)),
  left = "Weak stock revenue stream",
  bottom = "Vw/Vs")  

# ggsave(file.path(outdir, "subsidy_pw1.png"), plot = sub_w1,
#     width = 6, height = 7, bg = "white", dpi = 300)
```

```{r, echo = FALSE, include = FALSE}
sub_w1.1 <- grid.arrange(patchworkGrob(subs1_w_proc_plot0.1 /
                                          subs1_w_proc_plot1.1 / 
                                          subs1_w_proc_plot2.1 /
                                          subs1_w_proc_plot3.1 +
  plot_layout(ncol = 2,
              guides = "collect")),
  left = "Weak stock revenue stream",
  bottom = "Vw/Vs")  

# ggsave(file.path(outdir, "subsidy_pw1.1.png"), plot = sub_w1.1,
#     width = 6, height = 7, bg = "white", dpi = 300)


```

```{r, echo = FALSE, include = FALSE}
# Create series of plots for pw = 0.1 with full range of vulnerabilities
subs2_w_proc_plot0 <-
  ggplot(data = w_s_range_proc %>% 
           filter(p_s == 2)) +
  geom_tile(aes(x = vuln_ratio_w, y = w_stock_rev, fill = log1p(b_v_k_w), width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                         direction = -1,
                         rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.2, 0.05)) +
  facet_wrap(~ c,
             labeller = labeller(c = no_sub)) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 8, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


subs2_w_proc_plot1 <-
  ggplot(data = output_subs2_proc %>% 
           filter(p_s == 2 & c == 0.045)) +
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(w_stock_rev, 8), fill = log_b_v_k_w, height = 1, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                         direction = -1,
                         rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.2, 0.05)) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label1)) +
  scale_x_continuous(breaks = seq(1, 10, 3),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 8, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


subs2_w_proc_plot2 <-
  ggplot(data = output_subs2_proc %>% 
           filter(p_s == 2 & c == 0.0375)) + 
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(w_stock_rev, 8), fill = log_b_v_k_w, height = 1.2, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                         direction = -1,
                         rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.2, 0.05)) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label2)) +
  scale_x_continuous(breaks = seq(1, 10, 3),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 12, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))

subs2_w_proc_plot3 <-
  ggplot(data = output_subs2_proc %>% 
           filter(p_s == 2 & c == 0.025)) + 
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(w_stock_rev, 8), fill = log_b_v_k_w, height = 1.6, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                         direction = -1,
                         rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.1, 0.025)) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label3)) +
  scale_x_continuous(breaks = seq(1, 10, 3),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 16, 4),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


# Create series of plots for pw = 0.1 with vulnerabilities ranging from 1 to 4
subs2_w_proc_plot0.1 <-
  ggplot(data = w_s_range_proc %>% 
           filter(p_s == 2 & vuln_ratio_w <= 4)) +
  geom_tile(aes(x = vuln_ratio_w, y = w_stock_rev, fill = log1p(b_v_k_w), width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.55, 0.1),
                         direction = -1,
                         limits = col_limit) +
  facet_wrap(~ c,
             labeller = labeller(c = no_sub)) +
  scale_x_continuous(breaks = seq(1, 4, 1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 8, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


subs2_w_proc_plot1.1 <-
  ggplot(data = output_subs2_proc %>% 
           filter(p_s == 2 & c == 0.045 & vuln_ratio_w <= 4)) +
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(w_stock_rev, 8), fill = log_b_v_k_w, height = 1, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.55, 0.1),
                         direction = -1,
                         limits = col_limit) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label1)) +
  scale_x_continuous(breaks = seq(1, 4, 1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 8, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


subs2_w_proc_plot2.1 <-
  ggplot(data = output_subs2_proc %>% 
           filter(p_s == 2 & c == 0.0375 & vuln_ratio_w <= 4)) + 
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(w_stock_rev, 8), fill = log_b_v_k_w, height = 1.2, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.55, 0.1),
                         direction = -1,
                         limits = col_limit) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label2)) +
  scale_x_continuous(breaks = seq(1, 4, 1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 12, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))

subs2_w_proc_plot3.1 <-
  ggplot(data = output_subs2_proc %>% 
           filter(p_s == 2 & c == 0.025 & vuln_ratio_w <= 4 & w_stock_rev <= 10)) + 
  geom_tile(aes(x = round(vuln_ratio_w, 8), y = round(w_stock_rev, 8), fill = log_b_v_k_w, height = 1.6, width = .1)) +
  scale_fill_paletteer_c("ggthemes::Green-Blue-White Diverging",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.55, 0.1),
                         direction = -1,
                         limits = col_limit) +
  facet_wrap(~ c,
             nrow = 1,
             scales = "free_y",
             labeller = labeller(c = sub1_label3)) +
  scale_x_continuous(breaks = seq(1, 4, 1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 16, 2),
                     expand = c(0,0)) +
  labs(x = "",
       y = "",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


```

```{r, echo = FALSE, fig.height=7, fig.width=7, include = FALSE}
# Gather all plots for pw = 0.1 
sub_w2 <- grid.arrange(patchworkGrob(subs2_w_proc_plot0 / 
                                     subs2_w_proc_plot1 / 
                                     subs2_w_proc_plot2 /
                                     subs2_w_proc_plot3 +
  plot_layout(ncol = 2)),
  left = "Weak stock revenue stream",
  bottom = "Vw/Vs")  

# ggsave(file.path(outdir, "subsidy_pw2.png"), plot =  sub_w2,
#       width = 6, height = 7, bg = "white", dpi = 300)
```

```{r, echo = FALSE, include = FALSE}
# Gather all plots for pw = 0.1 with vulnerabiliy range subset
sub_w2.1 <- grid.arrange(patchworkGrob(subs2_w_proc_plot0.1 / 
                                       subs2_w_proc_plot1.1 / 
                                       subs2_w_proc_plot2.1 /
                                       subs2_w_proc_plot3.1 +
  plot_layout(ncol = 2,
              guides = "collect")),
  left = "Weak stock revenue stream",
  bottom = "Vw/Vs")  

 ggsave(file.path(outdir, "subsidy_pw2.1.png"), plot =  sub_w2.1,
        width = 6, height = 7, bg = "white", dpi = 300)


```

```{r, echo = FALSE, fig.height=10, fig.width=7, include = FALSE}
subs_1_2 <- grid.arrange(patchworkGrob(subs2_s_proc_plot0.1 / 
                                       subs2_s_proc_plot1.1 / 
                                       subs2_s_proc_plot2.1 /
                                       subs2_s_proc_plot3.1 /
                                       subs1_s_proc_plot0.1 /
                                       subs1_s_proc_plot1.1 / 
                                       subs1_s_proc_plot2.1 /
                                       subs1_s_proc_plot3.1 +
                             
  plot_layout(ncol = 2) +
  plot_annotation(tag_levels = "A")),
  left = "Strong stock revenue stream",
  bottom = "Vw/Vs")

# ggsave(file.path(outdir, "sub_vs_st_stock.png"), plot =  subs_1_2,
#         width = 7, height = 10, bg = "white", dpi = 300)

subw_1_2 <- grid.arrange(patchworkGrob(subs1_w_proc_plot0.1 /
                                       subs1_w_proc_plot1.1 / 
                                       subs1_w_proc_plot2.1 /
                                       subs1_w_proc_plot3.1 /
                                       subs2_w_proc_plot0.1 / 
                                       subs2_w_proc_plot1.1 / 
                                       subs2_w_proc_plot2.1 /
                                       subs2_w_proc_plot3.1 +
  plot_layout(ncol = 2) +
  plot_annotation(tag_levels = "A")),
  left = "Weak stock revenue stream",
  bottom = "Vw/Vs")

# ggsave(file.path(outdir, "sub_vs_w_stock.png"), plot =  subw_1_2,
#         width = 7, height = 10, bg = "white", dpi = 300)
```


```{r, echo = FALSE}
output_subs2_proc %>% 
  mutate(extinct = case_when(
    b_v_k_w == 0 ~ "yes",
    b_v_k_w > 0 ~ "no",
  )) %>% 
  filter(p_s == 2 & c == 0.025) %>% 
  group_by(extinct) %>% 
  count() %>% 
  ungroup() %>%  
  mutate(prop = prop.table(n)) %>% 
  mutate(sum = sum(prop))

output_subs2_proc %>% 
  mutate(extinct = case_when(
    b_v_k_w == 0 ~ "yes",
    b_v_k_w > 0 ~ "no",
  )) %>% 
  filter(p_s == 2 & c == 0.0375) %>% 
  group_by(extinct) %>% 
  count() %>% 
  ungroup() %>%  
  mutate(prop = prop.table(n)) %>% 
  mutate(sum = sum(prop))

output_subs2_proc %>% 
  mutate(extinct = case_when(
    b_v_k_w == 0 ~ "yes",
    b_v_k_w > 0 ~ "no",
  )) %>% 
  filter(p_s == 2 & c == 0.045) %>% 
  group_by(extinct) %>% 
  count() %>% 
  ungroup() %>%  
  mutate(prop = prop.table(n)) %>% 
  mutate(sum = sum(prop))
```

```{r, echo = FALSE, include = FALSE}
ggplot(data = output_msy1_proc) +
  geom_histogram(aes(x = E), 
                 fill = "black",
                 alpha= 0.5) +
  geom_histogram(aes(x = N_s),
                 fill = "darkgreen",
                 alpha = 0.5) +
  geom_histogram(aes(x = N_w),
                 fill = "darkred",
                 alpha = 0.5)
```


```{r, echo = FALSE, include = FALSE}
#msy1_w_proc_plot1 <-
  ggplot(data = output_msy1_proc %>%
           filter(p_w < 1 & vuln_ratio_w <= 3)) + 
  geom_tile(aes(x = vuln_ratio_w, y = st_stock_rev, fill = log1p(b_v_k_w), width = .1)) +
  scale_fill_paletteer_c("viridis::viridis",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.4, 0.1)) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "Vw/Vs",
       y = "Strong stock revenue stream",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))
  
msy1_w_proc_plot2 <- 
  ggplot(data = output_msy1_proc %>% 
           filter(p_w == 1)) + 
  geom_tile(aes(x = vuln_ratio_w, y = st_stock_rev, fill = log1p(b_v_k_w), width = .1)) +
  scale_fill_paletteer_c("viridis::viridis",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1)) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "Vw/Vs",
       y = "Strong stock revenue stream",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))

#msy2_w_proc_plot1 <-
  ggplot(data = output_msy2_proc %>%
           filter(p_s == 1)) + 
  geom_tile(aes(x = vuln_ratio_w, y = w_stock_rev, fill = log1p(b_v_k_w), width = .1)) +
  scale_fill_paletteer_c("viridis::viridis",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.4, 0.1)) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "Vw/Vs",
       y = "Weak stock revenue stream",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))
  
msy2_w_proc_plot2 <- 
  ggplot(data = output_msy2_proc %>% 
           filter(p_s == 2)) + 
  geom_tile(aes(x = vuln_ratio_w, y = w_stock_rev, fill = log1p(b_v_k_w), width = .1)) +
  scale_fill_paletteer_c("viridis::viridis",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1),
                         breaks = seq(0, 0.25, 0.05)) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "Vw/Vs",
       y = "Weak stock revenue stream",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))
```



```{r, echo = FALSE, include = FALSE}
s_w_range_proc_plot_v3 <-
  ggplot(data = s_w_range_proc %>% filter(p_w < 1 & st_stock_rev <= 10)) +
  geom_tile(aes(x = log1p(vuln_ratio_w), y = st_stock_rev, fill = log1p(b_v_k_w), width = 1)) +
  scale_fill_paletteer_c("viridis::viridis",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.2),
                         breaks = seq(0, 0.7, 0.2)) +
  scale_x_continuous(breaks = seq(0, 3, 0.5),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(1, 16, 1),
                     expand = c(0,0)) +
  labs(x = "log(Vw/Vs)",
       y = "Strong stock revenue stream",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


s_w_range_proc_plot2_v3 <-
  ggplot(data = s_w_range_proc %>% filter(p_w == 1 & st_stock_rev <= 10)) +
  geom_tile(aes(x = log1p(vuln_ratio_w), y = st_stock_rev, fill = log1p(b_v_k_w), width = 1)) +
  scale_fill_paletteer_c("viridis::viridis",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.15),
                         breaks = seq(0, 0.35, 0.15)) +
  scale_x_continuous(breaks = seq(0, 3, 0.5),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(1, 16, 1),
                     expand = c(0,0)) +
  labs(x = "log(Vw/Vs)",
       y = "Strong stock revenue stream",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.ticks = element_blank(),
        axis.text = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


w_s_range_proc_plot1_v3 <-
  ggplot(data = w_s_range_proc %>% filter(p_s == 1)) + 
  geom_tile(aes(x = log1p(vuln_ratio_w), y = w_stock_rev, fill = log1p(b_v_k_w), width = 1)) +
  scale_fill_paletteer_c("viridis::viridis",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.15),
                         breaks = seq(0, 0.4, 0.15)) +
  scale_x_continuous(breaks = seq(0, 3, 0.5),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 8, 1),
                     expand = c(0,0)) +
  labs(x = "log(Vw/Vs)",
       y = "Weak stock revenue stream",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))
  
w_s_range_proc_plot2_v3 <- 
  ggplot(data = w_s_range_proc %>% filter(p_s == 2)) + 
  geom_tile(aes(x = log1p(vuln_ratio_w), y = w_stock_rev, fill = log1p(b_v_k_w), width = 1)) +
  scale_fill_paletteer_c("viridis::viridis",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1)) +
  scale_x_continuous(breaks = seq(0, 3, 0.5),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 8, 1),
                     expand = c(0,0)) +
  labs(x = "log(Vw/Vs)",
       y = "Weak stock revenue stream",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))
```

### Vulnerability ratios vs revenue stream with prices as constants
- in the top plots, $p_w$ = 1
- in the bottom plots, $p_s$ = 1

```{r, fig.height=10, fig.width=10, echo = FALSE, include = FALSE}
range_plot_1_v3 <- 
  (s_w_range_proc_plot_v3 +
  s_w_range_proc_plot2_v3)  

range_plot_2_v3 <-
  (w_s_range_proc_plot1_v3 +
  w_s_range_proc_plot2_v3) 

#plot_1_v3 <-
  range_plot_1_v3 / 
  range_plot_2_v3 +
  plot_annotation(tag_levels = "A")
```

```{r, echo = FALSE, include = FALSE}
s_w_range_proc_plot_v4 <-
  ggplot(data = s_w_range_proc %>% filter(p_w < 1 & st_stock_rev <= 10 & b_v_k_w == 0)) +
  geom_tile(aes(x = log1p(vuln_ratio_w), y = log1p(st_stock_rev), fill = log1p(b_v_k_w), width = 1, height = 1)) +
  scale_fill_paletteer_c("viridis::viridis",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.2),
                         breaks = seq(0, 0.7, 0.2)) +
  scale_x_continuous(breaks = seq(0, 3, 0.5),
                     expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "log(Vw/Vs)",
       y = "log(Strong stock revenue stream)",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        axis.ticks = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


s_w_range_proc_plot2_v4 <-
  ggplot(data = s_w_range_proc %>% filter(p_w == 1 & st_stock_rev <= 10)) +
  geom_tile(aes(x = log1p(vuln_ratio_w), y = log1p(st_stock_rev), fill = log1p(b_v_k_w), width = 1, height = 1)) +
  scale_fill_paletteer_c("viridis::viridis",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.15),
                         breaks = seq(0, 0.35, 0.15)) +
  scale_x_continuous(breaks = seq(0, 3, 0.5),
                     expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "log(Vw/Vs)",
       y = "log(Strong stock revenue stream)",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.ticks = element_blank(),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


w_s_range_proc_plot1_v4 <-
  ggplot(data = w_s_range_proc %>% filter(p_s == 1)) + 
  geom_tile(aes(x = log1p(vuln_ratio_w), y = log1p(w_stock_rev), fill = log1p(b_v_k_w), width = 1, height = 1)) +
  scale_fill_paletteer_c("viridis::viridis",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.15),
                         breaks = seq(0, 0.4, 0.15)) +
  scale_x_continuous(breaks = seq(0, 3, 0.5),
                     expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "log(Vw/Vs)",
       y = "log(Weak stock revenue stream)",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        axis.ticks = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))
  
w_s_range_proc_plot2_v4 <- 
  ggplot(data = w_s_range_proc %>% filter(p_s == 2)) + 
  geom_tile(aes(x = log1p(vuln_ratio_w), y = log1p(w_stock_rev), fill = log1p(b_v_k_w), width = 1, height = 1)) +
  scale_fill_paletteer_c("viridis::viridis",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.1)) +
  scale_x_continuous(breaks = seq(0, 3, 0.5),
                     expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "log(Vw/Vs)",
       y = "log(Weak stock revenue stream)",
       fill = "log(B/K)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        axis.ticks = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))
```

### Vulnerability ratios vs revenue stream with prices as constants
- in the top plots, $p_w$ = 1
- in the bottom plots, $p_s$ = 1

```{r, fig.height=10, fig.width=10, echo = FALSE, include = FALSE}
range_plot_1_v4 <- 
  (s_w_range_proc_plot_v4 +
  s_w_range_proc_plot2_v4)  

range_plot_2_v4 <-
  (w_s_range_proc_plot1_v4 +
  w_s_range_proc_plot2_v4) 

#plot_1_v4 <-
  range_plot_1_v4 / 
  range_plot_2_v4 +
  plot_annotation(tag_levels = "A")
```


### Vulnerability ratios vs revenue stream with prices as functions of catch
- in the top plots, $p_s$ is a parameter and $p_w$ is a variable
- in the bottom plots, $p_w$ is a parameter and $p_s$ is a variable

```{r, fig.height = 10, fig.width = 10, echo = FALSE}
# (w_fcn_s_rev_plot + w_fcn_w_rev_plot) /
#   (s_fcn_s_rev_plot + s_fcn_w_rev_plot) +
#   plot_annotation(tag_levels = "A") + 
#   plot_layout(guides = "collect")
```


## Time series equations

$$
\begin{align}
\frac{d N_s}{dt} &= N_S  r_s  (1 - (\frac{N_S}{K_s})) - q_s E \\
\newline
\frac{d N_w}{dt} &= N_W  r_w  (1 - (\frac{N_W}{K_w})) - q_w E \\
\newline
\frac{d E}{dt} &= \alpha  E  (p_s  q_s  N_S + p_w q_w N_W - c)
\newline
\frac{d C_s}{dt} &= q_s N_s E
\newline
\frac{d C_w}{dt} &= q_w N_w E
\newline
\frac{d CPUE_s}{dt} &= \frac{C_s} {E}
\newline
\frac{d CPUE_w}{dt} &= \frac{C_w} {E}
\newline
\frac{d \pi_s}{dt} &= C_s p_s - C_s  c
\newline
\frac{d \pi_w}{dt} &= C_w p_W - C_w  c
\newline
\frac{d \pi}{dt} &= C_s  p_s + C_w  p_w - (C_s + C_w) * c
\end{align}
$$


where $q_s$ and $q_w$ are the catchability of the strong and the weak stock, respectively; $r_s$ and $r_w$ are the intrinsic growth rates of the strong and weak stocks, respectively; $p_s$ and $p_w$ are the prices of the strong and weak stocks, respectively; $k_s$ and $k_w$ are the carrying capacities of the strong and weak stocks, respectively; $c$ is the fishing cost, and $\alpha$ is a constant controling for the speed at which effort changes following price changes.

### Prices as constants

```{r scenario 1 price ratio 10, echo = FALSE}
# set up the parameter space
q_s <- 0.02
q_w <- 0.02
k_s <- 4
k_w <- 2
r_s <- 1
r_w <- 0.5
p_s1 <- 1
p_w1 <- 0.1
alpha <- 1
c <- 0.05

# Initial values for the variables
N_w <- k_w

N_s <- k_s

E <- 0.1
```

```{r, echo = FALSE}
tset <- seq(from = 0, to = 300, length.out = 10000)

N_w_simu1 <- NaN*tset; N_w_simu1[1] <- N_w

N_s_simu1 <- NaN*tset; N_s_simu1[1] <- N_s

#N_w_test_1 <- NaN*tset; N_w_test_1[1] <- N_w

#N_s_test_1 <- NaN*tset; N_s_test_1[1] <- N_s

E_simu1 <- NaN*tset; E_simu1[1] <- E

#E_test1 <- NaN*tset; E_test1[1] <- E

C_s_simu1 <- NaN*tset; C_s_simu1[1] <- 1

C_w_simu1 <- NaN*tset; C_w_simu1[1] <- 1

cpue_s_simu1 <- NaN*tset; cpue_s_simu1[1] <- 1

cpue_w_simu1 <- NaN*tset; cpue_w_simu1[1] <- 1

Pi_sum_simu1 <- NaN*tset; Pi_sum_simu1[1] <- 2

Pi_s_simu1 <- NaN*tset; Pi_s_simu1[1] <- 1

Pi_w_simu1 <- NaN*tset; Pi_w_simu1[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w1 <- N_w_simu1[i-1]
  N_s1 <- N_s_simu1[i-1]
  #N_wt1 <- N_w_test_1[i-1]
  #N_st1 <- N_s_test_1[i-1]
  E1 <- E_simu1[i-1]
  #E_t1 <- E_test1[i-1]
  C_s1 <- C_s_simu1[i-1]
  C_w1 <- C_w_simu1[i-1]
  cpue_s1 <- cpue_s_simu1[i-1]
  cpue_w1 <- cpue_w_simu1[i-1]
  pi1 <- Pi_sum_simu1[i-1]
  pi_s1 <- Pi_s_simu1[i-1]
  pi_w1 <- Pi_w_simu1[i-1]
    
  # Calculate change in variable size at each time step
  dN_s1 <- (N_s1 * (r_s * (1 - (N_s1/k_s)) - q_s * E1)) * dt
  dN_w1 <- (N_w1 * (r_w * (1 - (N_w1/k_w)) - q_w * E1)) * dt
  #dN_st1 <- (N_st1 * (r_s * (1 - (N_st1/k_s)) - q_s * E_t1)) * dt
  #dN_wt1 <- (N_wt1 * (r_w * (1 - (N_wt1/k_w)) - q_w * E_t1)) * dt
  dE1 <- (alpha * E1 * (p_s1 * q_s * N_s1 + p_w1 * q_w * N_w1 - c)) * dt
  #dE_test1 <- ((p_s1 * q_s1 * N_st1 + p_w1 * q_w1 * N_wt1) - c) * dt
  dC_s1 <- (q_s * N_s1 * E1) * dt
  dC_w1 <- (q_w * N_w1 * E1) * dt
  dcpue_s1 <- (C_s1 / E1) * dt
  dcpue_w1 <- (C_w1 / E1) * dt
  dPi_s1 <- (C_s1 * p_s1 - C_s1 * c) * dt
  dPi_w1 <- (C_w1 * p_w1 - C_w1 * c) * dt
  dPi1 <- (C_s1 * p_s1 + C_w1 * p_w1 - ((C_s1 + C_w1) * c)) * dt
  # calculate total variable size and store in holding vectors
  
  N_w_simu1[i] <- N_w1 + dN_w1
  N_s_simu1[i] <- N_s1 + dN_s1
  #N_w_test_1[i] <- N_wt1 + dN_wt1
  #N_s_test_1[i] <- N_st1 + dN_st1
  E_simu1[i] <- E1 + dE1
  #E_test1[i] <- E_t1 + dE_test1
  C_s_simu1[i] <- C_s1 + dC_s1
  C_w_simu1[i] <- C_w1 + dC_w1
  cpue_s_simu1[i] <- cpue_s1 + dcpue_s1
  cpue_w_simu1[i] <- cpue_w1 + dcpue_w1
  Pi_sum_simu1[i] <- pi1 + dPi1
  Pi_s_simu1[i] <- pi_s1 + dPi_s1
  Pi_w_simu1[i] <- pi_w1 + dPi_w1
  
}
  

```


```{r scenario 2 price ratio 5, echo = FALSE}
p_s2 <- 1
p_w2 <- 0.2
```

```{r, echo = FALSE}
#tset <- seq(from = 0, to = 500, length.out = 10000)

N_w_simu2 <- NaN*tset; N_w_simu2[1] <- N_w

N_s_simu2 <- NaN*tset; N_s_simu2[1] <- N_s

#N_w_test_2 <- NaN*tset; N_w_test_2[1] <- N_w

#N_s_test_2 <- NaN*tset; N_s_test_2[1] <- N_s

E_simu2 <- NaN*tset; E_simu2[1] <- E

#E_test2 <- NaN*tset; E_test2[1] <- E

C_s_simu2 <- NaN*tset; C_s_simu2[1] <- 1

C_w_simu2 <- NaN*tset; C_w_simu2[1] <- 1

cpue_s_simu2 <- NaN*tset; cpue_s_simu2[1] <- 1

cpue_w_simu2 <- NaN*tset; cpue_w_simu2[1] <- 1

Pi_sum_simu2 <- NaN*tset; Pi_sum_simu2[1] <- 2

Pi_s_simu2 <- NaN*tset; Pi_s_simu2[1] <- 1

Pi_w_simu2 <- NaN*tset; Pi_w_simu2[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w2 <- N_w_simu2[i-1]
  N_s2 <- N_s_simu2[i-1]
  #N_wt2 <- N_w_test_2[i-1]
  #N_st2 <- N_s_test_2[i-1]
  E2 <- E_simu2[i-1]
  #E_t2 <- E_test2[i-1]
  C_s2 <- C_s_simu2[i-1]
  C_w2 <- C_w_simu2[i-1]
  cpue_s2 <- cpue_s_simu2[i-1]
  cpue_w2 <- cpue_w_simu2[i-1]
  pi2 <- Pi_sum_simu2[i-1]
  pi_s2 <- Pi_s_simu2[i-1]
  pi_w2 <- Pi_w_simu2[i-1]

  # Calculate change in variable size at each time step
  dN_s2 <- (N_s2 * (r_s * (1 - (N_s2/k_s)) - q_s * E2)) * dt
  dN_w2 <- (N_w2 * (r_w * (1 - (N_w2/k_w)) - q_w * E2)) * dt
  #dN_st2 <- (N_st2 * (r_s2 * (1 - (N_st2/k_s2)) - q_s2 * E_t2)) * dt
  #dN_wt2 <- (N_wt2 * (r_w2 * (1 - (N_wt2/k_w2)) - q_w2 * E_t2)) * dt
  dE2 <- (alpha * E2 * (p_s2 * q_s * N_s2 + p_w2 * q_w * N_w2 - c)) * dt
  #dE_test2 <- ((p_s2 * q_s2 * N_st2 + p_w2 * q_w2 * N_wt2) - c) * dt
  dC_s2 <- (q_s * N_s2 * E2) * dt
  dC_w2 <- (q_w * N_w2 * E2) * dt
  dcpue_s2 <- (C_s2 / E2) * dt
  dcpue_w2 <- (C_w2 / E2) * dt
  dPi_s2 <- (C_s2 * p_s2 - C_s2 * c) * dt
  dPi_w2 <- (C_w2 * p_w2 - C_w2 * c) * dt
  dPi2 <- (C_s2 * p_s2 + C_w2 * p_w2 - ((C_s2 + C_w2) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu2[i] <- N_w2 + dN_w2
  N_s_simu2[i] <- N_s2 + dN_s2
  #N_w_test_2[i] <- N_wt2 + dN_wt2
  #N_s_test_2[i] <- N_st2 + dN_st2
  E_simu2[i] <- E2 + dE2
  #E_test2[i] <- E_t2 + dE_test2
  C_s_simu2[i] <- C_s2 + dC_s2
  C_w_simu2[i] <- C_w2 + dC_w2
  cpue_s_simu2[i] <- cpue_s2 + dcpue_s2
  cpue_w_simu2[i] <- cpue_w2 + dcpue_w2
  Pi_sum_simu2[i] <- pi2 + dPi2
  Pi_s_simu2[i] <- pi_s2 + dPi_s2
  Pi_w_simu2[i] <- pi_w2 + dPi_w2
}
```


```{r scenario 3 price ratio 2.5, echo = FALSE}
# set up the parameter space
p_s3 <- 1
p_w3 <- 0.4
```

```{r, echo = FALSE}
#tset <- seq(from = 0, to = 500, length.out = 10000)

N_w_simu3 <- NaN*tset; N_w_simu3[1] <- N_w

N_s_simu3 <- NaN*tset; N_s_simu3[1] <- N_s

#N_w_test_3 <- NaN*tset; N_w_test_3[1] <- N_w

#N_s_test_3 <- NaN*tset; N_s_test_3[1] <- N_s

E_simu3 <- NaN*tset; E_simu3[1] <- E

#E_test3 <- NaN*tset; E_test3[1] <- E

C_s_simu3 <- NaN*tset; C_s_simu3[1] <- 1

C_w_simu3 <- NaN*tset; C_w_simu3[1] <- 1

cpue_s_simu3 <- NaN*tset; cpue_s_simu3[1] <- 1

cpue_w_simu3 <- NaN*tset; cpue_w_simu3[1] <- 1

Pi_sum_simu3 <- NaN*tset; Pi_sum_simu3[1] <- 2

Pi_s_simu3 <- NaN*tset; Pi_s_simu3[1] <- 1

Pi_w_simu3 <- NaN*tset; Pi_w_simu3[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w3 <- N_w_simu3[i-1]
  N_s3 <- N_s_simu3[i-1]
  #N_wt3 <- N_w_test_3[i-1]
  #N_st3 <- N_s_test_3[i-1]
  E3 <- E_simu3[i-1]
  #E_t3 <- E_test3[i-1]
  C_s3 <- C_s_simu3[i-1]
  C_w3 <- C_w_simu3[i-1]
  cpue_s3 <- cpue_s_simu3[i-1]
  cpue_w3 <- cpue_w_simu3[i-1]
  pi3 <- Pi_sum_simu3[i-1]
  pi_s3 <- Pi_s_simu3[i-1]
  pi_w3 <- Pi_w_simu3[i-1]

  # Calculate change in variable size at each time step
  dN_s3 <- (N_s3 * (r_s * (1 - (N_s3/k_s)) - q_s * E3)) * dt
  dN_w3 <- (N_w3 * (r_w * (1 - (N_w3/k_w)) - q_w * E3)) * dt
  #dN_st3 <- (N_st3 * (r_s3 * (1 - (N_st3/k_s3)) - q_s3 * E_t3)) * dt
  #dN_wt3 <- (N_wt3 * (r_w3 * (1 - (N_wt3/k_w3)) - q_w3 * E_t3)) * dt
  dE3 <- (alpha * E3 * (p_s3 * q_s * N_s3 + p_w3 * q_w * N_w3 - c)) * dt
  #dE_test3 <- ((p_s3 * q_s3 * N_st3 + p_w3 * q_w3 * N_wt3) - c) * dt
  dC_s3 <- (q_s * N_s3 * E3) * dt
  dC_w3 <- (q_w * N_w3 * E3) * dt
  dcpue_s3 <- (C_s3 / E3) * dt
  dcpue_w3 <- (C_w3 / E3) * dt
  dPi_s3 <- (C_s3 * p_s3 - C_s3 * c) * dt
  dPi_w3 <- (C_w3 * p_w3 - C_w3 * c) * dt
  dPi3 <- (C_s3 * p_s3 + C_w3 * p_w3 - ((C_s3 + C_w3) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu3[i] <- N_w3 + dN_w3
  N_s_simu3[i] <- N_s3 + dN_s3
  #N_w_test_3[i] <- N_wt3 + dN_wt3
  #N_s_test_3[i] <- N_st3 + dN_st3
  E_simu3[i] <- E3 + dE3
  #E_test3[i] <- E_t3 + dE_test3
  C_s_simu3[i] <- C_s3 + dC_s3
  C_w_simu3[i] <- C_w3 + dC_w3
  cpue_s_simu3[i] <- cpue_s3 + dcpue_s3
  cpue_w_simu3[i] <- cpue_w3 + dcpue_w3
  Pi_sum_simu3[i] <- pi3 + dPi3
  Pi_s_simu3[i] <- pi_s3 + dPi_s3
  Pi_w_simu3[i] <- pi_w3 + dPi_w3

}
```


```{r scenario 4 price ratio 1, echo = FALSE}
# set up the parameter space
p_s4 <- 1
p_w4 <- 1
```

```{r, echo = FALSE}
#tset <- seq(from = 0, to = 500, length.out = 10000)

N_w_simu4 <- NaN*tset; N_w_simu4[1] <- N_w

N_s_simu4 <- NaN*tset; N_s_simu4[1] <- N_s

#N_w_test_4 <- NaN*tset; N_w_test_4[1] <- N_w

#N_s_test_4 <- NaN*tset; N_s_test_4[1] <- N_s

E_simu4 <- NaN*tset; E_simu4[1] <- E

#E_test4 <- NaN*tset; E_test4[1] <- E

C_s_simu4 <- NaN*tset; C_s_simu4[1] <- 1

C_w_simu4 <- NaN*tset; C_w_simu4[1] <- 1

cpue_s_simu4 <- NaN*tset; cpue_s_simu4[1] <- 1

cpue_w_simu4 <- NaN*tset; cpue_w_simu4[1] <- 1

Pi_sum_simu4 <- NaN*tset; Pi_sum_simu4[1] <- 2

Pi_s_simu4 <- NaN*tset; Pi_s_simu4[1] <- 1

Pi_w_simu4 <- NaN*tset; Pi_w_simu4[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w4 <- N_w_simu4[i-1]
  N_s4 <- N_s_simu4[i-1]
  #N_wt4 <- N_w_test_4[i-1]
  #N_st4 <- N_s_test_4[i-1]
  E4 <- E_simu4[i-1]
  #E_t4 <- E_test4[i-1]
  C_s4 <- C_s_simu4[i-1]
  C_w4 <- C_w_simu4[i-1]
  cpue_s4 <- cpue_s_simu4[i-1]
  cpue_w4 <- cpue_w_simu4[i-1]
  pi4 <- Pi_sum_simu4[i-1]
  pi_s4 <- Pi_s_simu4[i-1]
  pi_w4 <- Pi_w_simu4[i-1]

  # Calculate change in variable size at each time step
  dN_s4 <- (N_s4 * (r_s * (1 - (N_s4/k_s)) - q_s * E4)) * dt
  dN_w4 <- (N_w4 * (r_w * (1 - (N_w4/k_w)) - q_w * E4)) * dt
  #dN_st4 <- (N_st4 * (r_s4 * (1 - (N_st4/k_s4)) - q_s4 * E_t4)) * dt
  #dN_wt4 <- (N_wt4 * (r_w4 * (1 - (N_wt4/k_w4)) - q_w4 * E_t4)) * dt
  dE4 <- (alpha * E4 * (p_s4 * q_s * N_s4 + p_w4 * q_w * N_w4 - c)) * dt
  #dE_test4 <- ((p_s4 * q_s4 * N_st4 + p_w4 * q_w4 * N_wt4) - c) * dt
  dC_s4 <- (q_s * N_s4 * E4) * dt
  dC_w4 <- (q_w * N_w4 * E4) * dt
  dcpue_s4 <- (C_s4 / E4) * dt
  dcpue_w4 <- (C_w4 / E4) * dt
  dPi_s4 <- (C_s4 * p_s4 - C_s4 * c) * dt
  dPi_w4 <- (C_w4 * p_w4 - C_w4 * c) * dt
  dPi4 <- (C_s4 * p_s4 + C_w4 * p_w4 - ((C_s4 + C_w4) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu4[i] <- N_w4 + dN_w4
  N_s_simu4[i] <- N_s4 + dN_s4
  #N_w_test_4[i] <- N_wt4 + dN_wt4
  #N_s_test_4[i] <- N_st4 + dN_st4
  E_simu4[i] <- E4 + dE4
  #E_test4[i] <- E_t4 + dE_test4
  C_s_simu4[i] <- C_s4 + dC_s4
  C_w_simu4[i] <- C_w4 + dC_w4
  cpue_s_simu4[i] <- cpue_s4 + dcpue_s4
  cpue_w_simu4[i] <- cpue_w4 + dcpue_w4
  Pi_sum_simu4[i] <- pi4 + dPi4
  Pi_s_simu4[i] <- pi_s4 + dPi_s4
  Pi_w_simu4[i] <- pi_w4 + dPi_w4
  
}
```


```{r scenario 5 price ratio 0.75, echo = FALSE}
# set up the parameter space
p_s5 <- 1
p_w5 <- 1.33
```

```{r, echo = FALSE}
#tset <- seq(from = 0, to = 500, length.out = 10000)

N_w_simu5 <- NaN*tset; N_w_simu5[1] <- N_w

N_s_simu5 <- NaN*tset; N_s_simu5[1] <- N_s

#N_w_test_5 <- NaN*tset; N_w_test_5[1] <- N_w

#N_s_test_5 <- NaN*tset; N_s_test_5[1] <- N_s

E_simu5 <- NaN*tset; E_simu5[1] <- E

#E_test5 <- NaN*tset; E_test5[1] <- E

C_s_simu5 <- NaN*tset; C_s_simu5[1] <- 1

C_w_simu5 <- NaN*tset; C_w_simu5[1] <- 1

cpue_s_simu5 <- NaN*tset; cpue_s_simu5[1] <- 1

cpue_w_simu5 <- NaN*tset; cpue_w_simu5[1] <- 1

Pi_sum_simu5 <- NaN*tset; Pi_sum_simu5[1] <- 2

Pi_s_simu5 <- NaN*tset; Pi_s_simu5[1] <- 1

Pi_w_simu5 <- NaN*tset; Pi_w_simu5[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w5 <- N_w_simu5[i-1]
  N_s5 <- N_s_simu5[i-1]
  #N_wt5 <- N_w_test_5[i-1]
  #N_st5 <- N_s_test_5[i-1]
  E5 <- E_simu5[i-1]
  #E_t5 <- E_test5[i-1]
  C_s5 <- C_s_simu5[i-1]
  C_w5 <- C_w_simu5[i-1]
  cpue_s5 <- cpue_s_simu5[i-1]
  cpue_w5 <- cpue_w_simu5[i-1]
  pi5 <- Pi_sum_simu5[i-1]
  pi_s5 <- Pi_s_simu5[i-1]
  pi_w5 <- Pi_w_simu5[i-1]

  # Calculate change in variable size at each time step
  dN_s5 <- (N_s5 * (r_s * (1 - (N_s5/k_s)) - q_s * E5)) * dt
  dN_w5 <- (N_w5 * (r_w * (1 - (N_w5/k_w)) - q_w * E5)) * dt
  #dN_st5 <- (N_st5 * (r_s5 * (1 - (N_st5/k_s5)) - q_s5 * E_t5)) * dt
  #dN_wt5 <- (N_wt5 * (r_w5 * (1 - (N_wt5/k_w5)) - q_w5 * E_t5)) * dt
  dE5 <- (alpha * E5 * (p_s5 * q_s * N_s5 + p_w5 * q_w * N_w5 - c)) * dt
  #dE_test5 <- ((p_s5 * q_s5 * N_st5 + p_w5 * q_w5 * N_wt5) - c) * dt
  dC_s5 <- (q_s * N_s5 * E5) * dt
  dC_w5 <- (q_w * N_w5 * E5) * dt
  dcpue_s5 <- (C_s5 / E5) * dt
  dcpue_w5 <- (C_w5 / E5) * dt
  dPi_s5 <- (C_s5 * p_s5 - C_s5 * c) * dt
  dPi_w5 <- (C_w5 * p_w5 - C_w5 * c) * dt
  dPi5 <- (C_s5 * p_s5 + C_w5 * p_w5 - ((C_s5 + C_w5) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu5[i] <- N_w5 + dN_w5
  N_s_simu5[i] <- N_s5 + dN_s5
  #N_w_test_5[i] <- N_wt5 + dN_wt5
  #N_s_test_5[i] <- N_st5 + dN_st5
  E_simu5[i] <- E5 + dE5
  #E_test5[i] <- E_t5 + dE_test5
  C_s_simu5[i] <- C_s5 + dC_s5
  C_w_simu5[i] <- C_w5 + dC_w5
  cpue_s_simu5[i] <- cpue_s5 + dcpue_s5
  cpue_w_simu5[i] <- cpue_w5 + dcpue_w5
  Pi_sum_simu5[i] <- pi5 + dPi5
  Pi_s_simu5[i] <- pi_s5 + dPi_s5
  Pi_w_simu5[i] <- pi_w5 + dPi_w5  
}
```



```{r scenario 6 price ratio 0.5, echo = FALSE}
p_s6 <- 1
p_w6 <- 2
```

```{r, echo = FALSE}
#tset <- seq(from = 0, to = 500, length.out = 10000)

N_w_simu6 <- NaN*tset; N_w_simu6[1] <- N_w

N_s_simu6 <- NaN*tset; N_s_simu6[1] <- N_s

#N_w_test_6 <- NaN*tset; N_w_test_6[1] <- N_w

#N_s_test_6 <- NaN*tset; N_s_test_6[1] <- N_s

E_simu6 <- NaN*tset; E_simu6[1] <- E

#E_test6 <- NaN*tset; E_test6[1] <- E

C_s_simu6 <- NaN*tset; C_s_simu6[1] <- 1

C_w_simu6 <- NaN*tset; C_w_simu6[1] <- 1

cpue_s_simu6 <- NaN*tset; cpue_s_simu6[1] <- 1

cpue_w_simu6 <- NaN*tset; cpue_w_simu6[1] <- 1

Pi_sum_simu6 <- NaN*tset; Pi_sum_simu6[1] <- 2

Pi_s_simu6 <- NaN*tset; Pi_s_simu6[1] <- 1

Pi_w_simu6 <- NaN*tset; Pi_w_simu6[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w6 <- N_w_simu6[i-1]
  N_s6 <- N_s_simu6[i-1]
  #N_wt6 <- N_w_test_6[i-1]
  #N_st6 <- N_s_test_6[i-1]
  E6 <- E_simu6[i-1]
  #E_t6 <- E_test6[i-1]
  C_s6 <- C_s_simu6[i-1]
  C_w6 <- C_w_simu6[i-1]
  cpue_s6 <- cpue_s_simu6[i-1]
  cpue_w6 <- cpue_w_simu6[i-1]
  pi6 <- Pi_sum_simu6[i-1]
  pi_s6 <- Pi_s_simu6[i-1]
  pi_w6 <- Pi_w_simu6[i-1]

  # Calculate change in variable size at each time step
  dN_s6 <- (N_s6 * (r_s * (1 - (N_s6/k_s)) - q_s * E6)) * dt
  dN_w6 <- (N_w6 * (r_w * (1 - (N_w6/k_w)) - q_w * E6)) * dt
  #dN_st6 <- (N_st6 * (r_s6 * (1 - (N_st6/k_s6)) - q_s6 * E_t6)) * dt
  #dN_wt6 <- (N_wt6 * (r_w6 * (1 - (N_wt6/k_w6)) - q_w6 * E_t6)) * dt
  dE6 <- (alpha * E6 * (p_s6 * q_s * N_s6 + p_w6 * q_w * N_w6 - c)) * dt
  #dE_test6 <- ((p_s6 * q_s6 * N_st6 + p_w6 * q_w6 * N_wt6) - c) * dt
  dC_s6 <- (q_s * N_s6 * E6) * dt
  dC_w6 <- (q_w * N_w6 * E6) * dt
  dcpue_s6 <- (C_s6 / E6) * dt
  dcpue_w6 <- (C_w6 / E6) * dt
  dPi_s6 <- (C_s6 * p_s6 - C_s6 * c) * dt
  dPi_w6 <- (C_w6 * p_w6 - C_w6 * c) * dt
  dPi6 <- (C_s6 * p_s6 + C_w6 * p_w6 - ((C_s6 + C_w6) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  N_w_simu6[i] <- N_w6 + dN_w6
  N_s_simu6[i] <- N_s6 + dN_s6
  #N_w_test_6[i] <- N_wt6 + dN_wt6
  #N_s_test_6[i] <- N_st6 + dN_st6
  E_simu6[i] <- E6 + dE6
  #E_test6[i] <- E_t6 + dE_test6
  C_s_simu6[i] <- C_s6 + dC_s6
  C_w_simu6[i] <- C_w6 + dC_w6
  cpue_s_simu6[i] <- cpue_s6 + dcpue_s6
  cpue_w_simu6[i] <- cpue_w6 + dcpue_w6
  Pi_sum_simu6[i] <- pi6 + dPi6
  Pi_s_simu6[i] <- pi_s6 + dPi_s6
  Pi_w_simu6[i] <- pi_w6 + dPi_w6  
  
}
```


```{r scenario 7 price ratio 0.25, echo = FALSE}
p_s7 <- 1
p_w7 <- 4
```

```{r, echo = FALSE}
#tset <- seq(from = 0, to = 500, length.out = 10000)

N_w_simu7 <- NaN*tset; N_w_simu7[1] <- N_w

N_s_simu7 <- NaN*tset; N_s_simu7[1] <- N_s

#N_w_test_7 <- NaN*tset; N_w_test_7[1] <- N_w

#N_s_test_7 <- NaN*tset; N_s_test_7[1] <- N_s

E_simu7 <- NaN*tset; E_simu7[1] <- E

#E_test7 <- NaN*tset; E_test7[1] <- E

C_s_simu7 <- NaN*tset; C_s_simu7[1] <- 1

C_w_simu7 <- NaN*tset; C_w_simu7[1] <- 1

cpue_s_simu7 <- NaN*tset; cpue_s_simu7[1] <- 1

cpue_w_simu7 <- NaN*tset; cpue_w_simu7[1] <- 1

Pi_sum_simu7 <- NaN*tset; Pi_sum_simu7[1] <- 2

Pi_s_simu7 <- NaN*tset; Pi_s_simu7[1] <- 1

Pi_w_simu7 <- NaN*tset; Pi_w_simu7[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w7 <- N_w_simu7[i-1]
  N_s7 <- N_s_simu7[i-1]
  #N_wt7 <- N_w_test_7[i-1]
  #N_st7 <- N_s_test_7[i-1]
  E7 <- E_simu7[i-1]
  #E_t7 <- E_test7[i-1]
  C_s7 <- C_s_simu7[i-1]
  C_w7 <- C_w_simu7[i-1]
  cpue_s7 <- cpue_s_simu7[i-1]
  cpue_w7 <- cpue_w_simu7[i-1]
  pi7 <- Pi_sum_simu7[i-1]
  pi_s7 <- Pi_s_simu7[i-1]
  pi_w7 <- Pi_w_simu7[i-1]

  # Calculate change in variable size at each time step
  dN_s7 <- (N_s7 * (r_s * (1 - (N_s7/k_s)) - q_s * E7)) * dt
  dN_w7 <- (N_w7 * (r_w * (1 - (N_w7/k_w)) - q_w * E7)) * dt
  #dN_st7 <- (N_st7 * (r_s7 * (1 - (N_st7/k_s7)) - q_s7 * E_t7)) * dt
  #dN_wt7 <- (N_wt7 * (r_w7 * (1 - (N_wt7/k_w7)) - q_w7 * E_t7)) * dt
  dE7 <- (alpha * E7 * (p_s7 * q_s * N_s7 + p_w7 * q_w * N_w7 - c)) * dt
  #dE_test7 <- ((p_s7 * q_s7 * N_st7 + p_w7 * q_w7 * N_wt7) - c) * dt
  dC_s7 <- (q_s * N_s7 * E7) * dt
  dC_w7 <- (q_w * N_w7 * E7) * dt
  dcpue_s7 <- (C_s7 / E7) * dt
  dcpue_w7 <- (C_w7 / E7) * dt
  dPi_s7 <- (C_s7 * p_s7 - C_s7 * c) * dt
  dPi_w7 <- (C_w7 * p_w7 - C_w7 * c) * dt
  dPi7 <- (C_s7 * p_s7 + C_w7 * p_w7 - ((C_s7 + C_w7) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu7[i] <- N_w7 + dN_w7
  N_s_simu7[i] <- N_s7 + dN_s7
  #N_w_test_7[i] <- N_wt7 + dN_wt7
  #N_s_test_7[i] <- N_st7 + dN_st7
  E_simu7[i] <- E7 + dE7
  #E_test7[i] <- E_t7 + dE_test7
  C_s_simu7[i] <- C_s7 + dC_s7
  C_w_simu7[i] <- C_w7 + dC_w7
  cpue_s_simu7[i] <- cpue_s7 + dcpue_s7
  cpue_w_simu7[i] <- cpue_w7 + dcpue_w7
  Pi_sum_simu7[i] <- pi7 + dPi7
  Pi_s_simu7[i] <- pi_s7 + dPi_s7
  Pi_w_simu7[i] <- pi_w7 + dPi_w7  
  
}
```


```{r scenario 8 price ratio 0.25, echo = FALSE}
# set up the parameter space
p_s8 <- 1
p_w8 <- 10
```

```{r, echo = FALSE}
#tset <- seq(from = 0, to = 500, length.out = 10000)

N_w_simu8 <- NaN*tset; N_w_simu8[1] <- N_w

N_s_simu8 <- NaN*tset; N_s_simu8[1] <- N_s

#N_w_test_8 <- NaN*tset; N_w_test_8[1] <- N_w

#N_s_test_8 <- NaN*tset; N_s_test_8[1] <- N_s

E_simu8 <- NaN*tset; E_simu8[1] <- E

#E_test8 <- NaN*tset; E_test8[1] <- E

C_s_simu8 <- NaN*tset; C_s_simu8[1] <- 1

C_w_simu8 <- NaN*tset; C_w_simu8[1] <- 1

cpue_s_simu8 <- NaN*tset; cpue_s_simu8[1] <- 1

cpue_w_simu8 <- NaN*tset; cpue_w_simu8[1] <- 1

Pi_sum_simu8 <- NaN*tset; Pi_sum_simu8[1] <- 2

Pi_s_simu8 <- NaN*tset; Pi_s_simu8[1] <- 1

Pi_w_simu8 <- NaN*tset; Pi_w_simu8[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w8 <- N_w_simu8[i-1]
  N_s8 <- N_s_simu8[i-1]
  #N_wt8 <- N_w_test_8[i-1]
  #N_st8 <- N_s_test_8[i-1]
  E8 <- E_simu8[i-1]
  #E_t8 <- E_test8[i-1]
  C_s8 <- C_s_simu8[i-1]
  C_w8 <- C_w_simu8[i-1]
  cpue_s8 <- cpue_s_simu8[i-1]
  cpue_w8 <- cpue_w_simu8[i-1]
  pi8 <- Pi_sum_simu8[i-1]
  pi_s8 <- Pi_s_simu8[i-1]
  pi_w8 <- Pi_w_simu8[i-1]

  # Calculate change in variable size at each time step
  dN_s8 <- (N_s8 * (r_s * (1 - (N_s8/k_s)) - q_s * E8)) * dt
  dN_w8 <- (N_w8 * (r_w * (1 - (N_w8/k_w)) - q_w * E8)) * dt
  #dN_st8 <- (N_st8 * (r_s8 * (1 - (N_st8/k_s8)) - q_s8 * E_t8)) * dt
  #dN_wt8 <- (N_wt8 * (r_w8 * (1 - (N_wt8/k_w8)) - q_w8 * E_t8)) * dt
  dE8 <- (alpha * E8 * (p_s8 * q_s * N_s8 + p_w8 * q_w * N_w8 - c)) * dt
  #dE_test8 <- ((p_s8 * q_s8 * N_st8 + p_w8 * q_w8 * N_wt8) - c) * dt
  dC_s8 <- (q_s * N_s8 * E8) * dt
  dC_w8 <- (q_w * N_w8 * E8) * dt
  dcpue_s8 <- (C_s8 / E8) * dt
  dcpue_w8 <- (C_w8 / E8) * dt
  dPi_s8 <- (C_s8 * p_s8 - C_s8 * c) * dt
  dPi_w8 <- (C_w8 * p_w8 - C_w8 * c) * dt
  dPi8 <- (C_s8 * p_s8 + C_w8 * p_w8 - ((C_s8 + C_w8) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu8[i] <- N_w8 + dN_w8
  N_s_simu8[i] <- N_s8 + dN_s8
  #N_w_test_8[i] <- N_wt8 + dN_wt8
  #N_s_test_8[i] <- N_st8 + dN_st8
  E_simu8[i] <- E8 + dE8
  #E_test8[i] <- E_t8 + dE_test8
  C_s_simu8[i] <- C_s8 + dC_s8
  C_w_simu8[i] <- C_w8 + dC_w8
  cpue_s_simu8[i] <- cpue_s8 + dcpue_s8
  cpue_w_simu8[i] <- cpue_w8 + dcpue_w8
  Pi_sum_simu8[i] <- pi8 + dPi8
  Pi_s_simu8[i] <- pi_s8 + dPi_s8
  Pi_w_simu8[i] <- pi_w8 + dPi_w8  
  
  
}
```


```{r, echo = FALSE}
run_model <- function(r_s, k_s, q_s, p_s, r_w, k_w, q_w, p_w, c){
 
  # Derive effort
 E <- ((- c + k_s * p_s * q_s + k_w * p_w * q_w) * r_s * r_w)  /
   (k_w * p_w * q_w^2 * r_s + k_s * p_s * q_s^2 * r_w) 
  
  # Derive weak stock biomass
 
  N_w <- (k_w * (c * q_w * r_s + k_s * p_s * q_s * (- q_w * r_s + q_s * r_w))) / 
    (k_w * p_w * q_w^2 * r_s + k_s * p_s * q_s^2 * r_w)
  
 # Derive strong stock biomass
 
   N_s <- (k_s * (c * q_s * r_w + k_w * p_w * q_w * (q_w * r_s - q_s * r_w))) /
     (k_w * p_w * q_w^2 * r_s + k_s * p_s * q_s^2 * r_w)
  
  # Build output
  output <- data.frame(E = E, N_s = N_s, N_w = N_w)
 
  # Return
  return(output)
 
 
}

sc_1 <- run_model(q_s = 0.02, q_w = 0.02, k_s = 4, k_w = 2, r_s = 1, r_w = 0.5, p_s = 1, p_w = 0.1, c = 0.05)
sc_2 <- run_model(q_s = 0.02, q_w = 0.02, k_s = 4, k_w = 2, r_s = 1, r_w = 0.5, p_s = 1, p_w = 0.2, c = 0.05)
sc_3 <- run_model(q_s = 0.02, q_w = 0.02, k_s = 4, k_w = 2, r_s = 1, r_w = 0.5, p_s = 1, p_w = 0.4, c = 0.05)
sc_4 <- run_model(q_s = 0.02, q_w = 0.02, k_s = 4, k_w = 2, r_s = 1, r_w = 0.5, p_s = 1, p_w = 1, c = 0.05)
sc_5 <- run_model(q_s = 0.02, q_w = 0.02, k_s = 4, k_w = 2, r_s = 1, r_w = 0.5, p_s = 1, p_w = 1.33, c = 0.05)
sc_6 <- run_model(q_s = 0.02, q_w = 0.02, k_s = 4, k_w = 2, r_s = 1, r_w = 0.5, p_s = 1, p_w = 2, c = 0.05)
sc_7 <- run_model(q_s = 0.02, q_w = 0.02, k_s = 4, k_w = 2, r_s = 1, r_w = 0.5, p_s = 1, p_w = 4, c = 0.05)
sc_8 <- run_model(q_s = 0.02, q_w = 0.02, k_s = 4, k_w = 2, r_s = 1, r_w = 0.5, p_s = 1, p_w = 10, c = 0.05)

sc_all <- bind_rows(sc_1, sc_2, sc_3, sc_4, sc_5, sc_6, sc_7, sc_8) %>% 
  rownames_to_column() %>% 
  rename(scenario = rowname) %>% 
  mutate(tset = 300) %>% 
  pivot_longer(cols = E:N_w,
               names_to = "variable",
               values_to = "value") %>% 
  mutate(price_ratio = case_when(
    scenario == "1" ~ "PR = 10",
    scenario == "2" ~ "PR = 5",
    scenario == "3" ~ "PR = 2.5",
    scenario == "4" ~ "PR = 1",
    scenario == "5" ~ "PR = 0.75",
    scenario == "6" ~ "PR = 0.5",
    scenario == "7" ~ "PR = 0.25",
    scenario == "8" ~ "PR = 0.1"
  )) %>% 
  pivot_wider(names_from = "variable",
              values_from = "value") %>% 
  mutate(b_values_s = N_s / k_s,
         b_values_w = N_w / k_w) %>% 
  pivot_longer(cols = N_s:N_w,
               names_to = "variable",
               values_to = "value") %>%
  pivot_longer(cols = b_values_s:b_values_w,
               names_to = "b_values",
               values_to = "b_v_k") %>% 
  pivot_longer(cols = E,
               names_to = "effort",
               values_to = "ef_value") %>% 
  mutate(variable = case_when(
    variable == "N_s" ~ "Ns*",
    variable == "N_w" ~ "Nw*"
  )) %>% 
  mutate(effort = case_when(
    effort == "E" ~ "E*"
  )) %>% 
  mutate(b_values = case_when(
    str_detect(b_values, "_w") ~ "Nw/Kw*",
    str_detect(b_values, "_s") ~ "Ns/Ks*"
  ))
```

```{r building df for the parameter space, echo = FALSE}
eq_par <- data.frame(parameter = c("q_w", "q_s", "k_w", "k_s", "r_w", "r_s", "p_s", "p_w", "c"),
                     "PR_10" =  c(0.05, 0.05, 4, 2, 1, 0.75, 1, 0.1, 0.05),
                     "PR_5" =   c(0.05, 0.05, 4, 2, 1, 0.75, 1, 0.2, 0.05),
                     "PR_2.5" = c(0.05, 0.05, 4, 2, 1, 0.75, 1, 0.4, 0.05),
                     "PR_1" =   c(0.05, 0.05, 4, 2, 1, 0.75, 1, 1, 0.05),
                     "PR_0.75" =c(0.05, 0.05, 4, 2, 1, 0.75, 1, 1.33, 0.05),
                     "PR_0.5" = c(0.05, 0.05, 4, 2, 1, 0.75, 1, 2, 0.05),
                     "PR_0.25" =c(0.05, 0.05, 4, 2, 1, 0.75, 1, 4, 0.05),
                     "PR_0.1" = c(0.05, 0.05, 4, 2, 1, 0.75, 1, 10, 0.05))

eq_par %>% 
  gt() %>%
  tab_header(title = "Parameter space for equilibrium points") %>% 
  cols_align(align = "center")
  
```


```{r, echo = FALSE}
effort_df <- cbind(E_simu1, E_simu2, E_simu3, E_simu4, E_simu5, E_simu6, E_simu7, E_simu8, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("E_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "7",
    str_detect(variable, "8") ~ "8")
         )

# effort_test_df <- cbind(E_test1, E_test2, E_test3, E_test4, E_test5, E_test6, E_test7, E_test8, tset) %>% 
#   as.data.frame() %>% 
#   pivot_longer(cols = starts_with("E_"),
#                names_to = "variable",
#                values_to = "value") %>% 
#   mutate(scenario_id = case_when(
#     str_detect(variable, "1") ~ "1",
#     str_detect(variable, "2") ~ "2",
#     str_detect(variable, "3") ~ "3",
#     str_detect(variable, "4") ~ "4",
#     str_detect(variable, "5") ~ "5",
#     str_detect(variable, "6") ~ "6",
#     str_detect(variable, "7") ~ "7",
#     str_detect(variable, "8") ~ "8")
#     )

nw_df <- cbind(N_w_simu1, N_w_simu2, N_w_simu3, N_w_simu4, N_w_simu5, N_w_simu6, N_w_simu7,N_w_simu8, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("N_w_simu"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "7",
    str_detect(variable, "8") ~ "8")) %>% 
  mutate(b_v_k = value/k_w)


ns_df <- cbind(N_s_simu1, N_s_simu2, N_s_simu3, N_s_simu4, N_s_simu5, N_s_simu6, N_s_simu7, N_s_simu8, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("N_s_simu"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "7",
    str_detect(variable, "8") ~ "8")) %>% 
  mutate(b_v_k = value/k_s)

# ns_t_df <- cbind(N_s_test_1, N_s_test_2, N_s_test_3, N_s_test_4, N_s_test_5, N_s_test_6, N_s_test_7, N_s_test_8, tset) %>% 
#   as.data.frame() %>% 
#   pivot_longer(cols = starts_with("N_s_test_"),
#                names_to = "variable",
#                values_to = "value") %>% 
#   mutate(scenario_id = case_when(
#     str_detect(variable, "1") ~ "1",
#     str_detect(variable, "2") ~ "2",
#     str_detect(variable, "3") ~ "3",
#     str_detect(variable, "4") ~ "4",
#     str_detect(variable, "5") ~ "5",
#     str_detect(variable, "6") ~ "6",
#     str_detect(variable, "7") ~ "7",
#     str_detect(variable, "8") ~ "8")) %>% 
#   mutate(b_v_k = value/4)
# 
# nw_t_df <- cbind(N_w_test_1, N_w_test_2, N_w_test_3, N_w_test_4, N_w_test_5, N_w_test_6, N_w_test_7, N_w_test_8, tset) %>% 
#   as.data.frame() %>% 
#   pivot_longer(cols = starts_with("N_w_test_"),
#                names_to = "variable",
#                values_to = "value") %>% 
#   mutate(scenario_id = case_when(
#     str_detect(variable, "1") ~ "1",
#     str_detect(variable, "2") ~ "2",
#     str_detect(variable, "3") ~ "3",
#     str_detect(variable, "4") ~ "4",
#     str_detect(variable, "5") ~ "5",
#     str_detect(variable, "6") ~ "6",
#     str_detect(variable, "7") ~ "7",
#     str_detect(variable, "8") ~ "8")) %>% 
#   mutate(b_v_k = value/2)

catch_s_df <- cbind(C_s_simu1, C_s_simu2, C_s_simu3, C_s_simu4, C_s_simu5, C_s_simu6, C_s_simu7, C_s_simu8, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("C_s_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "7",
    str_detect(variable, "8") ~ "8"))

catch_w_df <- cbind(C_w_simu1, C_w_simu2, C_w_simu3, C_w_simu4, C_w_simu5, C_w_simu6, C_w_simu7, C_w_simu8, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("C_w_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "7",
    str_detect(variable, "8") ~ "8"))


cpue_s_df <- cbind(cpue_s_simu1, cpue_s_simu2, cpue_s_simu3, cpue_s_simu4, cpue_s_simu5, cpue_s_simu6, cpue_s_simu7, cpue_s_simu8, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("cpue_s_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "7",
    str_detect(variable, "8") ~ "8"))


cpue_w_df <- cbind(cpue_w_simu1, cpue_w_simu2, cpue_w_simu3, cpue_w_simu4, cpue_w_simu5, cpue_w_simu6, cpue_w_simu7, cpue_w_simu8, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("cpue_w_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "7",
    str_detect(variable, "8") ~ "8"))

profits_df <- cbind(Pi_sum_simu1, Pi_sum_simu2, Pi_sum_simu3, Pi_sum_simu4, Pi_sum_simu5, Pi_sum_simu6, Pi_sum_simu7, Pi_sum_simu8, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("Pi_sum"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "7",
    str_detect(variable, "8") ~ "8"))

profits_s_df <- cbind(Pi_s_simu1, Pi_s_simu2, Pi_s_simu3, Pi_s_simu4, Pi_s_simu5, Pi_s_simu6, Pi_s_simu7, Pi_s_simu8, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("Pi_s_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "7",
    str_detect(variable, "8") ~ "8"))

profits_w_df <- cbind(Pi_w_simu1, Pi_w_simu2, Pi_w_simu3, Pi_w_simu4, Pi_w_simu5, Pi_w_simu6, Pi_w_simu7, Pi_w_simu8, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("Pi_w_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "7",
    str_detect(variable, "8") ~ "8"))

# Gathered the results from each model scenario run into a single df

var_full <- bind_rows(effort_df, nw_df, ns_df, catch_s_df, catch_w_df, cpue_s_df, cpue_w_df, profits_df, profits_w_df, profits_s_df)

# Tidy dataset for plotting

var_plot <- var_full %>%
  mutate(price_ratio = case_when(
    str_detect(scenario_id, "1") ~ "PR = 10",
    str_detect(scenario_id, "2") ~ "PR = 5",
    str_detect(scenario_id, "3") ~ "PR = 2.5",
    str_detect(scenario_id, "4") ~ "PR = 1",
    str_detect(scenario_id, "5") ~ "PR = 0.75",
    str_detect(scenario_id, "6") ~ "PR = 0.5",
    str_detect(scenario_id, "7") ~ "PR = 0.25",
    str_detect(scenario_id, "8") ~ "PR = 0.1"
  )) %>% 
  mutate(variable_clean = case_when(
    str_detect(variable, "N_w_test") ~ "Weak stock test",
    str_detect(variable, "N_s_test") ~ "Strong stock test",    
    str_detect(variable, "N_w") ~ "Weak stock",
    str_detect(variable, "N_s") ~ "Strong stock",
    str_detect(variable, "E_simu") ~ "Effort simulation",
    str_detect(variable, "E_test") ~ "Effort test",
    str_detect(variable, "Pi_sum_") ~ "Profit sum",
    str_detect(variable, "Pi_s") ~ "Strong stock profits",
    str_detect(variable, "Pi_w") ~ "Weak stock profits",
    str_detect(variable, "cpue_w") ~ "Weak stock CPUE",
    str_detect(variable, "cpue_s") ~ "Strong stock CPUE",
    str_detect(variable, "C_w") ~ "Weak stock catch",
    str_detect(variable, "C_s") ~ "Strong stock catch"
  ))
```

```{r, echo = FALSE, fig.height=4, fig.width=8}
equal_scales_EWS <-
  var_plot %>% 
  filter(variable_clean %in% c("Effort simulation", "Weak stock", "Strong stock")) %>% 
  ggplot() +
  geom_line(aes(x = tset, y = value, color = variable_clean),
            size = .8,
            alpha = .8,
            show.legend = T) +
  geom_point(data = sc_all, 
             aes(x = tset, y = value, color = variable)) +
  geom_point(data = sc_all,
             aes(x = tset, y = ef_value, color = effort)) +
  facet_wrap(~ factor(price_ratio, 
                      levels = c("PR = 10",
                                 "PR = 5",
                                 "PR = 2.5",
                                 "PR = 1",
                                 "PR = 0.75",
                                 "PR = 0.5",
                                 "PR = 0.25",
                                 "PR = 0.1")),
             nrow = 1) +
  scale_color_manual(values = c("#1B9E77", "#1B9E77", "#D95F02", "#7570B3",  "#D95F02", "#7570B3")) +
  scale_x_continuous(breaks = seq(0, 300, 100)) +
  labs(x = "",
       y = "Nw, Ns, E",
       color = "") +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        strip.text = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 12),
        axis.title.y = element_text(color = "black", size = 12, vjust = 2),
        axis.text = element_text(color = "black", size = 10),
        legend.position = "bottom")

# equal_scales_EWS_test <-
#   var_plot %>% 
#   filter(variable_clean %in% c("Effort test", "Weak stock test", "Strong stock test")) %>% 
#   ggplot() +
#   geom_line(aes(x = tset/100, y = value, color = variable_clean),
#             size = .8,
#             alpha = .8,
#             show.legend = T) +
#   geom_point(data = sc_all, 
#              aes(x = tset, y = value, color = variable)) +
#   geom_point(data = sc_all, 
#              aes(x = tset, y = ef_value, color = effort)) +
#   facet_wrap(~ factor(price_ratio, 
#                       levels = c("PR = 10",
#                                  "PR = 5",
#                                  "PR = 2.5",
#                                  "PR = 1",
#                                  "PR = 0.75",
#                                  "PR = 0.5",
#                                  "PR = 0.25",
#                                  "PR = 0.1")),
#              nrow = 1) +
#   scale_color_manual(values = c("#1B9E77", "#1B9E77", "#D95F02", "#7570B3",  "#D95F02", "#7570B3")) +
# #  scale_y_continuous(breaks = seq(0, 50, 10)) +
#   labs(x = "",
#        y = "Nw, Ns, E",
#        color = "") +
#   theme_bw() +
#   theme(panel.grid.major.x = element_blank(),
#         panel.grid.minor.x = element_blank(),
#         panel.grid.minor.y = element_blank(),
#         strip.background = element_rect(fill = "transparent"),
#         strip.text = element_text(color = "black", size = 11),
#         axis.title.x = element_text(color = "black", size = 12),
#         axis.title.y = element_text(color = "black", size = 12, vjust = 2),
#         axis.text = element_text(color = "black", size = 10),
#         legend.position = "bottom")

dif_scales <-
  var_plot %>% 
  filter(variable_clean %in% c("Strong stock", "Weak stock")) %>% 
  ggplot() +
  geom_line(aes(x = tset, y = b_v_k, color = variable_clean),
            size = .8,
            alpha = .8,
            show.legend = F) +
  geom_point(data = sc_all %>% filter(!variable == "E"), 
             aes(x = tset, y = b_v_k, color = b_values)) +
  facet_wrap(~ factor(price_ratio, 
                      levels = c("PR = 10",
                                 "PR = 5",
                                 "PR = 2.5",
                                 "PR = 1",
                                 "PR = 0.75",
                                 "PR = 0.5",
                                 "PR = 0.25",
                                 "PR = 0.1")),
             nrow = 1) +
  scale_color_manual(values = c("#D95F02", "#7570B3", "#D95F02", "#7570B3")) +
  scale_x_continuous(breaks = seq(0, 300, 100)) +
  labs(x = "",
       y = "N/K (Nw, Ns)",
       color = "") +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        strip.text = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 12, vjust = -2),
        axis.title.y = element_text(color = "black", size = 12, vjust = 2),
        axis.text = element_text(color = "black", size = 10),
        legend.position = "bottom")

equal_scales_CPE <-
  var_plot %>% 
  filter(variable_clean %in% c("Weak stock catch", "Strong stock catch", "Weak stock CPUE", "Strong stock CPUE")) %>% 
  ggplot() +
  geom_line(aes(x = tset, y = value, color = variable_clean),
            size = .8,
            alpha = .8,
            show.legend = T) +
  facet_wrap(~ factor(price_ratio, 
                      levels = c("PR = 10",
                                 "PR = 5",
                                 "PR = 2.5",
                                 "PR = 1",
                                 "PR = 0.75",
                                 "PR = 0.5",
                                 "PR = 0.25",
                                 "PR = 0.1")),
             nrow = 1) +
  scale_color_manual(values = c("#33A02C", "#FB9A99", "#E31A1C", "#FDBF6F")) +
  scale_x_continuous(breaks = seq(0, 300, 100)) +
  labs(x = "",
       y = "CPUE, Catch (S and W)",
       color = "") +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        strip.text = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 12),
        axis.title.y = element_text(color = "black", size = 12, vjust = 2),
        axis.text = element_text(color = "black", size = 10),
        legend.position = "bottom")

equal_scales_pi <-
  var_plot %>% 
  filter(variable_clean %in% c("Profit sum", "Weak stock profits", "Strong stock profits")) %>% 
  ggplot() +
  geom_line(aes(x = tset, y = value, color = variable_clean),
            size = .8,
            alpha = .8,
            show.legend = T) +
  facet_wrap(~ factor(price_ratio, 
                      levels = c("PR = 10",
                                 "PR = 5",
                                 "PR = 2.5",
                                 "PR = 1",
                                 "PR = 0.75",
                                 "PR = 0.5",
                                 "PR = 0.25",
                                 "PR = 0.1")),
             nrow = 1) +
  scale_color_manual(values = c("#FF7F00", "#CAB2D6", "#6A3D9A")) +
  scale_x_continuous(breaks = seq(0, 300, 100)) +
  labs(x = "Time",
       y = "Profits",
       color = "") +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        strip.text = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 12),
        axis.title.y = element_text(color = "black", size = 12, vjust = 2),
        axis.text = element_text(color = "black", size = 10),
        legend.position = "bottom")
```

```{r, fig.height=15, fig.width=10, echo = FALSE}
equal_scales_EWS /
  dif_scales /
  equal_scales_CPE /
  equal_scales_pi +
  plot_annotation(tag_level = "A") 
```

Panel A shows the time series dynamics for the strong and weak stocks, and effort. Panel B shows the same data but without effort for better comparison. Panel C shows the CPUE and catch for the strong and weak stocks separately. Panel D shows the profits for the strong and weak stocks, and the total profits for the fishery through time.

**Negative equilibrium points for the weak stock only occur at high enough prices of the strong stock. If the price ratio ($PR = P_s/P_w$) is smaller than 0.25, both stock have positive equilibrium points (at a growth rate ratio ($r_s/r_w$) of ~2).**

- I think this figure (or a better version of it) should also go in the paper, because it clearly shows how effort increases a lot when we consider two species, and how it drives both of them to extremely low levels for most of the scenarios, but not all. 




### Estimating equilibria for when both prices vary as a function of their catches

#### Equations

$$ 
\begin{align}
\frac{d N_s}{dt} &= N_S  r_s  (1 - (\frac{N_S}{K_s})) - q_s N_s^\beta_s E \\

\newline
\frac{d N_w}{dt} &= N_W  r_w  (1 - (\frac{N_W}{K_w})) - q_w N_w^\beta_w E \\

\newline
\frac{d E}{dt} &= \alpha  E  (A_s(q_s N_s^\beta E)^-f_s + A_w(q_w N_w^\beta_w E)^-f_w)- c)

\newline
\frac{d C_s}{dt} &= q N_s^\beta_s E

\newline
\frac{d C_w}{dt} &= q N_w^\beta_w E

\newline
\frac{d CPUE_s}{dt} &= \frac{C_s} {E}

\newline
\frac{d CPUE_w}{dt} &= \frac{C_w} {E}

\newline
\frac{d \pi_s}{dt} &= C_s A_s(q_s N_s^\beta E)^-f_s - C_s  c

\newline
\frac{d \pi_w}{dt} &= C_w A_w(q_w N_w^\beta_w E)^-f_w - C_w  c

\newline
\frac{d \pi}{dt} &= C_s  A_s(q_s N_s^\beta E)^-f_s + C_w  A_w(q_w N_w^\beta_w E)^-f_w - (C_s + C_w) * c

\end{align} 
$$

```{r scenario 1, echo = FALSE}
# set up the parameter space
q_s <- 0.02
q_w <- 0.02
k_s <- 4
k_w <- 2
r_s <- 1
r_w <- 0.99
alpha <- 1
c <- 0.05
A_w <- 1
A_s <- 1
beta_w1 <- 1
beta_s1 <- 1
f_w1 <- 0
f_s1 <- 0

# Initial values for the variables
N_w <- k_w

N_s <- k_s

E <- 0.5

# time steps
tset <- seq(from = 0, to = 200, length.out = 10000)

```

```{r discrete time simulation, echo = FALSE}
# nyr <- 200
# 
# data_c1 <- tibble(year = 1:nyr,
#                   N_s1 = NA,
#                   N_w1 = NA,
#                   E1 = NA,
#                   C_s1 = NA,
#                   C_w1 = NA,
#                   Pi_s1 = NA,
#                   Pi_w1 = NA)
# data_c1$N_s1[1] <- k_s
# 
# data_c1$N_w1[1] <- k_w
# 
# data_c1$E1[1] <- 0.5
# 
# data_c1$C_s1[1] <- 0
# 
# data_c1$C_w1[1] <- 0
# 
# data_c1$Pi_s1[1] <- 0
# 
# data_c1$Pi_w1[1] <- 0

# i <- 2
# for(i in 2:nyr) {
#   
#   N_s_prev1 <- data_c1$N_s1[i-1]
#   N_w_prev1 <- data_c1$N_w1[i-1]
#   E_prev1 <- data_c1$E1[i-1]
#   
#   
# 
#   # Calculate change in variable size at each time step
#   E_now1 <- (alpha * E_prev1 * 
#                (A_s * (q_s * N_s_prev1^beta_s1 * E_prev1)^-f_s1 * q_s * N_s_prev1^beta_s1 +
#                         A_w * (q_w * N_w_prev1^beta_w1 * E_prev1)^-f_w1 * q_w * N_w_prev1^beta_w1 - (c)))
#   C_s_now1 <- q_s * N_s_prev1^beta_s1 * E_now1
#   C_w_now1 <- q_w * N_w_prev1^beta_w1 * E_now1
#   SP_s_now1 <- r_s * N_s_prev1 * (1 - (N_s_prev1/k_s))
#   SP_w_now1 <- r_w * N_w_prev1 * (1 - (N_w_prev1/k_w))
#   N_s_now1 <- N_s_prev1 + SP_s_now1 - C_s_now1
#   N_w_now1 <- N_w_prev1 + SP_w_now1 - C_w_now1
#   Pi_s1 <- C_s_now1 * A_s * (q_s * N_s_now1^beta_s1 * E_now1)^-f_s1 - C_s_now1 * c
#   Pi_s1 <- C_w_now1 * A_w * (q_w * N_w_now1^beta_w1 * E_now1)^-f_w1 - C_w_now1 * c
#   #Pi1 <- (C_s1 * A_s * (q_s * N_s1^beta_s1 * E1)^-f_s1 + C_w1 * A_w * (q_w * N_w1^beta_w1 * E1)^-f_w1 - ((C_s1 + C_w1) * c)) * dt
#   
#   # calculate total variable size and store in holding vectors
#   
#   # record everything
#   data_c1$N_s1[i] <- N_s_now1
#   data_c1$N_w1[i] <- N_w_now1
#   data_c1$E1[i] <- E_now1
#   data_c1$C_s1[i] <- C_s_now1
#   data_c1$C_w1[i] <- C_w_now1
#   data_c1$Pi_s1[i] <- Pi_s1
#   data_c1$Pi_w1[i] <- Pi_w1
#   
# }
# 
# 
# data_c1 <- data_c1 %>% 
#   mutate(cpue_s = C_s1/E1,
#          cpue_w = C_w1/E1,
#          depletion_s = N_s1/k_s,
#          depletion_w = N_w1/k_w)
# 
# plot(N_s1 ~ year, data_c1)
# plot(N_w1 ~ year, data_c1)
# plot(cpue_w ~ year, data_c1)
```



```{r, echo = FALSE}
N_w_simu1 <- NaN*tset; N_w_simu1[1] <- N_w

N_s_simu1 <- NaN*tset; N_s_simu1[1] <- N_s

E_simu1 <- NaN*tset; E_simu1[1] <- E

C_s_simu1 <- NaN*tset; C_s_simu1[1] <- 0

C_w_simu1 <- NaN*tset; C_w_simu1[1] <- 0

cpue_s_simu1 <- NaN*tset; cpue_s_simu1[1] <- 0

cpue_w_simu1 <- NaN*tset; cpue_w_simu1[1] <- 0

Pi_sum_simu1 <- NaN*tset; Pi_sum_simu1[1] <- 0

Pi_s_simu1 <- NaN*tset; Pi_s_simu1[1] <- 0

Pi_w_simu1 <- NaN*tset; Pi_w_simu1[1] <- 0
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
# change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w1 <- N_w_simu1[i-1]
  N_s1 <- N_s_simu1[i-1]
  E1 <- E_simu1[i-1]
  C_s1 <- C_s_simu1[i-1]
  C_w1 <- C_w_simu1[i-1]
  cpue_s1 <- cpue_s_simu1[i-1]
  cpue_w1 <- cpue_w_simu1[i-1]
  pi1 <- Pi_sum_simu1[i-1]
  pi_s1 <- Pi_s_simu1[i-1]
  pi_w1 <- Pi_w_simu1[i-1]

  # Calculate change in variable size at each time step
  dN_s1 <- (r_s * N_s1 * (1 - (N_s1/k_s)) - (q_s * N_s1^beta_s1 * E1)) * dt
  dN_w1 <- (r_w * N_w1 * (1 - (N_w1/k_w)) - (q_w * N_w1^beta_w1 * E1)) * dt
  dE1 <- (alpha * E1 * (A_s * (q_s * N_s1^beta_s1 * E1)^-f_s1 * q_s * N_s1^beta_s1 +
                        A_w * (q_w * N_w1^beta_w1 * E1)^-f_w1 * q_w * N_w1^beta_w1 - (c))) * dt
  dC_s1 <- (q_s * N_s1^beta_s1 * E1) * dt
  dC_w1 <- (q_w * N_w1^beta_w1 * E1) * dt
  dcpue_s1 <- (C_s1 / E1) * dt
  dcpue_w1 <- (C_w1 / E1) * dt
  dPi_s1 <- (C_s1 * A_s * (q_s * N_s1^beta_s1 * E1)^-f_s1 - C_s1 * c) * dt
  dPi_w1 <- (C_w1 * A_w * (q_w * N_w1^beta_w1 * E1)^-f_w1 - C_w1 * c) * dt
  dPi1 <- (C_s1 * A_s * (q_s * N_s1^beta_s1 * E1)^-f_s1 + C_w1 * A_w * (q_w * N_w1^beta_w1 * E1)^-f_w1 - ((C_s1 + C_w1) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu1[i] <- N_w1 + dN_w1
  N_s_simu1[i] <- N_s1 + dN_s1
  E_simu1[i] <- E1 + dE1
  C_s_simu1[i] <- C_s1 + dC_s1
  C_w_simu1[i] <- C_w1 + dC_w1
  cpue_s_simu1[i] <- (C_s1 + dC_s1) / (E1 + dE1)
  cpue_w_simu1[i] <- (C_w1 + dC_w1) / (E1 + dE1)
  Pi_sum_simu1[i] <- pi1 + dPi1
  Pi_s_simu1[i] <- pi_s1 + dPi_s1
  Pi_w_simu1[i] <- pi_w1 + dPi_w1  
  
}  

```


```{r scenario 2, echo = FALSE}
# set up the parameter space
beta_w2 <- 1
beta_s2 <- 0.56
f_w2 <- 0
f_s2 <- 0.22

E <- 0.5
```

```{r, echo = FALSE}
N_w_simu2 <- NaN*tset; N_w_simu2[1] <- N_w

N_s_simu2 <- NaN*tset; N_s_simu2[1] <- N_s

E_simu2 <- NaN*tset; E_simu2[1] <- E

C_s_simu2 <- NaN*tset; C_s_simu2[1] <- 0

C_w_simu2 <- NaN*tset; C_w_simu2[1] <- 0

cpue_s_simu2 <- NaN*tset; cpue_s_simu2[1] <- 0

cpue_w_simu2 <- NaN*tset; cpue_w_simu2[1] <- 0

Pi_sum_simu2 <- NaN*tset; Pi_sum_simu2[1] <- 0

Pi_s_simu2 <- NaN*tset; Pi_s_simu2[1] <- 0

Pi_w_simu2 <- NaN*tset; Pi_w_simu2[1] <- 0

```


```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
# change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w2 <- N_w_simu2[i-1]
  N_s2 <- N_s_simu2[i-1]
  E2 <- E_simu2[i-1]
  C_s2 <- C_s_simu2[i-1]
  C_w2 <- C_w_simu2[i-1]
  cpue_s2 <- cpue_s_simu2[i-1]
  cpue_w2 <- cpue_w_simu2[i-1]
  pi2 <- Pi_sum_simu2[i-1]
  pi_s2 <- Pi_s_simu2[i-1]
  pi_w2 <- Pi_w_simu2[i-1]

  # Calculate change in variable size at each time step
  dN_s2 <- (r_s * N_s2 * (1 - (N_s2/k_s)) - (q_s * N_s2^beta_s2 * E2)) * dt
  dN_w2 <- (r_w * N_w2 * (1 - (N_w2/k_w)) - (q_w * N_w2^beta_w2 * E2)) * dt
  dE2 <- (alpha * E2 * (A_s * (q_s * N_s2^beta_s2 * E2)^-f_s2 * q_s * N_s2^beta_s2 +
                        A_w * (q_w * N_w2^beta_w2 * E2)^-f_w2 * q_w * N_w2^beta_w2 - (c))) * dt
  dC_s2 <- (q_s * N_s2^beta_s2 * E2) * dt
  dC_w2 <- (q_w * N_w2^beta_w2 * E2) * dt
  dcpue_s2 <- (C_s2 / E2) * dt
  dcpue_w2 <- (C_w2 / E2) * dt
  dPi_s2 <- (C_s2 * A_s * (q_s * N_s2^beta_s2 * E2)^-f_s2 - C_s2 * c) * dt
  dPi_w2 <- (C_w2 * A_w * (q_w * N_w2^beta_w2 * E2)^-f_w2 - C_w2 * c) * dt
  dPi2 <- (C_s2 * A_s * (q_s * N_s2^beta_s2 * E2)^-f_s2 + C_w2 * A_w * (q_w * N_w2^beta_w2 * E2)^-f_w2 - ((C_s2 + C_w2) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu2[i] <- N_w2 + dN_w2
  N_s_simu2[i] <- N_s2 + dN_s2
  E_simu2[i] <- E2 + dE2
  C_s_simu2[i] <- C_s2 + dC_s2
  C_w_simu2[i] <- C_w2 + dC_w2
  cpue_s_simu2[i] <- (C_s2 + dC_s2) / (E2 + dE2)
  cpue_w_simu2[i] <- (C_w2 + dC_w2) / (E2 + dE2)
  Pi_sum_simu2[i] <- pi2 + dPi2
  Pi_s_simu2[i] <- pi_s2 + dPi_s2
  Pi_w_simu2[i] <- pi_w2 + dPi_w2  
  
}  

plot(x = tset, y = cpue_s_simu2,
     col = "black")
lines(x = tset, y = cpue_w_simu2,
      col = "blue")
lines(x = tset, y = C_s_simu2,
      col = "red")
lines(x = tset, y = C_w_simu2,
      col = "orange")

```


```{r scenario 5, echo = FALSE}
# set up the parameter space
beta_w5 <- 0.56
beta_s5 <- 1
f_w5 <- 0
f_s5 <- 0

# Initial values for the variables
N_w <- k_w

N_s <- k_s

E <- 0.5
```

```{r, echo = FALSE}

N_w_simu5 <- NaN*tset; N_w_simu5[1] <- N_w

N_s_simu5 <- NaN*tset; N_s_simu5[1] <- N_s

E_simu5 <- NaN*tset; E_simu5[1] <- E

C_s_simu5 <- NaN*tset; C_s_simu5[1] <- 0

C_w_simu5 <- NaN*tset; C_w_simu5[1] <- 0

cpue_s_simu5 <- NaN*tset; cpue_s_simu5[1] <- 0

cpue_w_simu5 <- NaN*tset; cpue_w_simu5[1] <- 0

Pi_sum_simu5 <- NaN*tset; Pi_sum_simu5[1] <- 0

Pi_s_simu5 <- NaN*tset; Pi_s_simu5[1] <- 0

Pi_w_simu5 <- NaN*tset; Pi_w_simu5[1] <- 0

cost_ns_simu5 <- NaN*tset; cost_ns_simu5[1] <- 0.05

cost_nw_simu5 <- NaN*tset; cost_nw_simu5[1] <- 0.05

cost_sum_simu5 <- NaN*tset; cost_sum_simu5[1] <- 0.1

rev_ns_simu5 <- NaN*tset; rev_ns_simu5[1] <- 0

rev_nw_simu5 <- NaN*tset; rev_nw_simu5[1] <- 0

rev_sum_simu5 <- NaN*tset; rev_sum_simu5[1] <- 0

```


```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w5 <- N_w_simu5[i-1]
  N_s5 <- N_s_simu5[i-1]
  E5 <- E_simu5[i-1]
  C_s5 <- C_s_simu5[i-1]
  C_w5 <- C_w_simu5[i-1]
  cpue_s5 <- cpue_s_simu5[i-1]
  cpue_w5 <- cpue_w_simu5[i-1]
  pi5 <- Pi_sum_simu5[i-1]
  pi_s5 <- Pi_s_simu5[i-1]
  pi_w5 <- Pi_w_simu5[i-1]
  cost_ns5 <- cost_ns_simu5[i-1]
  cost_nw5 <- cost_nw_simu5[i-1]
  cost_sum5 <- cost_sum_simu5[i-1]
  rev_ns5 <- rev_ns_simu5[i-1]
  rev_nw5 <- rev_nw_simu5[i-1]
  rev_sum5 <- rev_sum_simu5[i-1]


  # Calculate change in variable size at each time step
    if(N_w5 > 0) {
    dN_s5 <- (r_s * N_s5 * (1 - (N_s5/k_s)) - (q_s * N_s5^beta_s5 * E5)) * dt
    dN_w5 <- (r_w * N_w5 * (1 - (N_w5/k_w)) - (q_w * N_w5^beta_w5 * E5)) * dt
    dE5 <- (alpha * E5 * (A_s * (q_s * N_s5^beta_s5 * E5)^-f_s5 * q_s * N_s5^beta_s5 +
                          A_w * (q_w * N_w5^beta_w5 * E5)^-f_w5 * q_w * N_w5^beta_w5 - (c))) * dt
    dC_s5 <- (q_s * N_s5^beta_s5 * E5) * dt
    dC_w5 <- (q_w * N_w5^beta_w5 * E5) * dt
    dPi_s5 <- (C_s5 * A_s * (q_s * N_s5^beta_s5 * E5)^-f_s5 - C_s5 * c) * dt
    dPi_w5 <- (C_w5 * A_w * (q_w * N_w5^beta_w5 * E5)^-f_w5 - C_w5 * c) * dt
    dPi5 <- (C_s5 * A_s * (q_s * N_s5^beta_s5 * E5)^-f_s5 + C_w5 * A_w * (q_w * N_w5^beta_w5 * E5)^-f_w5 - ((C_s5 + C_w5) * c)) * dt
    dcost_ns5 <- (cost_ns5 * E5/C_s5) * dt
    dcost_nw5 <- (cost_nw5 * E5/C_w5) * dt
    dcost_sum5 <- (E5 * (cost_nw5 + cost_ns5)/(C_s5 + C_w5)) * dt
    drev_ns5 <- (A_s * (q_s * N_s5^beta_s5 * E5)^-f_s5 * q_s * N_s5^beta_s5 * E5/C_s5) * dt
    drev_nw5 <- (A_w * (q_w * N_w5^beta_w5 * E5)^-f_w5 * q_s * N_w5^beta_w5 * E5/C_w5) * dt
    drev_sum5 <- ((A_s * (q_s * N_s5^beta_s5 * E5)^-f_s5 * q_s * N_s5^beta_s5 * E5 + 
                     A_w * (q_w * N_w5^beta_w5 * E5)^-f_w5 * q_w * N_w5^beta_w5 * E5/(C_s5 + C_w5))) * dt
  
  } else {
    # If N_w5 < 0, set each variable dependent on w to zero and calculate all the other ones only with the strong stock.
    dN_s5 <- (r_s * N_s5 * (1 - (N_s5/k_s)) - (q_s * N_s5^beta_s5 * E5)) * dt
    dN_w5 <- 0
    dE5 <- (alpha * E5 * (A_s * (q_s * N_s5^beta_s5 * E5)^-f_s5 * q_s * N_s5^beta_s5 - (c))) * dt
    dC_s5 <- (q_s * N_s5^beta_s5 * E5) * dt
    dC_w5 <- 0
    dPi_w5 <- 0
    dPi_s5 <- (C_s5 * A_s * (q_s * N_s5^beta_s5 * E5)^-f_s5 - (C_s5 * c)) * dt
    dPi5 <- (C_s5 * A_s * (q_s * N_s5^beta_s5 * E5)^-f_s5 - (C_s5 * c)) * dt
    dcost_ns5 <- (cost_ns5 * E5/C_s5) * dt
    dcost_nw5 <- 0
    dcost_sum5 <- ((E5 * cost_ns5)/C_s5) * dt
    drev_nw5 <- 0
    drev_ns5 <- (A_s * (q_s * N_s5^beta_s5 * E5)^-f_s5 * q_s * N_s5^beta_s5 * E5/C_s5) * dt
    drev_sum5 <- (A_s * (q_s * N_s5^beta_s5 * E5)^-f_s5 * q_s * N_s5^beta_s5 * E5/C_s5) * dt
  }
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu5[i] <- ifelse(N_w5 + dN_w5 < 0, 0, N_w5 + dN_w5)
  N_s_simu5[i] <- N_s5 + dN_s5
  E_simu5[i] <- E5 + dE5
  C_s_simu5[i] <- C_s5 + dC_s5
  C_w_simu5[i] <- ifelse(N_w5 + dN_w5 < 0, 0, C_w5 + dC_w5)
  cpue_s_simu5[i] <- (C_s5 + dC_s5) / (E5 + dE5)
  cpue_w_simu5[i] <- (C_w5 + dC_w5) / (E5 + dE5)
  Pi_sum_simu5[i] <- pi5 + dPi5
  Pi_s_simu5[i] <- pi_s5 + dPi_s5
  Pi_w_simu5[i] <- ifelse(N_w5 + dN_w5 < 0, 0, pi_w5 + dPi_w5)
  cost_ns_simu5[i] <- cost_ns5 + dcost_ns5
  cost_nw_simu5[i] <- ifelse(N_w5 + dN_w5 < 0, 0, cost_nw5 + dcost_nw5)
  cost_sum_simu5[i] <- cost_sum5 + dcost_sum5
  rev_ns_simu5[i] <- rev_ns5 + drev_ns5
  rev_nw_simu5[i] <- ifelse(N_w5 + dN_w5 < 0, 0, rev_nw5 + drev_nw5)
  rev_sum_simu5[i] <- rev_sum5 + drev_sum5
}


```


```{r scenario 7, echo = FALSE}
# set up the parameter space
beta_w7 <- 0.56
beta_s7 <- 0.56
f_w7 <- 0.22
f_s7 <- 0.22

# Initial values for the variables
N_w <- k_w

N_s <- k_s

E <- 0.5
```

```{r, echo = FALSE}

N_w_simu7 <- NaN*tset; N_w_simu7[1] <- N_w

N_s_simu7 <- NaN*tset; N_s_simu7[1] <- N_s

E_simu7 <- NaN*tset; E_simu7[1] <- E

C_s_simu7 <- NaN*tset; C_s_simu7[1] <- 0

C_w_simu7 <- NaN*tset; C_w_simu7[1] <- 0

cpue_s_simu7 <- NaN*tset; cpue_s_simu7[1] <- 0

cpue_w_simu7 <- NaN*tset; cpue_w_simu7[1] <- 0

Pi_sum_simu7 <- NaN*tset; Pi_sum_simu7[1] <- 0

Pi_s_simu7 <- NaN*tset; Pi_s_simu7[1] <- 0

Pi_w_simu7 <- NaN*tset; Pi_w_simu7[1] <- 0

cost_ns_simu7 <- NaN*tset; cost_ns_simu7[1] <- 0.05

cost_nw_simu7 <- NaN*tset; cost_nw_simu7[1] <- 0.05

cost_sum_simu7 <- NaN*tset; cost_sum_simu7[1] <- 0.1

rev_ns_simu7 <- NaN*tset; rev_ns_simu7[1] <- 0

rev_nw_simu7 <- NaN*tset; rev_nw_simu7[1] <- 0

rev_sum_simu7 <- NaN*tset; rev_sum_simu7[1] <- 0

```


```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w7 <- N_w_simu7[i-1]
  N_s7 <- N_s_simu7[i-1]
  E7 <- E_simu7[i-1]
  C_s7 <- C_s_simu7[i-1]
  C_w7 <- C_w_simu7[i-1]
  cpue_s7 <- cpue_s_simu7[i-1]
  cpue_w7 <- cpue_w_simu7[i-1]
  pi7 <- Pi_sum_simu7[i-1]
  pi_s7 <- Pi_s_simu7[i-1]
  pi_w7 <- Pi_w_simu7[i-1]
  cost_ns7 <- cost_ns_simu7[i-1]
  cost_nw7 <- cost_nw_simu7[i-1]
  cost_sum7 <- cost_sum_simu7[i-1]
  rev_ns7 <- rev_ns_simu7[i-1]
  rev_nw7 <- rev_nw_simu7[i-1]
  rev_sum7 <- rev_sum_simu7[i-1]

  # Calculate change in variable size at each time step
    if(N_w7 > 0) {
    dN_s7 <- (r_s * N_s7 * (1 - (N_s7/k_s)) - (q_s * N_s7^beta_s7 * E7)) * dt
    dN_w7 <- (r_w * N_w7 * (1 - (N_w7/k_w)) - (q_w * N_w7^beta_w7 * E7)) * dt
    dE7 <- (alpha * E7 * (A_s * (q_s * N_s7^beta_s7 * E7)^-f_s7 * q_s * N_s7^beta_s7 +
                          A_w * (q_w * N_w7^beta_w7 * E7)^-f_w7 * q_w * N_w7^beta_w7 - (c))) * dt
    dC_s7 <- (q_s * N_s7^beta_s7 * E7) * dt
    dC_w7 <- (q_w * N_w7^beta_w7 * E7) * dt
    dPi_s7 <- (C_s7 * A_s * (q_s * N_s7^beta_s7 * E7)^-f_s7 - C_s7 * c) * dt
    dPi_w7 <- (C_w7 * A_w * (q_w * N_w7^beta_w7 * E7)^-f_w7 - C_w7 * c) * dt
    dPi7 <- (C_s7 * A_s * (q_s * N_s7^beta_s7 * E7)^-f_s7 + C_w7 * A_w * (q_w * N_w7^beta_w7 * E7)^-f_w7 - ((C_s7 + C_w7) * c)) * dt
    dcost_ns7 <- (cost_ns7 * E7/C_s7) * dt
    dcost_nw7 <- (cost_nw7 * E7/C_w7) * dt
    dcost_sum7 <- (E7 * (cost_nw7 + cost_ns7)/(C_s7 + C_w7)) * dt
    drev_ns7 <- (A_s * (q_s * N_s7^beta_s7 * E7)^-f_s7 * q_s * N_s7^beta_s7 * E7/C_s7) * dt
    drev_nw7 <- (A_w * (q_w * N_w7^beta_w7 * E7)^-f_w7 * q_s * N_w7^beta_w7 * E7/C_w7) * dt
    drev_sum7 <- ((A_s * (q_s * N_s7^beta_s7 * E7)^-f_s7 * q_s * N_s7^beta_s7 * E7 + 
                     A_w * (q_w * N_w7^beta_w7 * E7)^-f_w7 * q_w * N_w7^beta_w7 * E7/(C_s7 + C_w7))) * dt
  
  } else {
    # If N_w7 < 0, set each variable dependent on w to zero and calculate all the other ones only with the strong stock.
    dN_s7 <- (r_s * N_s7 * (1 - (N_s7/k_s)) - (q_s * N_s7^beta_s7 * E7)) * dt
    dN_w7 <- 0
    dE7 <- (alpha * E7 * (A_s * (q_s * N_s7^beta_s7 * E7)^-f_s7 * q_s * N_s7^beta_s7 - (c))) * dt
    dC_s7 <- (q_s * N_s7^beta_s7 * E7) * dt
    dC_w7 <- 0
    dPi_w7 <- 0
    dPi_s7 <- (C_s7 * A_s * (q_s * N_s7^beta_s7 * E7)^-f_s7 - (C_s7 * c)) * dt
    dPi7 <- (C_s7 * A_s * (q_s * N_s7^beta_s7 * E7)^-f_s7 - (C_s7 * c)) * dt
    dcost_ns7 <- (cost_ns7 * E7/C_s7) * dt
    dcost_nw7 <- 0
    dcost_sum7 <- ((E7 * cost_ns7)/C_s7) * dt
    drev_nw7 <- 0
    drev_ns7 <- (A_s * (q_s * N_s7^beta_s7 * E7)^-f_s7 * q_s * N_s7^beta_s7 * E7/C_s7) * dt
    drev_sum7 <- (A_s * (q_s * N_s7^beta_s7 * E7)^-f_s7 * q_s * N_s7^beta_s7 * E7/C_s7) * dt
  }
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu7[i] <- ifelse(N_w7 + dN_w7 < 0, 0, N_w7 + dN_w7)
  N_s_simu7[i] <- N_s7 + dN_s7
  E_simu7[i] <- E7 + dE7
  C_s_simu7[i] <- C_s7 + dC_s7
  C_w_simu7[i] <- ifelse(N_w7 + dN_w7 < 0, 0, C_w7 + dC_w7)
  cpue_s_simu7[i] <- (C_s7 + dC_s7) / (E7 + dE7)
  cpue_w_simu7[i] <- (C_w7 + dC_w7) / (E7 + dE7)
  Pi_sum_simu7[i] <- pi7 + dPi7
  Pi_s_simu7[i] <- pi_s7 + dPi_s7
  Pi_w_simu7[i] <- ifelse(N_w7 + dN_w7 < 0, 0, pi_w7 + dPi_w7)
  cost_ns_simu7[i] <- cost_ns7 + dcost_ns7
  cost_nw_simu7[i] <- ifelse(N_w7 + dN_w7 < 0, 0, cost_nw7 + dcost_nw7)
  cost_sum_simu7[i] <- cost_sum7 + dcost_sum7
  rev_ns_simu7[i] <- rev_ns7 + drev_ns7
  rev_nw_simu7[i] <- ifelse(N_w7 + dN_w7 < 0, 0, rev_nw7 + drev_nw7)
  rev_sum_simu7[i] <- rev_sum7 + drev_sum7
}


```

```{r scenario 8, echo = FALSE}
# set up the parameter space
beta_w8 <- 0.56
beta_s8 <- 0.2
f_w8 <- 0.1
f_s8 <- 0.815

# Initial values for the variables
N_w <- k_w

N_s <- k_s

E <- 0.5
```

```{r, echo = FALSE}

N_w_simu8 <- NaN*tset; N_w_simu8[1] <- N_w

N_s_simu8 <- NaN*tset; N_s_simu8[1] <- N_s

E_simu8 <- NaN*tset; E_simu8[1] <- E

C_s_simu8 <- NaN*tset; C_s_simu8[1] <- 0

C_w_simu8 <- NaN*tset; C_w_simu8[1] <- 0

cpue_s_simu8 <- NaN*tset; cpue_s_simu8[1] <- 0

cpue_w_simu8 <- NaN*tset; cpue_w_simu8[1] <- 0

Pi_sum_simu8 <- NaN*tset; Pi_sum_simu8[1] <- 0

Pi_s_simu8 <- NaN*tset; Pi_s_simu8[1] <- 0

Pi_w_simu8 <- NaN*tset; Pi_w_simu8[1] <- 0

cost_ns_simu8 <- NaN*tset; cost_ns_simu8[1] <- 0.05

cost_nw_simu8 <- NaN*tset; cost_nw_simu8[1] <- 0.05

cost_sum_simu8 <- NaN*tset; cost_sum_simu8[1] <- 0.1

rev_ns_simu8 <- NaN*tset; rev_ns_simu8[1] <- 0

rev_nw_simu8 <- NaN*tset; rev_nw_simu8[1] <- 0

rev_sum_simu8 <- NaN*tset; rev_sum_simu8[1] <- 0
```


```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w8 <- N_w_simu8[i-1]
  N_s8 <- N_s_simu8[i-1]
  E8 <- E_simu8[i-1]
  C_s8 <- C_s_simu8[i-1]
  C_w8 <- C_w_simu8[i-1]
  cpue_s8 <- cpue_s_simu8[i-1]
  cpue_w8 <- cpue_w_simu8[i-1]
  pi8 <- Pi_sum_simu8[i-1]
  pi_s8 <- Pi_s_simu8[i-1]
  pi_w8 <- Pi_w_simu8[i-1]
  cost_ns8 <- cost_ns_simu8[i-1]
  cost_nw8 <- cost_nw_simu8[i-1]
  cost_sum8 <- cost_sum_simu8[i-1]
  rev_ns8 <- rev_ns_simu8[i-1]
  rev_nw8 <- rev_nw_simu8[i-1]
  rev_sum8 <- rev_sum_simu8[i-1]

  # Calculate change in variable size at each time step
  # If N_w8 > 0, calculate each variable for each time step like the equations below:
  if(N_w8 > 0) {
    dN_s8 <- (r_s * N_s8 * (1 - (N_s8/k_s)) - (q_s * N_s8^beta_s8 * E8)) * dt
    dN_w8 <- (r_w * N_w8 * (1 - (N_w8/k_w)) - (q_w * N_w8^beta_w8 * E8)) * dt
    dE8 <- (alpha * E8 * (A_s * (q_s * N_s8^beta_s8 * E8)^-f_s8 * q_s * N_s8^beta_s8 +
                          A_w * (q_w * N_w8^beta_w8 * E8)^-f_w8 * q_w * N_w8^beta_w8 - (c))) * dt
    dC_s8 <- (q_s * N_s8^beta_s8 * E8) * dt
    dC_w8 <- (q_w * N_w8^beta_w8 * E8) * dt
    dPi_s8 <- (C_s8 * A_s * (q_s * N_s8^beta_s8 * E8)^-f_s8 - (C_s8 * c)) * dt
    dPi_w8 <- (C_w8 * A_w * (q_w * N_w8^beta_w8 * E8)^-f_w8 - (C_w8 * c)) * dt
    dPi8 <- (C_s8 * A_s * (q_s * N_s8^beta_s8 * E8)^-f_s8 + 
               C_w8 * A_w * (q_w * N_w8^beta_w8 * E8)^-f_w8 - ((C_s8 + C_w8) * c)) * dt
    dcost_ns8 <- (cost_ns8 * E8/C_s8) * dt
    dcost_nw8 <- (cost_nw8 * E8/C_w8) * dt
    dcost_sum8 <- (E8 * (cost_nw8 + cost_ns8)/(C_s8 + C_w8)) * dt
    drev_ns8 <- (A_s * (q_s * N_s8^beta_s8 * E8)^-f_s8 * q_s * N_s8^beta_s8 * E8/C_s8) * dt
    drev_nw8 <- (A_w * (q_w * N_w8^beta_w8 * E8)^-f_w8 * q_s * N_w8^beta_w8 * E8/C_w8) * dt
    drev_sum8 <- ((A_s * (q_s * N_s8^beta_s8 * E8)^-f_s8 * q_s * N_s8^beta_s8 * E8 + 
                     A_w * (q_w * N_w8^beta_w8 * E8)^-f_w8 * q_w * N_w8^beta_w8 * E8/(C_s8 + C_w8))) * dt
  
  } else {
    # If N_w8 < 0, set each variable dependent on w to zero and calculate all the other ones only with the strong stock.
    dN_s8 <- (r_s * N_s8 * (1 - (N_s8/k_s)) - (q_s * N_s8^beta_s8 * E8)) * dt
    dN_w8 <- 0
    dE8 <- (alpha * E8 * (A_s * (q_s * N_s8^beta_s8 * E8)^-f_s8 * q_s * N_s8^beta_s8 - (c))) * dt
    dC_s8 <- (q_s * N_s8^beta_s8 * E8) * dt
    dC_w8 <- 0
    dPi_w8 <- 0
    dPi_s8 <- (C_s8 * A_s * (q_s * N_s8^beta_s8 * E8)^-f_s8 - (C_s8 * c)) * dt
    dPi8 <- (C_s8 * A_s * (q_s * N_s8^beta_s8 * E8)^-f_s8 - (C_s8 * c)) * dt
    dcost_ns8 <- (cost_ns8 * E8/C_s8) * dt
    dcost_nw8 <- 0
    dcost_sum8 <- ((E8 * cost_ns8)/C_s8) * dt
    drev_nw8 <- 0
    drev_ns8 <- (A_s * (q_s * N_s8^beta_s8 * E8)^-f_s8 * q_s * N_s8^beta_s8 * E8/C_s8) * dt
    drev_sum8 <- (A_s * (q_s * N_s8^beta_s8 * E8)^-f_s8 * q_s * N_s8^beta_s8 * E8/C_s8) * dt
  }
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu8[i] <- ifelse(N_w8 + dN_w8 < 0, 0, N_w8 + dN_w8)
  N_s_simu8[i] <- N_s8 + dN_s8 
  E_simu8[i] <- E8 + dE8
  C_s_simu8[i] <- C_s8 + dC_s8
  C_w_simu8[i] <- ifelse(N_w8 + dN_w8 < 0, 0, C_w8 + dC_w8)
  cpue_s_simu8[i] <- (C_s8 + dC_s8) / (E8 + dE8)
  cpue_w_simu8[i] <- (C_w8 + dC_w8) / (E8 + dE8)
  Pi_sum_simu8[i] <- pi8 + dPi8
  Pi_s_simu8[i] <- pi_s8 + dPi_s8
  Pi_w_simu8[i] <- ifelse(N_w8 + dN_w8 < 0, 0, pi_w8 + dPi_w8)
  cost_ns_simu8[i] <- cost_ns8 + dcost_ns8
  cost_nw_simu8[i] <- ifelse(N_w8 + dN_w8 < 0, 0, cost_nw8 + dcost_nw8)
  cost_sum_simu8[i] <- cost_sum8 + dcost_sum8
  rev_ns_simu8[i] <- rev_ns8 + drev_ns8
  rev_nw_simu8[i] <- ifelse(N_w8 + dN_w8 < 0, 0, rev_nw8 + drev_nw8)
  rev_sum_simu8[i] <- rev_sum8 + drev_sum8
  
}
```


- Plot cost per catch and price per catch as a function of abundance for the strong stock. Revenue/catch and cost/catch.
- Types of fishing profitabilities and subsidies in fisheries.
- FAD scenario

```{r, include = FALSE}
plot(x = tset, y = N_s_simu8,
     col = "purple", las = 1,
     type = "l",
     lwd = 2,
     xlab = "Strong stock abundance",
     ylab = "Strong stock price, cost",
     ylim = c(0, 4))
lines(x = tset, y = N_w_simu8,
     col = "black", type = "l",
     lwd = 2)
lines(x = tset, y = E_simu8,
     col = "blue", type = "l",
     lwd = 2)
legend(x = 3.5, y = 1.5e+74,
       legend = c("Revenue", "Cost"),
       col = c("purple", "black"),
       lwd = 2)
```


```{r, include = FALSE}
plot(x = log(N_s_simu8), y = log(cost_ns_simu8),
     col = "purple", las = 1,
     type = "l",
     lwd = 2,
     xlab = "Strong stock abundance",
     ylab = "Strong stock price, cost")
lines(x = log(N_s_simu8), y = rev_sum_simu8,
     col = "black", type = "l",
     lwd = 2)
legend(x = 3.5, y = 1.5e+74,
       legend = c("Revenue", "Cost"),
       col = c("purple", "black"),
       lwd = 2)
```


```{r, echo = FALSE}
effort_df <- cbind(E_simu1, E_simu2,E_simu5, E_simu7, E_simu8, tset) %>% #E_simu3, E_simu4, E_simu6
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("E_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    # str_detect(variable, "3") ~ "3",
    # str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "3",
    # str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "4",
    str_detect(variable, "8") ~ "5"))

nw_df <- cbind(N_w_simu1, N_w_simu2, N_w_simu5, N_w_simu7, N_w_simu8, tset) %>% # N_w_simu3, N_w_simu4, N_w_simu6,
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("N_w_simu"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    # str_detect(variable, "3") ~ "3",
    # str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "3",
    # str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "4",
    str_detect(variable, "8") ~ "5")) %>% 
  mutate(b_v_k = value/k_w)

ns_df <- cbind(N_s_simu1,N_s_simu2, N_s_simu5, N_s_simu7, N_s_simu8, tset) %>% # N_s_simu3, N_s_simu4, N_s_simu6,
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("N_s_simu"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    # str_detect(variable, "3") ~ "3",
    # str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "3",
    # str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "4",
    str_detect(variable, "8") ~ "5")) %>% 
  mutate(b_v_k = value/k_s)
 


catch_s_df <- cbind(C_s_simu1,C_s_simu2, C_s_simu5, C_s_simu7, C_s_simu8, tset) %>% #C_s_simu3, C_s_simu4, C_s_simu6,
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("C_s_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    # str_detect(variable, "3") ~ "3",
    # str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "3",
    # str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "4",
    str_detect(variable, "8") ~ "5"))


catch_w_df <- cbind(C_w_simu1,C_w_simu2, C_w_simu5, C_w_simu7, C_w_simu8, tset) %>% #C_w_simu3, C_w_simu4,  C_w_simu6,
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("C_w_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    # str_detect(variable, "3") ~ "3",
    # str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "3",
    # str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "4",
    str_detect(variable, "8") ~ "5"))


cpue_s_df <- cbind(cpue_s_simu1, cpue_s_simu2, cpue_s_simu5, cpue_s_simu7, cpue_s_simu8,tset) %>% #cpue_s_simu3, cpue_s_simu4,cpue_s_simu6,
 as.data.frame() %>% 
 pivot_longer(cols = starts_with("cpue_s_"),
              names_to = "variable",
              values_to = "value") %>% 
 mutate(scenario_id = case_when(
   str_detect(variable, "1") ~ "1",
   str_detect(variable, "2") ~ "2",
   # str_detect(variable, "3") ~ "3",
   # str_detect(variable, "4") ~ "4",
   str_detect(variable, "5") ~ "3",
   # str_detect(variable, "6") ~ "6",
   str_detect(variable, "7") ~ "4",
   str_detect(variable, "8") ~ "5"))



cpue_w_df <- cbind(cpue_w_simu1, cpue_w_simu2, cpue_w_simu5, cpue_w_simu7, cpue_w_simu8, tset) %>% #cpue_w_simu3, cpue_w_simu4, cpue_w_simu6, 
 as.data.frame() %>% 
 pivot_longer(cols = starts_with("cpue_w_"),
              names_to = "variable",
              values_to = "value") %>% 
 mutate(scenario_id = case_when(
   str_detect(variable, "1") ~ "1",
   str_detect(variable, "2") ~ "2",
   # str_detect(variable, "3") ~ "3",
   # str_detect(variable, "4") ~ "4",
   str_detect(variable, "5") ~ "3",
   # str_detect(variable, "6") ~ "6",
   str_detect(variable, "7") ~ "4",
   str_detect(variable, "8") ~ "5"))

profits_df <- cbind(Pi_sum_simu1, Pi_sum_simu2, Pi_sum_simu5, Pi_sum_simu7, Pi_sum_simu8, tset) %>% #Pi_sum_simu3, Pi_sum_simu4, Pi_sum_simu6,
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("Pi_sum"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    # str_detect(variable, "3") ~ "3",
    # str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "3",
    # str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "4",
    str_detect(variable, "8") ~ "5"))


profits_s_df <- cbind(Pi_s_simu1, Pi_s_simu2, Pi_s_simu5, Pi_s_simu7, Pi_s_simu8, tset) %>% # Pi_s_simu3, Pi_s_simu4,  Pi_s_simu6,
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("Pi_s_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    # str_detect(variable, "3") ~ "3",
    # str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "3",
    # str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "4",
    str_detect(variable, "8") ~ "5"))


profits_w_df <- cbind(Pi_w_simu1, Pi_w_simu2,  Pi_w_simu5, Pi_w_simu7, Pi_w_simu8, tset) %>% # Pi_w_simu3, Pi_w_simu4,Pi_w_simu6,
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("Pi_w_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    # str_detect(variable, "3") ~ "3",
    # str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "3",
    # str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "4",
    str_detect(variable, "8") ~ "5"))

 cost_ns_df <- cbind(cost_ns_simu5, cost_ns_simu7, cost_ns_simu8, tset) %>% 
   as.data.frame() %>%
   pivot_longer(cols = starts_with("cost_ns_"),
                names_to = "variable",
                values_to = "value") %>% 
   mutate(scenario_id = case_when(
     str_detect(variable, "5") ~ "3",
     str_detect(variable, "7") ~ "4",
     str_detect(variable, "8") ~ "5"))
 
 cost_nw_df <- cbind(cost_nw_simu5, cost_nw_simu7, cost_nw_simu8, tset) %>% 
   as.data.frame() %>% 
   pivot_longer(cols = starts_with("cost_nw_"),
                names_to = "variable",
                values_to = "value") %>%  
   mutate(scenario_id = case_when(
     str_detect(variable, "5") ~ "3",
     str_detect(variable, "7") ~ "4",
     str_detect(variable, "8") ~ "5"))
 
 cost_sum_df <- cbind(cost_sum_simu5, cost_sum_simu7, cost_sum_simu8, tset) %>% 
   as.data.frame() %>% 
   pivot_longer(cols = starts_with("cost_sum_"),
                names_to = "variable",
                values_to = "value") %>%  
   mutate(scenario_id = case_when(
     str_detect(variable, "5") ~ "3",
     str_detect(variable, "7") ~ "4",
     str_detect(variable, "8") ~ "5"))
 
 
 rev_ns_df <- cbind(rev_ns_simu5, rev_ns_simu7, rev_ns_simu8, tset) %>%  
   as.data.frame() %>% 
   pivot_longer(cols = starts_with("rev_ns_"),
                names_to = "variable",
                values_to = "value") %>%  
   mutate(scenario_id = case_when(
     str_detect(variable, "5") ~ "3",
     str_detect(variable, "7") ~ "4",
     str_detect(variable, "8") ~ "5"))
 
 rev_nw_df <- cbind(rev_nw_simu5, rev_nw_simu7, rev_nw_simu8, tset) %>%  
   as.data.frame() %>%
   pivot_longer(cols = starts_with("rev_nw_"),
                names_to = "variable",
                values_to = "value") %>%  
   mutate(scenario_id = case_when(
     str_detect(variable, "5") ~ "3",
     str_detect(variable, "7") ~ "4",
     str_detect(variable, "8") ~ "5"))
 
 rev_sum_df <- cbind(rev_sum_simu5, rev_sum_simu7, rev_sum_simu8, tset) %>%  
   as.data.frame() %>% 
   pivot_longer(cols = starts_with("rev_sum_"),
                names_to = "variable",
                values_to = "value") %>%  
   mutate(scenario_id = case_when(
     str_detect(variable, "5") ~ "3",
     str_detect(variable, "7") ~ "4",
     str_detect(variable, "8") ~ "5"))

# Gathered the results from each model scenario run into a single df

var_full_price <- bind_rows(effort_df, nw_df, ns_df, catch_s_df, catch_w_df, cpue_s_df, cpue_w_df,
                            cost_ns_df, cost_nw_df, cost_sum_df, rev_ns_df, rev_nw_df, rev_sum_df, profits_df, profits_w_df, profits_s_df)

# Tidy dataset for plotting

var_plot_price <- var_full_price %>%
   mutate(f_w = case_when(
     str_detect(scenario_id, "1") ~ 0,
     str_detect(scenario_id, "2") ~ 0,
     str_detect(scenario_id, "3") ~ 0.22,
     str_detect(scenario_id, "4") ~ 0.22,
     str_detect(scenario_id, "5") ~ 0.1,
     # str_detect(scenario_id, "6") ~ 0,
     # str_detect(scenario_id, "7") ~ 0.22,
     # str_detect(scenario_id, "8") ~ 0.57
   )) %>% 
  mutate(f_s = case_when(
     str_detect(scenario_id, "1") ~ 0,
     str_detect(scenario_id, "2") ~ 0.22,
     str_detect(scenario_id, "3") ~ 0,
     str_detect(scenario_id, "4") ~ 0.22,
     str_detect(scenario_id, "5") ~ 0.815,
     # str_detect(scenario_id, "6") ~ 0.22,
     # str_detect(scenario_id, "7") ~ 0.22,
     # str_detect(scenario_id, "8") ~ 0.57
   )) %>% 
   mutate(beta_w = case_when(
     str_detect(scenario_id, "1") ~ 1,
     str_detect(scenario_id, "2") ~ 1,
     str_detect(scenario_id, "3") ~ 0.56,
     str_detect(scenario_id, "4") ~ 0.56,
     str_detect(scenario_id, "5") ~ 0.56,
     # str_detect(scenario_id, "6") ~ 1,
     # str_detect(scenario_id, "7") ~ 0.56,
     # str_detect(scenario_id, "8") ~ 0.56
   )) %>% 
   mutate(beta_s = case_when(
     str_detect(scenario_id, "1") ~ 1,
     str_detect(scenario_id, "2") ~ 0.56,
     str_detect(scenario_id, "3") ~ 1,
     str_detect(scenario_id, "4") ~ 0.56,
     str_detect(scenario_id, "5") ~ 0.2,
     # str_detect(scenario_id, "6") ~ 0.56,
     # str_detect(scenario_id, "7") ~ 0.56,
     # str_detect(scenario_id, "8") ~ 0.56
   )) %>% 
  mutate(variable_clean = case_when(
    str_detect(variable, "N_w") ~ "Weak stock",
    str_detect(variable, "N_s") ~ "Strong stock",
    str_detect(variable, "E_simu") ~ "Effort simulation",
    str_detect(variable, "Pi_sum_") ~ "Profit sum",
    str_detect(variable, "Pi_s") ~ "Strong stock profits",
    str_detect(variable, "Pi_w") ~ "Weak stock profits",
    str_detect(variable, "cpue_w") ~ "Weak stock CPUE",
    str_detect(variable, "cpue_s") ~ "Strong stock CPUE",
    str_detect(variable, "C_w") ~ "Weak stock catch",
    str_detect(variable, "C_s") ~ "Strong stock catch",
    str_detect(variable, "cost_ns_") ~ "Strong stock cost/catch",
    str_detect(variable, "cost_nw_") ~ "Weak stock cost/catch",
    str_detect(variable, "cost_sum") ~ "Total cost/catch",
    str_detect(variable, "rev_ns_") ~ "Strong stock revenue/catch",
    str_detect(variable, "rev_nw_") ~ "Weak stock revenue/catch",
    str_detect(variable, "rev_sum") ~ "Revenue sum/catch",
  ))

```

```{r, echo = FALSE, fig.height=6, fig.width=8}
#test <- 
st_stock <- var_plot_price %>% 
  filter(variable_clean %in% c("Strong stock")) %>% 
  pivot_wider(names_from = variable_clean,
              values_from = value) %>% 
  clean_names() %>%
  select(-c(variable, b_v_k, f_w, f_s, beta_s, beta_w))
  
st_stock_cost <- var_plot_price %>% 
  filter(variable_clean %in% c("Strong stock cost/catch")) %>% 
  pivot_wider(names_from = variable_clean,
              values_from = value) %>% 
  clean_names() %>% 
  select(-c(variable, b_v_k, f_w, f_s, beta_s, beta_w))

st_stock_rev <- var_plot_price %>% 
  filter(variable_clean %in% c("Strong stock revenue/catch")) %>% 
  pivot_wider(names_from = variable_clean,
              values_from = value) %>% 
  clean_names() %>% 
  select(-c(variable, b_v_k, f_w, f_s, beta_s, beta_w))

st_join <- st_stock %>% 
  left_join(st_stock_cost, by = "tset") %>% 
  select(!ends_with(".x")) %>% 
  left_join(st_stock_rev, by = "tset") %>% 
  select(!ends_with(".y")) %>% 
 #mutate(strong_stock_cost_catch = log(strong_stock_cost_catch)) %>% 
  pivot_longer(cols = ends_with("_catch"),
               names_to = "econ_var_catch",
               values_to = "catch_rev_val") %>% 
  mutate(econ_var_catch = case_when(
    str_detect(econ_var_catch, "cost") ~ "Cost",
    str_detect(econ_var_catch, "revenue") ~ "Revenue"
  )) 

test <- bind_rows(st_stock, st_stock_cost, st_stock_rev) %>% 
  pivot_longer(cols = strong_stock_cost_catch:strong_stock_revenue_catch,
               names_to = "econ_var_catch",
               values_to = "catch_rev_val")
#check <- 
#strong_st_1 <-
test <- 
  var_plot_price %>%
    filter(variable_clean %in% c("Strong stock cost/catch", "Strong stock revenue/catch") & scenario_id %in% c("3", "4", "5")) %>% 
  select(!variable)


test_st_stock <- var_plot_price %>% 
    filter(variable_clean == "Strong stock" & scenario_id %in% c("3", "4", "5")) %>% 
  pivot_wider(names_from = "variable_clean",
               values_from = "value") %>% 
  clean_names() %>% 
  select(!variable) 

test_bind <- merge(x = test, y = test_st_stock,
                   by = c("tset", "f_w", "f_s", "beta_s", "beta_w", "scenario_id"),
                   all.x = TRUE) %>% 
  select(!b_v_k.x)

w_st_extinct <- data.frame(scenario_id = c("3", "4", "5"),
                           vline = c(0.6400630, 0.9183616, 1.171936))


test_bind %>%   
  ggplot() +
  geom_point(aes(x = log(strong_stock), y = log(value), color = variable_clean),
            size = .5) +
   geom_vline(data = w_st_extinct,
              aes(xintercept = vline),
              linetype = "dashed",
              alpha = 0.3) +
   facet_wrap(~ scenario_id,
              scales = "free_x") +
#  scale_x_continuous(breaks = seq(1.1, 1.4, .05)) +
  labs(x = "Log(Strong stock abundance (Ns))",
       y = "log(Strong stock revenue/catch), Log(Strong stock cost/catch)",
       color = "",
       title = "Strong st revenue/catch and strong stock cost/catch as a function of strong st abundance") +
  theme_bw() +
  theme(panel.grid = element_blank()) +
  guides(color = guide_legend(override.aes = list(size = 5)))


```

```{r, echo = FALSE, fig.width=8, include = FALSE}
w_stock <- var_plot_price %>% 
  filter(scenario_id == "5" &
           variable_clean %in% c("Weak stock")) %>% 
  pivot_wider(names_from = variable_clean,
              values_from = value) %>% 
  clean_names()
  
w_stock_cost <- var_plot_price %>% 
  filter(scenario_id == "5" &
           variable_clean %in% c("Weak stock cost/catch")) %>% 
  pivot_wider(names_from = variable_clean,
              values_from = value) %>% 
  clean_names()

w_stock_rev <- var_plot_price %>% 
  filter(scenario_id == "5" &
           variable_clean %in% c("Weak stock revenue/catch")) %>% 
  pivot_wider(names_from = variable_clean,
              values_from = value) %>% 
  clean_names()

w_join <- w_stock %>% 
  left_join(w_stock_cost, by = "tset") %>% 
  select(!ends_with(".x")) %>% 
  left_join(w_stock_rev, by = "tset") %>% 
  select(-c(variable, scenario_id.y, b_v_k, f_w, f_s, beta_s, beta_w)) %>% 
  #mutate(weak_stock_cost_catch = log(weak_stock_cost_catch)) %>% 
  pivot_longer(cols = ends_with("_catch"),
               names_to = "econ_var_catch",
               values_to = "catch_rev_val") %>% 
  mutate(econ_var_catch = case_when(
    str_detect(econ_var_catch, "cost") ~ "Cost",
    str_detect(econ_var_catch, "revenue") ~ "Revenue"
  ))

test <- var_plot_price %>% 
  filter(scenario_id == "5" &
           variable_clean %in% c("Weak stock")) %>% 
  pivot_wider(names_from = variable_clean,
              values_from = value) %>% 
  clean_names()

#check <- 
weak_st_1 <-
  w_join %>%   
  ggplot() +
  geom_line(aes(x = log1p(weak_stock), y = log(catch_rev_val), color = econ_var_catch),
            size = .5) +
  labs(x = "Log(Weak stock abundance (Nw))",
       y = "Weak stock revenue/catch, Log(Weak stock cost/catch)",
       color = "",
       title = "Weak st revenue/catch and weak st cost/catch as a function of weak st abundance") +
  theme_bw() +
  guides(color = guide_legend(override.aes = list(size = 5)))
```

```{r, echo = FALSE}
stocks <- var_plot_price %>% 
  filter(scenario_id == "5" &
           variable_clean %in% c("Weak stock", "Strong stock")) %>% 
  pivot_wider(names_from = variable_clean,
              values_from = value) %>% 
  clean_names()
  
stock_cost_sum <- var_plot_price %>% 
  filter(scenario_id == "5" &
           variable_clean %in% c("Total cost/catch")) %>% 
  pivot_wider(names_from = variable_clean,
              values_from = value) %>% 
  clean_names()

stock_rev_sum <- var_plot_price %>% 
  filter(scenario_id == "5" &
           variable_clean %in% c("Revenue sum/catch")) %>% 
  pivot_wider(names_from = variable_clean,
              values_from = value) %>% 
  clean_names()

all_join <- stocks %>% 
  left_join(stock_cost_sum, by = "tset") %>% 
  select(!ends_with(".x")) %>% 
  left_join(stock_rev_sum, by = "tset") %>% 
  select(-c(variable, scenario_id.y, b_v_k, f_w, f_s, beta_s, beta_w)) %>% 
  #mutate(total_cost_catch = log(total_cost_catch)) %>% 
  pivot_longer(cols = ends_with("_catch"),
               names_to = "econ_var_catch",
               values_to = "catch_rev_val") %>% 
  mutate(econ_var_catch = case_when(
    str_detect(econ_var_catch, "cost") ~ "Cost",
    str_detect(econ_var_catch, "revenue") ~ "Revenue"
  ))


strong_st2 <-
  all_join %>%
  ggplot() +
  geom_point(aes(x = log(strong_stock), y = log(catch_rev_val), color = econ_var_catch),
            size = .5) +
  labs(x = "Log(Strong stock abundance (Ns))",
       y = "Log(total revenue/catch), Log(total cost/catch)",
       color = "",
       title = "Total revenue/catch and total cost/catch as a function of strong stock abundance") +
  theme_bw() +
  guides(color = guide_legend(override.aes = list(size = 5)))

weak_st2 <- 
  all_join %>%
  ggplot() +
  geom_point(aes(x = log1p(weak_stock), y = log(catch_rev_val), color = econ_var_catch),
            size = .5) +
  labs(x = "Log(Weak stock abundance (Nw) + 1)",
       y = "",
       color = "",
       title = "Total revenue/catch and total cost/catch as a function of weak stock abundance") +
  theme_bw() +
  guides(color = guide_legend(override.aes = list(size = 5)))
```

```{r, fig.height=10, fig.width=8, echo = FALSE}
# total_plots <-
#   grid.arrange(patchworkGrob(strong_st2 /
#   weak_st2),
#   left = "Total revenue/catch, Log(Total cost/catch)")
# 
# 
# (strong_st_1 /
#     weak_st_1)

```

```{r, echo = FALSE}
equal_scales_EWS_fcn <-
  var_plot_price %>% 
  filter(variable_clean %in% c("Effort simulation")) %>% 
  ggplot() +
  geom_line(aes(x = tset, y = value, color = variable_clean),
            size = .8,
            alpha = .8,
            show.legend = T) +
  facet_wrap(~ scenario_id,
             nrow = 1) +
  scale_color_manual(values = c("#A50E82FF")) +
  scale_x_continuous(breaks = seq(0, 200, 100),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 30, 10),
                     expand = c(0,0.5)) +
  labs(x = "",
       y = "Fishing Effort",
       color = "") +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.spacing = unit(5, "mm"),
        strip.background = element_rect(fill = "transparent"),
        strip.text = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 12),
        axis.title.y = element_text(color = "black", size = 12, vjust = 2),
        axis.text = element_text(color = "black", size = 10),
        legend.position = "bottom")

dif_scales_fcn <-
  var_plot_price %>% 
  filter(variable_clean %in% c("Strong stock", "Weak stock")) %>% 
  ggplot() +
  geom_hline(yintercept = 0.5,
              linetype = "dashed",
              color = "grey40",
              alpha = 0.8) +
  geom_hline(yintercept = 0.25,
              linetype = "dotted",
              color = "grey40",
              alpha = 0.8) +
  geom_line(aes(x = tset, y = b_v_k, color = variable_clean),
            size = .8,
            alpha = .8,
            show.legend = T) +
  facet_wrap(~ scenario_id,
             nrow = 1) +
  scale_color_manual(values = c("#6A9E1FFF", "#052F61FF")) +
  scale_x_continuous(breaks = seq(0, 200, 100),
                     expand = c(0,0)) +
  labs(x = "",
       y = "B/K",
       color = "") +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.spacing = unit(5, "mm"),
        strip.background = element_rect(fill = "transparent"),
        strip.text = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 12, vjust = -2),
        axis.title.y = element_text(color = "black", size = 12, vjust = 2),
        axis.text = element_text(color = "black", size = 10),
        legend.position = "bottom")

equal_scales_catch_fcn <-
  var_plot_price %>% 
  filter(variable_clean %in% c("Weak stock catch", "Strong stock catch")) %>% 
  ggplot() +
  geom_line(aes(x = tset, y = value, color = variable_clean),
            size = .8,
            alpha = .8,
            show.legend = T) +
  facet_wrap(~ scenario_id,
             nrow = 1) +
  scale_color_manual(values = c("#33A02C", "#FB9A99")) +
  scale_x_continuous(breaks = seq(0, 200, 100),
                     expand = c(0,0)) +
  labs(x = "",
       y = "Catch",
       color = "") +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.spacing = unit(5, "mm"),
        strip.background = element_rect(fill = "transparent"),
        strip.text = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 12),
        axis.title.y = element_text(color = "black", size = 12, vjust = 2),
        axis.text = element_text(color = "black", size = 10),
        legend.position = "bottom")


equal_scales_cpue_fcn <-
  var_plot_price %>% 
  filter(variable_clean %in% c("Weak stock CPUE", "Strong stock CPUE")) %>% 
  ggplot() +
  geom_line(aes(x = tset, y = value, color = variable_clean),
            size = .8,
            alpha = .8,
            show.legend = T) +
  facet_wrap(~ scenario_id,
             nrow = 1) +
  scale_color_manual(values = c("#E31A1C", "#FDBF6F")) +
  scale_x_continuous(breaks = seq(0, 200, 100),
                     expand = c(0,0)) +
  labs(x = "",
       y = "CPUE",
       color = "") +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.spacing = unit(5, "mm"),
        strip.background = element_rect(fill = "transparent"),
        strip.text = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 12),
        axis.title.y = element_text(color = "black", size = 12, vjust = 2),
        axis.text = element_text(color = "black", size = 10),
        legend.position = "bottom")


equal_scales_pi_fcn <-
  var_plot_price %>% 
  filter(variable_clean %in% c("Profit sum", "Weak stock profits", "Strong stock profits")) %>% 
  ggplot() +
  geom_line(aes(x = tset, y = value, color = variable_clean),
            size = .8,
            alpha = .8,
            show.legend = T) +
  facet_wrap(~ scenario_id,
             nrow = 1) +
  scale_color_manual(values = c("#FF7F00", "#CAB2D6", "#6A3D9A")) +
  scale_x_continuous(breaks = seq(0, 200, 100),
                     expand = c(0,0)) +
  labs(x = "Time",
       y = "Profits",
       color = "") +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.spacing = unit(5, "mm"),
        strip.background = element_rect(fill = "transparent"),
        strip.text = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 12),
        axis.title.y = element_text(color = "black", size = 12, vjust = 2),
        axis.text = element_text(color = "black", size = 10),
        legend.position = "bottom")
```

```{r, fig.height=12, fig.width=8, echo = FALSE, warning=FALSE}
fcn_plot <-
  equal_scales_EWS_fcn /
   dif_scales_fcn /
  equal_scales_catch_fcn /
    equal_scales_cpue_fcn /
     equal_scales_pi_fcn +
  plot_annotation(tag_levels = "A") +
  theme(panel.grid.major = element_blank())

fcn_plot

# ggsave(file.path(outdir, "p_fcn.png"), plot = fcn_plot,
#        height = 10, width = 8, bg = "white", dpi = 300)
```


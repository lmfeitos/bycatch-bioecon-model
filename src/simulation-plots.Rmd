---
title: "simulation-plots"
author: "Leonardo Feitosa"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
library(tidyverse)
library(here)
library(patchwork)
library(gt)
library(paletteer)

# file path
basedir <- "G:/Meu Drive/PhD Project - Fisheries bycatch/Bycatch project/Chapter 1/analyses/"
outdir <- file.path(basedir, "model_outs") # calls present data from raster files
```

```{r, include = FALSE}
# Results from the parameter per parameter simulations

output_s_ranges_w_one <- read_csv(file.path(outdir, "output_s_ranges_w_one.csv"))

#output_s_ranges_w_ranges2 <- read_csv(file.path(outdir, "output_s_ranges_w_ranges2.csv"))

output_w_ranges_s_one <- read_csv(file.path(outdir, "output_w_ranges_s_one.csv"))

output_s_ranges_w_zero <- read_csv(file.path(outdir, "output_s_ranges_w_zero.csv"))

output_w_ranges_s_zero <- read_csv(file.path(outdir, "output_w_ranges_s_zero.csv"))

output_test <- read_csv(file.path(outdir, "output_ranges_test.csv"))  

output_weak_test <- read_csv(file.path(outdir, "output_weak_test.csv"))

output_r_test <- read_csv(file.path(outdir, "output_r_ranges.csv"))

output_r_test_2 <- read_csv(file.path(outdir, "output_fcn_tests2.csv"))

output_q_test <- read_csv(file.path(outdir, "output_q_ranges.csv"))

#output_full <- read_csv(file.path(outdir, "output_full.csv"))
```

```{r, echo = FALSE}
# read in the output from the test with prices varying as a function of catch

## only parameters
output_fcn_test_param <- read_csv(file.path(outdir, "output_fcn_test_param.csv"))

## pw as a function of catch
output_fcn_test_pw <- read_csv(file.path(outdir, "output_fcn_test_pw.csv"))

## ps as a function of catch
output_fcn_test_ps <- read_csv(file.path(outdir, "output_fcn_test_ps.csv"))

## pw and ps as a function of catch
output_fcn_test_pw_ps <- read_csv(file.path(outdir, "output_fcn_test_pw_ps.csv"))
```


```{r data wrangling, echo = FALSE}
output_test_updated <- output_test %>% 
  pivot_wider(names_from = "variables",
              values_from = "values") %>% 
  mutate(b_values_s = N_s / k_s,
         b_values_w = N_w / k_w) %>% 
  pivot_longer(cols = E:N_w,
               names_to = "variables",
               values_to = "values") %>% 
  pivot_longer(cols = starts_with("b_values"),
               names_to = "b_stocks",
               values_to = "b_v_k") %>% 
  mutate(vuln_ratio = (q_s/r_s) / (q_w/r_w))


# Updated dataset to be used in the analyses
s_w_range_proc <- output_s_ranges_w_one %>% 
  mutate(b_v_k_s = N_s / k_s,
         b_v_k_w = N_w / k_w) %>% 
  # pivot_longer(cols = N_s:N_w,
  #              names_to = "variables",
  #              values_to = "values") %>% 
  # pivot_longer(cols = starts_with("b_values"),
  #              names_to = "b_stocks",
  #              values_to = "b_v_k") %>% 
  mutate(vuln_ratio_w = (q_w/r_w) / (q_s/r_s)) %>% 
  mutate(vuln_ratio_s = (q_s/r_s) / (q_w/r_w)) %>% 
  mutate(vuln_ratio_w = round(vuln_ratio_w, 5),
         vuln_ratio_s = round(vuln_ratio_s, 5)) %>% 
  mutate(st_stock_rev = (p_s * q_s * k_s) / c) %>% 
  mutate(w_stock_rev = (p_w * q_w * k_w) / c)

# s_w_range_proc2 <- output_s_ranges_w_ranges2 %>% 
#   mutate(b_values_s = N_s / k_s,
#          b_values_w = N_w / k_w) %>% 
#   pivot_longer(cols = E:N_w,
#                names_to = "variables",
#                values_to = "values") %>% 
#   pivot_longer(cols = starts_with("b_values"),
#                names_to = "b_stocks",
#                values_to = "b_v_k") %>% 
#   mutate(vuln_ratio = (q_w/r_w) / (q_s/r_s)) %>% 
#   mutate(st_stock_rev = (p_s * q_s * k_s) / c) %>% 
#   mutate(w_stock_rev = (p_w * q_w * k_w) / c)

w_s_range_proc <- output_w_ranges_s_one %>% 
  mutate(b_v_k_s = N_s / k_s,
         b_v_k_w = N_w / k_w) %>% 
  # pivot_longer(cols = N_s:N_w,
  #              names_to = "variables",
  #              values_to = "values") %>% 
  # pivot_longer(cols = starts_with("b_values"),
  #              names_to = "b_stocks",
  #              values_to = "b_v_k") %>% 
  mutate(vuln_ratio_w = (q_w/r_w) / (q_s/r_s)) %>% 
  mutate(vuln_ratio_s = (q_s/r_s) / (q_w/r_w)) %>% 
  mutate(vuln_ratio_w = round(vuln_ratio_w, 5),
         vuln_ratio_s = round(vuln_ratio_s, 5)) %>% 
  mutate(st_stock_rev = (p_s * q_s * k_s) / c) %>% 
  mutate(w_stock_rev = (p_w * q_w * k_w) / c)

s_w_zero_proc <- output_s_ranges_w_zero %>% 
  filter(r_s > r_w) %>% 
  mutate(b_values_s = N_s / k_s,
         b_values_w = N_w / k_w) %>% 
  pivot_longer(cols = E:N_w,
               names_to = "variables",
               values_to = "values") %>% 
  pivot_longer(cols = starts_with("b_values"),
               names_to = "b_stocks",
               values_to = "b_v_k") %>% 
  mutate(vuln_ratio_w = (q_w/r_w) / (q_s/r_s)) %>%
  mutate(vuln_ratio_s = (q_s/r_s) / (q_w/r_w)) %>% 
  mutate(st_stock_rev = (p_s * q_s * k_s) / c) %>% 
  mutate(w_stock_rev = (p_w * q_w * k_w) / c)

w_s_zero_proc <- output_w_ranges_s_zero %>%  
  filter(r_s > r_w) %>% 
  mutate(b_values_s = N_s / k_s,
         b_values_w = N_w / k_w) %>% 
  pivot_longer(cols = E:N_w,
               names_to = "variables",
               values_to = "values") %>% 
  pivot_longer(cols = starts_with("b_values"),
               names_to = "b_stocks",
               values_to = "b_v_k") %>% 
  mutate(vuln_ratio_w = (q_w/r_w) / (q_s/r_s)) %>% 
  mutate(vuln_ratio_s = (q_s/r_s) / (q_w/r_w)) %>% 
  mutate(st_stock_rev = (p_s * q_s * k_s) / c) %>% 
  mutate(w_stock_rev = (p_w * q_w * k_w) / c)

output_r_test_proc <- output_r_test %>% 
  mutate(b_values_s = N_s / k_s,
         b_values_w = N_w / k_w) %>% 
  pivot_longer(cols = E:N_w,
               names_to = "variables",
               values_to = "values") %>% 
  pivot_longer(cols = starts_with("b_values"),
               names_to = "b_stocks",
               values_to = "b_v_k") %>% 
  mutate(vuln_ratio = (q_s/r_s) / (q_w/r_w))

output_q_test_proc <- output_q_test %>% 
  pivot_wider(names_from = "variables",
              values_from = "values") %>% 
  mutate(b_values_s = N_s / k_s,
         b_values_w = N_w / k_w) %>% 
  pivot_longer(cols = E:N_w,
               names_to = "variables",
               values_to = "values") %>% 
  pivot_longer(cols = starts_with("b_values"),
               names_to = "b_stocks",
               values_to = "b_v_k") %>% 
  pivot_wider(names_from = "stock_q",
              values_from = "q") %>% 
  mutate(vuln_ratio = (q_s/r_s) / (q_w/r_w))
```

```{r, echo = FALSE}
# filtering for B/K < 0.1 for all scenarios
s_w_zero_proc %>% 
  filter(variables == "N_w" & b_stocks == "b_values_w" & b_v_k >= 0 & b_v_k <= 0.1) %>% 
  mutate(mean_ps = mean(p_s))
```


# Results from the parameter per parameter simulation


## Model equations:

- Strong stock size ($N_s$)

$$
N_s = r_s (1 - \frac{N_s}{K_s}) - q_s E
$$

- Weak stock size ($N_w$):

$$
N_w = r_w (1 - \frac{N_w}{K_w}) - q_w E
$$

- Effort ($E$):

$$
E = (p_s q_s N_s + p_w q_w N_w) - C
$$

## Equilibrium points for the three variables:

- Strong stock ($N_s$):

$$
N_s = \frac{K_s * (c * q_s * r_w + K_w * p_w * q_w * (q_w * r_s - q_s * r_w))} {(K_w * p_w * q_w^2 * r_s + K_s * p_s * q_s^2 * r_w)}
$$

- Weak stock ($N_w$):

$$
N_w = \frac{K_w * (c * q_w * r_s + K_s * p_s * q_s * (- q_w * r_s + q_s * r_w))} {(K_w * p_w * q_w^2 * r_s + K_s * p_s * q_s^2 * r_w)}
$$

- Effort ($E$):

$$
E = \frac{(-c + K_s * p_s * q_s + K_w * p_w * q_w) * r_s * r_w} {K_w * p_w * q_w^2 r_s + K_s * p_s * q_s^2 * r_w}
$$

### List of parameters:
- K = carrying capacity
- r = per capita growth rate
- q = catchability of stocks
- c = cost of fishing
- p = price

### Parameter space for both species:

- Catchability (q) varies from 0.1 to 0.5 at intervals of 0.2 for both species.
- Growth rate (r) varies from 0.35 to 1.05 at intervals of 0.35 for the strong stock and from 0.1 to 0.3 at intervals of 0.1 for the weak stock.
- Carrying capacity (k) varies from 3 to 5 at intervals of 1 for the strong stock and from 1 to 3 at intervals of 1 for the weak stock.
- Price ranges (p) from 0.1 to 10 at intervals of 0.5 for both species.



### Catchability range simulation


```{r distribution of negative values for Ns and Nw for the range of qs, echo = FALSE}
# New tests with the other parameters also being varied

q_ranges <- 
  output_q_test_proc %>% 
 filter(variables == "N_w" & b_stocks == "b_values_w" & r_s >= r_w & b_v_k > 0) %>% 
 ggplot() +
 geom_raster(aes(x = q_w, y = q_s, fill = b_v_k)) +
 scale_x_continuous(breaks = seq(0.01, 0.1, 0.02),
                    expand = c(0,0)) +
 scale_y_continuous(breaks = seq(0.01, 0.1, 0.02),
                    expand = c(0,0)) +
 scale_fill_gradientn(name = "Bw/Kw",
                      colors = RColorBrewer::brewer.pal(9, "YlOrRd"),
                      rescaler = ~scales::rescale(.x, mid = 0.5)) +
 labs(x = "Weak stock q ranges",
      y = "Strong stock q ranges",
      title = "qw vs qs") +
 theme_bw() 

r_ranges <- output_q_test_proc %>% 
 filter(variables == "N_w" & b_stocks == "b_values_w" & r_s >= r_w & b_v_k > 0) %>% 
 ggplot() +
 geom_raster(aes(x = r_w, y = r_s, fill = b_v_k)) +
 scale_x_continuous(breaks = seq(0.1, 1, 0.1),
                    expand = c(0,0)) +
 scale_y_continuous(breaks = seq(0.1, 0.99, 0.1),
                    expand = c(0,0)) +
 scale_fill_gradientn(name = "Bw/Kw",
                      colors = RColorBrewer::brewer.pal(9, "YlOrRd"),
                      rescaler = ~scales::rescale(.x, mid = 0.5)) +
 labs(x = "Weak stock r ranges",
      y = "Strong stock r ranges",
      title = "rw vs rs") +
 theme_bw() 

rw_vs_qs <- 
  output_q_test_proc %>% 
  filter(variables == "N_w" & b_stocks == "b_values_w" & r_s >= r_w & b_v_k > 0) %>% 
  ggplot() +
  geom_raster(aes(x = r_w, y = q_s, fill = b_v_k)) +
  scale_x_continuous(breaks = seq(0.1, 1, 0.1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0.01, 0.1, 0.02),
                     expand = c(0,0)) +
  scale_fill_gradientn(name = "Bw/Kw",
                       colors = RColorBrewer::brewer.pal(9, "YlOrRd"),
                       rescaler = ~scales::rescale(.x, mid = 0.5)) +
  labs(x = "Weak stock r ranges",
       y = "Strong stock q ranges",
       title = "rw vs qs") +
  theme_bw() 

rw_vs_qw <- 
  output_q_test_proc %>% 
 filter(variables == "N_w" & b_stocks == "b_values_w" & r_s >= r_w & b_v_k > 0) %>% 
 ggplot() +
 geom_raster(aes(x = r_w, y = q_w, fill = b_v_k)) +
 scale_x_continuous(breaks = seq(0.1, 1, 0.1),
                    expand = c(0,0)) +
 scale_y_continuous(breaks = seq(0.01, 0.1, 0.02),
                    expand = c(0,0)) +
 scale_fill_gradientn(name = "Bw/Kw",
                      colors = RColorBrewer::brewer.pal(9, "YlOrRd"),
                      rescaler = ~scales::rescale(.x, mid = 0.5)) +
 labs(x = "Weak stock r ranges",
      y = "Weak stock q ranges",
      title = "rw vs qw") +
 theme_bw() 

rw_vs_rs_equal_qw <-
  output_q_test_proc %>% 
  filter(variables == "N_w" & b_stocks == "b_values_w" & r_s >= r_w & b_v_k >= 0 & q_w == q_s) %>% 
  ggplot() +
  geom_raster(aes(x = r_w, y = r_s, fill = b_v_k)) +
  scale_x_continuous(breaks = seq(0.1, 1, 0.1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0.1, 1, 0.1),
                     expand = c(0,0)) +
  scale_fill_gradientn(name = "Bw/Kw",
                       colors = RColorBrewer::brewer.pal(9, "YlOrRd"),
                       rescaler = ~scales::rescale(.x, mid = 0.5),
                       breaks = seq(0, 1, 0.25)) +
  labs(x = "Weak stock r ranges",
       y = "Strong stock r ranges",
       title = "qw = qs") +
  theme_bw()

rw_vs_rs_qw_dif_qs <-
  output_q_test_proc %>% 
  filter(variables == "N_w" & b_stocks == "b_values_w" & r_s >= r_w & b_v_k >= 0 & q_w != q_s) %>% 
  ggplot() +
  geom_raster(aes(x = r_w, y = r_s, fill = b_v_k)) +
  scale_x_continuous(breaks = seq(0.1, 1, 0.1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0.1, 1, 0.1),
                     expand = c(0,0)) +
  scale_fill_gradientn(name = "Bw/Kw",
                       colors = RColorBrewer::brewer.pal(9, "YlOrRd"),
                       rescaler = ~scales::rescale(.x, mid = 0.5)) +
  labs(x = "Weak stock r ranges",
       y = "Strong stock r ranges",
       title = "qw != q_s") +
  theme_bw()

rw_vs_rs_qw_higher_qs <-
  output_q_test_proc %>% 
  filter(variables == "N_w" & b_stocks == "b_values_w" & r_s >= r_w & b_v_k >= 0 & q_w >= q_s) %>% 
  ggplot() +
  geom_raster(aes(x = r_w, y = r_s, fill = b_v_k)) +
  scale_x_continuous(breaks = seq(0.1, 1, 0.1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0.1, 1, 0.1),
                     expand = c(0,0)) +
  scale_fill_gradientn(name = "Bw/Kw",
                       colors = RColorBrewer::brewer.pal(9, "YlOrRd"),
                       rescaler = ~scales::rescale(.x, mid = 0.5),
                       breaks = seq(0, 1, 0.25)) +
  labs(x = "Weak stock r ranges",
       y = "Strong stock r ranges",
       title = "qw >= q_s") +
  theme_bw()

rw_vs_rs_qw_lower_qs <-
  output_q_test_proc %>% 
  filter(variables == "N_w" & b_stocks == "b_values_w" & r_s >= r_w & b_v_k >= 0 & q_w <= q_s) %>% 
  ggplot() +
  geom_raster(aes(x = r_w, y = r_s, fill = b_v_k)) +
  scale_x_continuous(breaks = seq(0.1, 1, 0.1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0.1, 1, 0.1),
                     expand = c(0,0)) +
  scale_fill_gradientn(name = "Bw/Kw",
                       colors = RColorBrewer::brewer.pal(9, "YlOrRd"),
                       rescaler = ~scales::rescale(.x, mid = 0.5)) +
  labs(x = "Weak stock r ranges",
       y = "Strong stock r ranges",
       title = "qw <= q_s") +
  theme_bw()
```

```{r, echo = FALSE, fig.height=12, fig.width=12}
(q_ranges + r_ranges) /
  (rw_vs_qs + rw_vs_qw) /
  (rw_vs_rs_equal_qw + rw_vs_rs_qw_dif_qs) /
  (rw_vs_rs_qw_higher_qs + rw_vs_rs_qw_lower_qs) +
  plot_annotation(title = "Weak stock B/K estimates for a range of q and r combinations")
```



### Growth range simulation

```{r distribution of negative values for Ns and Nw for the range of rs, echo = FALSE}
output_r_test_proc_w <-  output_r_test_proc %>% 
   filter(variables == "N_w" & b_stocks == "b_values_w" & r_s >= r_w & b_v_k > 0) 

ggplot() +  
   geom_raster(data = output_r_test_proc_w,
               aes(x = r_w, y = r_s, fill = b_v_k)) +
   scale_x_continuous(breaks = seq(0, 1, 0.1),
                      expand = c(0,0)) +
   scale_y_continuous(breaks = seq(0, 1.1, 0.2),
                      expand = c(0,0)) +
   scale_fill_gradientn(name = "B/K", 
                        colors = RColorBrewer::brewer.pal(9, "YlOrRd"),
                        rescaler = ~ scales::rescale_mid(.x, mid = 0.5)) +
   labs(x = "rw",
        y = "rs",
        title = "Weak stock positive equilibria ranges (qw = qs)") +
   theme_bw() +
   theme(axis.title = element_text(color = "black", size = 12),
         axis.text = element_text(color = "black", size = 10),
         strip.background = element_rect(fill = "transparent"),
         panel.grid.minor = element_blank())
```


```{r, include = FALSE}
output_r_test_proc_test_1 <-
  output_r_test_proc %>%
  mutate(b_values_s_1 = N_s_star_1 / k_s,
         b_values_w_1 = N_w_star_1 / k_w) %>% 
  pivot_longer(cols = b_values_s_1:b_values_w_1,
               names_to = "b_values_1",
               values_to = "b_v_k_1") %>% 
  filter(b_values_1 == "b_values_w_1" & r_s >= r_w & b_v_k_1 > 0) %>% 
  distinct_all()

ggplot(data = output_r_test_proc_test_1) +  
   geom_raster(aes(x = r_w, y = r_s, fill = b_v_k_1)) +
   scale_x_continuous(breaks = seq(0, 1, 0.1),
                      expand = c(0,0)) +
   scale_y_continuous(breaks = seq(0, 1.1, 0.2),
                      expand = c(0,0)) +
   scale_fill_gradientn(name = "B/K", 
                        colors = RColorBrewer::brewer.pal(9, "YlOrRd"),
                        rescaler = ~ scales::rescale_mid(.x, mid = 0.5)) +
   labs(x = "rw",
        y = "rs",
        title = "Weak stock price as a function of catch") +
   theme_bw() +
   theme(axis.title = element_text(color = "black", size = 12),
         axis.text = element_text(color = "black", size = 10),
         strip.background = element_rect(fill = "transparent"),
         panel.grid.minor = element_blank())
```


```{r, echo = FALSE, include = FALSE}
s_w_zero_proc_test <- 
  s_w_zero_proc %>% 
  mutate(growth_ratio = r_w/r_s) %>% 
  filter(variables == "N_w" & b_stocks == "b_values_w" & b_v_k > 2)

s_w_zero_proc_test %>% 
  ggplot() +
  geom_histogram(aes(x =  b_v_k))

s_w_zero_proc_test %>% 
  ggplot() +
  geom_point(aes(x = growth_ratio, y = b_v_k))
```


### First test plot with weak stock having zero price

```{r, echo = FALSE, include = FALSE}
# s_w_zero_proc %>% 
#   mutate(growth_ratio = r_w / r_s) %>%
#   filter(variables == "N_w" & b_stocks == "b_values_w") %>% 
#   mutate(extinct = case_when(
#     b_v_k <= 0 ~ "yes",
#     b_v_k > 0 ~ "no"
#   )) %>% 
#   group_by(extinct) %>% 
#   count() %>% 
#   ungroup() %>% 
#   mutate(prop = n * 100/ sum(n))
# 
# w_s_range_proc_test <- 
#   w_s_range_proc %>% 
#   mutate(growth_ratio = r_w / r_s) %>%
#   filter(variables == "N_w" & b_stocks == "b_values_w" & b_v_k > 0) %>% 
#   mutate(mean_gr = mean(growth_ratio),
#          sd_gr = sd(growth_ratio))
# 
# s_w_range_proc %>%   
#   mutate(growth_ratio = r_w / r_s) %>%
#   filter(variables == "N_w" & b_stocks == "b_values_w") %>% 
#   mutate(extinct = case_when(
#     b_v_k <= 0 ~ "yes",
#     b_v_k > 0 ~ "no"
#   )) %>% 
#   group_by(extinct) %>% 
#   count() %>% 
#   ungroup() %>% 
#   mutate(prop = n * 100/ sum(n))

```

```{r, echo = FALSE, fig.height=6, fig.width=8, echo = FALSE}
# s_w_zero_proc_subset <- 
#   s_w_zero_proc %>% 
#   mutate(growth_ratio = r_w / r_s) %>%
#   filter(variables == "N_w" & b_stocks == "b_values_w") 
#   
#  
# s_w_zero_proc_plot <- 
#   ggplot() + 
#   # geom_raster(data = s_w_zero_proc_subset %>% filter(b_v_k > 0 & p_s > 0.3),
#   #            aes(x = growth_ratio, y = p_s, fill = b_v_k)) +
#   geom_point(data = s_w_zero_proc_subset %>% filter(b_v_k <= 0),
#             aes(x = growth_ratio, y = p_s, color = b_v_k)) +
#   scale_color_paletteer_c("viridis::viridis",
#                           rescaler = ~ scales::rescale_mid(.x, mid = 0.5)) +
#   scale_x_continuous(breaks = seq(0.1, 1, 0.1),
#                      expand = c(0,0)) +
#   scale_y_continuous(breaks = seq(0, 10, 1),
#                      expand = c(0,0)) +
#   labs(x = "Growth rate ratio (rw/rs)",
#        y = "Strong stock price",
#        fill = "Weak stock \nBw/Kw",
#        title = "Weak stock with zero value") +
#   theme_bw() +
#   theme(panel.grid.major = element_blank(),
#         panel.grid.minor = element_blank(),
#         axis.title = element_text(size = 10, color = "black"),
#         axis.text = element_text(size = 10, color = "black"))

```

```{r, echo = FALSE}
# b_labs <- c("Strong stock biomass", "Weak stock biomass")
# names(b_labs) <- c("b_values_s", "b_values_w")
# 
# s_w_range_proc_subset <- 
#   s_w_range_proc %>% 
#   filter(variables == "N_w" & b_stocks == "b_values_w") %>% 
#   mutate(p_w = as.factor(p_w)) %>% 
#   filter(p_w %in% c("1", "5", "11", "15"))
```


```{r, echo = FALSE}
s_w_range_proc_plot <-
  ggplot(data = s_w_range_proc) +
  geom_tile(aes(x = vuln_ratio_w, y = st_stock_rev, fill = b_v_k_w, width = 1)) +
  scale_fill_paletteer_c("viridis::viridis",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.5),
                         breaks = seq(0, 0.85, 0.15)) +
  scale_x_continuous(breaks = seq(1, 100, 19),
                     expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "Vw/Vs",
       y = "Strong stock revenue stream (Ps * q * Ks/c)",
       fill = "B/K") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 10, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


s_w_range_proc_plot2 <-
  ggplot(data = s_w_range_proc) +
  geom_tile(aes(x = log1p(vuln_ratio_w), y = st_stock_rev, fill = b_v_k_w, width = 1)) +
  scale_fill_paletteer_c("viridis::viridis",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.5),
                         breaks = seq(0, 0.85, 0.15)) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "log(Vw/Vs + 1)",
       y = "Strong stock revenue stream (Ps * q * Ks/c)",
       fill = "B/K") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 10, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))


s_w_range_proc_plot3 <-
  ggplot(data = w_s_range_proc) + 
  geom_tile(aes(x = vuln_ratio_w, y = w_stock_rev, fill = b_v_k_w, width = 1)) +
  scale_fill_paletteer_c("viridis::viridis",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.5),
                         breaks = seq(0, 0.85, 0.15)) +
  scale_x_continuous(breaks = seq(1, 100, 19),
                     expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "Vw/Vs",
       y = "Weak stock revenue stream (Pw * q * Kw/c)",
       fill = "B/K") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 10, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))

s_w_range_proc_plot4 <-
  ggplot(data = w_s_range_proc) + 
  geom_tile(aes(x = log1p(vuln_ratio_w), y = w_stock_rev, fill = b_v_k_w, width = 1)) +
  scale_fill_paletteer_c("viridis::viridis",
                          rescaler = ~ scales::rescale_mid(.x, mid = 0.5),
                         breaks = seq(0, 0.85, 0.15)) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "log(Vw/Vs + 1)",
       y = "Weak stock revenue stream (Pw * q * Kw/c)",
       fill = "B/K") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 10, color = "black"),
        axis.text = element_text(size = 10, color = "black"),
        strip.background = element_rect(fill = "transparent"),
        panel.spacing = unit(3, "mm"))
```

```{r, fig.height=10, fig.width=10}
(s_w_range_proc_plot +
  s_w_range_proc_plot2) /
  (s_w_range_proc_plot3 +
  s_w_range_proc_plot4) +
  plot_annotation(tag_levels = "A") +
  plot_layout(guides = "collect")
```

```{r, echo = FALSE, include = FALSE}
s_w_range_proc %>% 
  ggplot() +
  geom_histogram(aes(x = b_v_k_w)) 
```


```{r}
output_r_test_2_pw <- 
  output_r_test_2 %>% 
  ggplot() +
  geom_histogram(aes(x = p_w_star))

output_r_test_2_ps <-
  output_r_test_2 %>% 
  ggplot() +
  geom_histogram(aes(x = p_s_star))

output_r_test_2_pw + output_r_test_2_ps

```



## Time series equations

$$
\begin{align}
\frac{d N_s}{dt} &= N_S  r_s  (1 - (\frac{N_S}{K_s})) - q_s E \\
\newline
\frac{d N_w}{dt} &= N_W  r_w  (1 - (\frac{N_W}{K_w})) - q_w E \\
\newline
\frac{d E}{dt} &= \alpha  E  (p_s  q_s  N_S + p_w q_w N_W - c)
\newline
\frac{d C_s}{dt} &= q N_s E
\newline
\frac{d C_w}{dt} &= q N_w E
\newline
\frac{d CPUE_s}{dt} &= \frac{C_s} {E}
\newline
\frac{d CPUE_w}{dt} &= \frac{C_w} {E}
\newline
\frac{d \pi_s}{dt} &= C_s p_s - C_s  c
\newline
\frac{d \pi_w}{dt} &= C_w p_W - C_w  c
\newline
\frac{d \pi}{dt} &= C_s  p_s + C_w  p_w - (C_s + C_w) * c
\end{align}
$$


where $q_s$ and $q_w$ are the catchability of the strong and the weak stock, respectively; $r_s$ and $r_w$ are the intrinsic growth rates of the strong and weak stocks, respectively; $p_s$ and $p_w$ are the prices of the strong and weak stocks, respectively; $k_s$ and $k_w$ are the carrying capacities of the strong and weak stocks, respectively; $c$ is the fishing cost, and $\alpha$ is a constant controling for the speed at which effort changes following price changes.

### Scenarios for a range of price ratios

```{r scenario 1 price ratio 10, echo = FALSE}
# set up the parameter space
q_s <- 0.05
q_w <- 0.05
k_s <- 4
k_w <- 2
r_s <- 1
r_w <- 0.75
p_s1 <- 1
p_w1 <- 0.1
alpha <- 1
c <- 0.05

# Initial values for the variables
N_w <- k_w

N_s <- k_s

E <- 0.1
```

```{r, echo = FALSE}
tset <- seq(from = 0, to = 200, length.out = 1000)

N_w_simu1 <- NaN*tset; N_w_simu1[1] <- N_w

N_s_simu1 <- NaN*tset; N_s_simu1[1] <- N_s

#N_w_test_1 <- NaN*tset; N_w_test_1[1] <- N_w

#N_s_test_1 <- NaN*tset; N_s_test_1[1] <- N_s

E_simu1 <- NaN*tset; E_simu1[1] <- E

#E_test1 <- NaN*tset; E_test1[1] <- E

C_s_simu1 <- NaN*tset; C_s_simu1[1] <- 1

C_w_simu1 <- NaN*tset; C_w_simu1[1] <- 1

cpue_s_simu1 <- NaN*tset; cpue_s_simu1[1] <- 1

cpue_w_simu1 <- NaN*tset; cpue_w_simu1[1] <- 1

Pi_sum_simu1 <- NaN*tset; Pi_sum_simu1[1] <- 2

Pi_s_simu1 <- NaN*tset; Pi_s_simu1[1] <- 1

Pi_w_simu1 <- NaN*tset; Pi_w_simu1[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w1 <- N_w_simu1[i-1]
  N_s1 <- N_s_simu1[i-1]
  #N_wt1 <- N_w_test_1[i-1]
  #N_st1 <- N_s_test_1[i-1]
  E1 <- E_simu1[i-1]
  #E_t1 <- E_test1[i-1]
  C_s1 <- C_s_simu1[i-1]
  C_w1 <- C_w_simu1[i-1]
  cpue_s1 <- cpue_s_simu1[i-1]
  cpue_w1 <- cpue_w_simu1[i-1]
  pi1 <- Pi_sum_simu1[i-1]
  pi_s1 <- Pi_s_simu1[i-1]
  pi_w1 <- Pi_w_simu1[i-1]
    
  # Calculate change in variable size at each time step
  dN_s1 <- (N_s1 * (r_s * (1 - (N_s1/k_s)) - q_s * E1)) * dt
  dN_w1 <- (N_w1 * (r_w * (1 - (N_w1/k_w)) - q_w * E1)) * dt
  #dN_st1 <- (N_st1 * (r_s * (1 - (N_st1/k_s)) - q_s * E_t1)) * dt
  #dN_wt1 <- (N_wt1 * (r_w * (1 - (N_wt1/k_w)) - q_w * E_t1)) * dt
  dE1 <- (alpha * E1 * (p_s1 * q_s * N_s1 + p_w1 * q_w * N_w1 - c)) * dt
  #dE_test1 <- ((p_s1 * q_s1 * N_st1 + p_w1 * q_w1 * N_wt1) - c) * dt
  dC_s1 <- (q_s * N_s1 * E1) * dt
  dC_w1 <- (q_w * N_w1 * E1) * dt
  dcpue_s1 <- (C_s1 / E1) * dt
  dcpue_w1 <- (C_w1 / E1) * dt
  dPi_s1 <- (C_s1 * p_s1 - C_s1 * c) * dt
  dPi_w1 <- (C_w1 * p_w1 - C_w1 * c) * dt
  dPi1 <- (C_s1 * p_s1 + C_w1 * p_w1 - ((C_s1 + C_w1) * c)) * dt
  # calculate total variable size and store in holding vectors
  
  N_w_simu1[i] <- N_w1 + dN_w1
  N_s_simu1[i] <- N_s1 + dN_s1
  #N_w_test_1[i] <- N_wt1 + dN_wt1
  #N_s_test_1[i] <- N_st1 + dN_st1
  E_simu1[i] <- E1 + dE1
  #E_test1[i] <- E_t1 + dE_test1
  C_s_simu1[i] <- C_s1 + dC_s1
  C_w_simu1[i] <- C_w1 + dC_w1
  cpue_s_simu1[i] <- cpue_s1 + dcpue_s1
  cpue_w_simu1[i] <- cpue_w1 + dcpue_w1
  Pi_sum_simu1[i] <- pi1 + dPi1
  Pi_s_simu1[i] <- pi_s1 + dPi_s1
  Pi_w_simu1[i] <- pi_w1 + dPi_w1
  
}
  

```


```{r scenario 2 price ratio 5, echo = FALSE}
p_s2 <- 1
p_w2 <- 0.2
```

```{r, echo = FALSE}
#tset <- seq(from = 0, to = 500, length.out = 10000)

N_w_simu2 <- NaN*tset; N_w_simu2[1] <- N_w

N_s_simu2 <- NaN*tset; N_s_simu2[1] <- N_s

#N_w_test_2 <- NaN*tset; N_w_test_2[1] <- N_w

#N_s_test_2 <- NaN*tset; N_s_test_2[1] <- N_s

E_simu2 <- NaN*tset; E_simu2[1] <- E

#E_test2 <- NaN*tset; E_test2[1] <- E

C_s_simu2 <- NaN*tset; C_s_simu2[1] <- 1

C_w_simu2 <- NaN*tset; C_w_simu2[1] <- 1

cpue_s_simu2 <- NaN*tset; cpue_s_simu2[1] <- 1

cpue_w_simu2 <- NaN*tset; cpue_w_simu2[1] <- 1

Pi_sum_simu2 <- NaN*tset; Pi_sum_simu2[1] <- 2

Pi_s_simu2 <- NaN*tset; Pi_s_simu2[1] <- 1

Pi_w_simu2 <- NaN*tset; Pi_w_simu2[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w2 <- N_w_simu2[i-1]
  N_s2 <- N_s_simu2[i-1]
  #N_wt2 <- N_w_test_2[i-1]
  #N_st2 <- N_s_test_2[i-1]
  E2 <- E_simu2[i-1]
  #E_t2 <- E_test2[i-1]
  C_s2 <- C_s_simu2[i-1]
  C_w2 <- C_w_simu2[i-1]
  cpue_s2 <- cpue_s_simu2[i-1]
  cpue_w2 <- cpue_w_simu2[i-1]
  pi2 <- Pi_sum_simu2[i-1]
  pi_s2 <- Pi_s_simu2[i-1]
  pi_w2 <- Pi_w_simu2[i-1]

  # Calculate change in variable size at each time step
  dN_s2 <- (N_s2 * (r_s * (1 - (N_s2/k_s)) - q_s * E2)) * dt
  dN_w2 <- (N_w2 * (r_w * (1 - (N_w2/k_w)) - q_w * E2)) * dt
  #dN_st2 <- (N_st2 * (r_s2 * (1 - (N_st2/k_s2)) - q_s2 * E_t2)) * dt
  #dN_wt2 <- (N_wt2 * (r_w2 * (1 - (N_wt2/k_w2)) - q_w2 * E_t2)) * dt
  dE2 <- (alpha * E2 * (p_s2 * q_s * N_s2 + p_w2 * q_w * N_w2 - c)) * dt
  #dE_test2 <- ((p_s2 * q_s2 * N_st2 + p_w2 * q_w2 * N_wt2) - c) * dt
  dC_s2 <- (q_s * N_s2 * E2) * dt
  dC_w2 <- (q_w * N_w2 * E2) * dt
  dcpue_s2 <- (C_s2 / E2) * dt
  dcpue_w2 <- (C_w2 / E2) * dt
  dPi_s2 <- (C_s2 * p_s2 - C_s2 * c) * dt
  dPi_w2 <- (C_w2 * p_w2 - C_w2 * c) * dt
  dPi2 <- (C_s2 * p_s2 + C_w2 * p_w2 - ((C_s2 + C_w2) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu2[i] <- N_w2 + dN_w2
  N_s_simu2[i] <- N_s2 + dN_s2
  #N_w_test_2[i] <- N_wt2 + dN_wt2
  #N_s_test_2[i] <- N_st2 + dN_st2
  E_simu2[i] <- E2 + dE2
  #E_test2[i] <- E_t2 + dE_test2
  C_s_simu2[i] <- C_s2 + dC_s2
  C_w_simu2[i] <- C_w2 + dC_w2
  cpue_s_simu2[i] <- cpue_s2 + dcpue_s2
  cpue_w_simu2[i] <- cpue_w2 + dcpue_w2
  Pi_sum_simu2[i] <- pi2 + dPi2
  Pi_s_simu2[i] <- pi_s2 + dPi_s2
  Pi_w_simu2[i] <- pi_w2 + dPi_w2
}
```


```{r scenario 3 price ratio 2.5, echo = FALSE}
# set up the parameter space
p_s3 <- 1
p_w3 <- 0.4
```

```{r, echo = FALSE}
#tset <- seq(from = 0, to = 500, length.out = 10000)

N_w_simu3 <- NaN*tset; N_w_simu3[1] <- N_w

N_s_simu3 <- NaN*tset; N_s_simu3[1] <- N_s

#N_w_test_3 <- NaN*tset; N_w_test_3[1] <- N_w

#N_s_test_3 <- NaN*tset; N_s_test_3[1] <- N_s

E_simu3 <- NaN*tset; E_simu3[1] <- E

#E_test3 <- NaN*tset; E_test3[1] <- E

C_s_simu3 <- NaN*tset; C_s_simu3[1] <- 1

C_w_simu3 <- NaN*tset; C_w_simu3[1] <- 1

cpue_s_simu3 <- NaN*tset; cpue_s_simu3[1] <- 1

cpue_w_simu3 <- NaN*tset; cpue_w_simu3[1] <- 1

Pi_sum_simu3 <- NaN*tset; Pi_sum_simu3[1] <- 2

Pi_s_simu3 <- NaN*tset; Pi_s_simu3[1] <- 1

Pi_w_simu3 <- NaN*tset; Pi_w_simu3[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w3 <- N_w_simu3[i-1]
  N_s3 <- N_s_simu3[i-1]
  #N_wt3 <- N_w_test_3[i-1]
  #N_st3 <- N_s_test_3[i-1]
  E3 <- E_simu3[i-1]
  #E_t3 <- E_test3[i-1]
  C_s3 <- C_s_simu3[i-1]
  C_w3 <- C_w_simu3[i-1]
  cpue_s3 <- cpue_s_simu3[i-1]
  cpue_w3 <- cpue_w_simu3[i-1]
  pi3 <- Pi_sum_simu3[i-1]
  pi_s3 <- Pi_s_simu3[i-1]
  pi_w3 <- Pi_w_simu3[i-1]

  # Calculate change in variable size at each time step
  dN_s3 <- (N_s3 * (r_s * (1 - (N_s3/k_s)) - q_s * E3)) * dt
  dN_w3 <- (N_w3 * (r_w * (1 - (N_w3/k_w)) - q_w * E3)) * dt
  #dN_st3 <- (N_st3 * (r_s3 * (1 - (N_st3/k_s3)) - q_s3 * E_t3)) * dt
  #dN_wt3 <- (N_wt3 * (r_w3 * (1 - (N_wt3/k_w3)) - q_w3 * E_t3)) * dt
  dE3 <- (alpha * E3 * (p_s3 * q_s * N_s3 + p_w3 * q_w * N_w3 - c)) * dt
  #dE_test3 <- ((p_s3 * q_s3 * N_st3 + p_w3 * q_w3 * N_wt3) - c) * dt
  dC_s3 <- (q_s * N_s3 * E3) * dt
  dC_w3 <- (q_w * N_w3 * E3) * dt
  dcpue_s3 <- (C_s3 / E3) * dt
  dcpue_w3 <- (C_w3 / E3) * dt
  dPi_s3 <- (C_s3 * p_s3 - C_s3 * c) * dt
  dPi_w3 <- (C_w3 * p_w3 - C_w3 * c) * dt
  dPi3 <- (C_s3 * p_s3 + C_w3 * p_w3 - ((C_s3 + C_w3) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu3[i] <- N_w3 + dN_w3
  N_s_simu3[i] <- N_s3 + dN_s3
  #N_w_test_3[i] <- N_wt3 + dN_wt3
  #N_s_test_3[i] <- N_st3 + dN_st3
  E_simu3[i] <- E3 + dE3
  #E_test3[i] <- E_t3 + dE_test3
  C_s_simu3[i] <- C_s3 + dC_s3
  C_w_simu3[i] <- C_w3 + dC_w3
  cpue_s_simu3[i] <- cpue_s3 + dcpue_s3
  cpue_w_simu3[i] <- cpue_w3 + dcpue_w3
  Pi_sum_simu3[i] <- pi3 + dPi3
  Pi_s_simu3[i] <- pi_s3 + dPi_s3
  Pi_w_simu3[i] <- pi_w3 + dPi_w3

}
```


```{r scenario 4 price ratio 1, echo = FALSE}
# set up the parameter space
p_s4 <- 1
p_w4 <- 1
```

```{r, echo = FALSE}
#tset <- seq(from = 0, to = 500, length.out = 10000)

N_w_simu4 <- NaN*tset; N_w_simu4[1] <- N_w

N_s_simu4 <- NaN*tset; N_s_simu4[1] <- N_s

#N_w_test_4 <- NaN*tset; N_w_test_4[1] <- N_w

#N_s_test_4 <- NaN*tset; N_s_test_4[1] <- N_s

E_simu4 <- NaN*tset; E_simu4[1] <- E

#E_test4 <- NaN*tset; E_test4[1] <- E

C_s_simu4 <- NaN*tset; C_s_simu4[1] <- 1

C_w_simu4 <- NaN*tset; C_w_simu4[1] <- 1

cpue_s_simu4 <- NaN*tset; cpue_s_simu4[1] <- 1

cpue_w_simu4 <- NaN*tset; cpue_w_simu4[1] <- 1

Pi_sum_simu4 <- NaN*tset; Pi_sum_simu4[1] <- 2

Pi_s_simu4 <- NaN*tset; Pi_s_simu4[1] <- 1

Pi_w_simu4 <- NaN*tset; Pi_w_simu4[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w4 <- N_w_simu4[i-1]
  N_s4 <- N_s_simu4[i-1]
  #N_wt4 <- N_w_test_4[i-1]
  #N_st4 <- N_s_test_4[i-1]
  E4 <- E_simu4[i-1]
  #E_t4 <- E_test4[i-1]
  C_s4 <- C_s_simu4[i-1]
  C_w4 <- C_w_simu4[i-1]
  cpue_s4 <- cpue_s_simu4[i-1]
  cpue_w4 <- cpue_w_simu4[i-1]
  pi4 <- Pi_sum_simu4[i-1]
  pi_s4 <- Pi_s_simu4[i-1]
  pi_w4 <- Pi_w_simu4[i-1]

  # Calculate change in variable size at each time step
  dN_s4 <- (N_s4 * (r_s * (1 - (N_s4/k_s)) - q_s * E4)) * dt
  dN_w4 <- (N_w4 * (r_w * (1 - (N_w4/k_w)) - q_w * E4)) * dt
  #dN_st4 <- (N_st4 * (r_s4 * (1 - (N_st4/k_s4)) - q_s4 * E_t4)) * dt
  #dN_wt4 <- (N_wt4 * (r_w4 * (1 - (N_wt4/k_w4)) - q_w4 * E_t4)) * dt
  dE4 <- (alpha * E4 * (p_s4 * q_s * N_s4 + p_w4 * q_w * N_w4 - c)) * dt
  #dE_test4 <- ((p_s4 * q_s4 * N_st4 + p_w4 * q_w4 * N_wt4) - c) * dt
  dC_s4 <- (q_s * N_s4 * E4) * dt
  dC_w4 <- (q_w * N_w4 * E4) * dt
  dcpue_s4 <- (C_s4 / E4) * dt
  dcpue_w4 <- (C_w4 / E4) * dt
  dPi_s4 <- (C_s4 * p_s4 - C_s4 * c) * dt
  dPi_w4 <- (C_w4 * p_w4 - C_w4 * c) * dt
  dPi4 <- (C_s4 * p_s4 + C_w4 * p_w4 - ((C_s4 + C_w4) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu4[i] <- N_w4 + dN_w4
  N_s_simu4[i] <- N_s4 + dN_s4
  #N_w_test_4[i] <- N_wt4 + dN_wt4
  #N_s_test_4[i] <- N_st4 + dN_st4
  E_simu4[i] <- E4 + dE4
  #E_test4[i] <- E_t4 + dE_test4
  C_s_simu4[i] <- C_s4 + dC_s4
  C_w_simu4[i] <- C_w4 + dC_w4
  cpue_s_simu4[i] <- cpue_s4 + dcpue_s4
  cpue_w_simu4[i] <- cpue_w4 + dcpue_w4
  Pi_sum_simu4[i] <- pi4 + dPi4
  Pi_s_simu4[i] <- pi_s4 + dPi_s4
  Pi_w_simu4[i] <- pi_w4 + dPi_w4
  
}
```


```{r scenario 5 price ratio 0.75, echo = FALSE}
# set up the parameter space
p_s5 <- 1
p_w5 <- 1.33
```

```{r, echo = FALSE}
#tset <- seq(from = 0, to = 500, length.out = 10000)

N_w_simu5 <- NaN*tset; N_w_simu5[1] <- N_w

N_s_simu5 <- NaN*tset; N_s_simu5[1] <- N_s

#N_w_test_5 <- NaN*tset; N_w_test_5[1] <- N_w

#N_s_test_5 <- NaN*tset; N_s_test_5[1] <- N_s

E_simu5 <- NaN*tset; E_simu5[1] <- E

#E_test5 <- NaN*tset; E_test5[1] <- E

C_s_simu5 <- NaN*tset; C_s_simu5[1] <- 1

C_w_simu5 <- NaN*tset; C_w_simu5[1] <- 1

cpue_s_simu5 <- NaN*tset; cpue_s_simu5[1] <- 1

cpue_w_simu5 <- NaN*tset; cpue_w_simu5[1] <- 1

Pi_sum_simu5 <- NaN*tset; Pi_sum_simu5[1] <- 2

Pi_s_simu5 <- NaN*tset; Pi_s_simu5[1] <- 1

Pi_w_simu5 <- NaN*tset; Pi_w_simu5[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w5 <- N_w_simu5[i-1]
  N_s5 <- N_s_simu5[i-1]
  #N_wt5 <- N_w_test_5[i-1]
  #N_st5 <- N_s_test_5[i-1]
  E5 <- E_simu5[i-1]
  #E_t5 <- E_test5[i-1]
  C_s5 <- C_s_simu5[i-1]
  C_w5 <- C_w_simu5[i-1]
  cpue_s5 <- cpue_s_simu5[i-1]
  cpue_w5 <- cpue_w_simu5[i-1]
  pi5 <- Pi_sum_simu5[i-1]
  pi_s5 <- Pi_s_simu5[i-1]
  pi_w5 <- Pi_w_simu5[i-1]

  # Calculate change in variable size at each time step
  dN_s5 <- (N_s5 * (r_s * (1 - (N_s5/k_s)) - q_s * E5)) * dt
  dN_w5 <- (N_w5 * (r_w * (1 - (N_w5/k_w)) - q_w * E5)) * dt
  #dN_st5 <- (N_st5 * (r_s5 * (1 - (N_st5/k_s5)) - q_s5 * E_t5)) * dt
  #dN_wt5 <- (N_wt5 * (r_w5 * (1 - (N_wt5/k_w5)) - q_w5 * E_t5)) * dt
  dE5 <- (alpha * E5 * (p_s5 * q_s * N_s5 + p_w5 * q_w * N_w5 - c)) * dt
  #dE_test5 <- ((p_s5 * q_s5 * N_st5 + p_w5 * q_w5 * N_wt5) - c) * dt
  dC_s5 <- (q_s * N_s5 * E5) * dt
  dC_w5 <- (q_w * N_w5 * E5) * dt
  dcpue_s5 <- (C_s5 / E5) * dt
  dcpue_w5 <- (C_w5 / E5) * dt
  dPi_s5 <- (C_s5 * p_s5 - C_s5 * c) * dt
  dPi_w5 <- (C_w5 * p_w5 - C_w5 * c) * dt
  dPi5 <- (C_s5 * p_s5 + C_w5 * p_w5 - ((C_s5 + C_w5) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu5[i] <- N_w5 + dN_w5
  N_s_simu5[i] <- N_s5 + dN_s5
  #N_w_test_5[i] <- N_wt5 + dN_wt5
  #N_s_test_5[i] <- N_st5 + dN_st5
  E_simu5[i] <- E5 + dE5
  #E_test5[i] <- E_t5 + dE_test5
  C_s_simu5[i] <- C_s5 + dC_s5
  C_w_simu5[i] <- C_w5 + dC_w5
  cpue_s_simu5[i] <- cpue_s5 + dcpue_s5
  cpue_w_simu5[i] <- cpue_w5 + dcpue_w5
  Pi_sum_simu5[i] <- pi5 + dPi5
  Pi_s_simu5[i] <- pi_s5 + dPi_s5
  Pi_w_simu5[i] <- pi_w5 + dPi_w5  
}
```



```{r scenario 6 price ratio 0.5, echo = FALSE}
p_s6 <- 1
p_w6 <- 2
```

```{r, echo = FALSE}
#tset <- seq(from = 0, to = 500, length.out = 10000)

N_w_simu6 <- NaN*tset; N_w_simu6[1] <- N_w

N_s_simu6 <- NaN*tset; N_s_simu6[1] <- N_s

#N_w_test_6 <- NaN*tset; N_w_test_6[1] <- N_w

#N_s_test_6 <- NaN*tset; N_s_test_6[1] <- N_s

E_simu6 <- NaN*tset; E_simu6[1] <- E

#E_test6 <- NaN*tset; E_test6[1] <- E

C_s_simu6 <- NaN*tset; C_s_simu6[1] <- 1

C_w_simu6 <- NaN*tset; C_w_simu6[1] <- 1

cpue_s_simu6 <- NaN*tset; cpue_s_simu6[1] <- 1

cpue_w_simu6 <- NaN*tset; cpue_w_simu6[1] <- 1

Pi_sum_simu6 <- NaN*tset; Pi_sum_simu6[1] <- 2

Pi_s_simu6 <- NaN*tset; Pi_s_simu6[1] <- 1

Pi_w_simu6 <- NaN*tset; Pi_w_simu6[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w6 <- N_w_simu6[i-1]
  N_s6 <- N_s_simu6[i-1]
  #N_wt6 <- N_w_test_6[i-1]
  #N_st6 <- N_s_test_6[i-1]
  E6 <- E_simu6[i-1]
  #E_t6 <- E_test6[i-1]
  C_s6 <- C_s_simu6[i-1]
  C_w6 <- C_w_simu6[i-1]
  cpue_s6 <- cpue_s_simu6[i-1]
  cpue_w6 <- cpue_w_simu6[i-1]
  pi6 <- Pi_sum_simu6[i-1]
  pi_s6 <- Pi_s_simu6[i-1]
  pi_w6 <- Pi_w_simu6[i-1]

  # Calculate change in variable size at each time step
  dN_s6 <- (N_s6 * (r_s * (1 - (N_s6/k_s)) - q_s * E6)) * dt
  dN_w6 <- (N_w6 * (r_w * (1 - (N_w6/k_w)) - q_w * E6)) * dt
  #dN_st6 <- (N_st6 * (r_s6 * (1 - (N_st6/k_s6)) - q_s6 * E_t6)) * dt
  #dN_wt6 <- (N_wt6 * (r_w6 * (1 - (N_wt6/k_w6)) - q_w6 * E_t6)) * dt
  dE6 <- (alpha * E6 * (p_s6 * q_s * N_s6 + p_w6 * q_w * N_w6 - c)) * dt
  #dE_test6 <- ((p_s6 * q_s6 * N_st6 + p_w6 * q_w6 * N_wt6) - c) * dt
  dC_s6 <- (q_s * N_s6 * E6) * dt
  dC_w6 <- (q_w * N_w6 * E6) * dt
  dcpue_s6 <- (C_s6 / E6) * dt
  dcpue_w6 <- (C_w6 / E6) * dt
  dPi_s6 <- (C_s6 * p_s6 - C_s6 * c) * dt
  dPi_w6 <- (C_w6 * p_w6 - C_w6 * c) * dt
  dPi6 <- (C_s6 * p_s6 + C_w6 * p_w6 - ((C_s6 + C_w6) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  N_w_simu6[i] <- N_w6 + dN_w6
  N_s_simu6[i] <- N_s6 + dN_s6
  #N_w_test_6[i] <- N_wt6 + dN_wt6
  #N_s_test_6[i] <- N_st6 + dN_st6
  E_simu6[i] <- E6 + dE6
  #E_test6[i] <- E_t6 + dE_test6
  C_s_simu6[i] <- C_s6 + dC_s6
  C_w_simu6[i] <- C_w6 + dC_w6
  cpue_s_simu6[i] <- cpue_s6 + dcpue_s6
  cpue_w_simu6[i] <- cpue_w6 + dcpue_w6
  Pi_sum_simu6[i] <- pi6 + dPi6
  Pi_s_simu6[i] <- pi_s6 + dPi_s6
  Pi_w_simu6[i] <- pi_w6 + dPi_w6  
  
}
```


```{r scenario 7 price ratio 0.25, echo = FALSE}
p_s7 <- 1
p_w7 <- 4
```

```{r, echo = FALSE}
#tset <- seq(from = 0, to = 500, length.out = 10000)

N_w_simu7 <- NaN*tset; N_w_simu7[1] <- N_w

N_s_simu7 <- NaN*tset; N_s_simu7[1] <- N_s

#N_w_test_7 <- NaN*tset; N_w_test_7[1] <- N_w

#N_s_test_7 <- NaN*tset; N_s_test_7[1] <- N_s

E_simu7 <- NaN*tset; E_simu7[1] <- E

#E_test7 <- NaN*tset; E_test7[1] <- E

C_s_simu7 <- NaN*tset; C_s_simu7[1] <- 1

C_w_simu7 <- NaN*tset; C_w_simu7[1] <- 1

cpue_s_simu7 <- NaN*tset; cpue_s_simu7[1] <- 1

cpue_w_simu7 <- NaN*tset; cpue_w_simu7[1] <- 1

Pi_sum_simu7 <- NaN*tset; Pi_sum_simu7[1] <- 2

Pi_s_simu7 <- NaN*tset; Pi_s_simu7[1] <- 1

Pi_w_simu7 <- NaN*tset; Pi_w_simu7[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w7 <- N_w_simu7[i-1]
  N_s7 <- N_s_simu7[i-1]
  #N_wt7 <- N_w_test_7[i-1]
  #N_st7 <- N_s_test_7[i-1]
  E7 <- E_simu7[i-1]
  #E_t7 <- E_test7[i-1]
  C_s7 <- C_s_simu7[i-1]
  C_w7 <- C_w_simu7[i-1]
  cpue_s7 <- cpue_s_simu7[i-1]
  cpue_w7 <- cpue_w_simu7[i-1]
  pi7 <- Pi_sum_simu7[i-1]
  pi_s7 <- Pi_s_simu7[i-1]
  pi_w7 <- Pi_w_simu7[i-1]

  # Calculate change in variable size at each time step
  dN_s7 <- (N_s7 * (r_s * (1 - (N_s7/k_s)) - q_s * E7)) * dt
  dN_w7 <- (N_w7 * (r_w * (1 - (N_w7/k_w)) - q_w * E7)) * dt
  #dN_st7 <- (N_st7 * (r_s7 * (1 - (N_st7/k_s7)) - q_s7 * E_t7)) * dt
  #dN_wt7 <- (N_wt7 * (r_w7 * (1 - (N_wt7/k_w7)) - q_w7 * E_t7)) * dt
  dE7 <- (alpha * E7 * (p_s7 * q_s * N_s7 + p_w7 * q_w * N_w7 - c)) * dt
  #dE_test7 <- ((p_s7 * q_s7 * N_st7 + p_w7 * q_w7 * N_wt7) - c) * dt
  dC_s7 <- (q_s * N_s7 * E7) * dt
  dC_w7 <- (q_w * N_w7 * E7) * dt
  dcpue_s7 <- (C_s7 / E7) * dt
  dcpue_w7 <- (C_w7 / E7) * dt
  dPi_s7 <- (C_s7 * p_s7 - C_s7 * c) * dt
  dPi_w7 <- (C_w7 * p_w7 - C_w7 * c) * dt
  dPi7 <- (C_s7 * p_s7 + C_w7 * p_w7 - ((C_s7 + C_w7) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu7[i] <- N_w7 + dN_w7
  N_s_simu7[i] <- N_s7 + dN_s7
  #N_w_test_7[i] <- N_wt7 + dN_wt7
  #N_s_test_7[i] <- N_st7 + dN_st7
  E_simu7[i] <- E7 + dE7
  #E_test7[i] <- E_t7 + dE_test7
  C_s_simu7[i] <- C_s7 + dC_s7
  C_w_simu7[i] <- C_w7 + dC_w7
  cpue_s_simu7[i] <- cpue_s7 + dcpue_s7
  cpue_w_simu7[i] <- cpue_w7 + dcpue_w7
  Pi_sum_simu7[i] <- pi7 + dPi7
  Pi_s_simu7[i] <- pi_s7 + dPi_s7
  Pi_w_simu7[i] <- pi_w7 + dPi_w7  
  
}
```


```{r scenario 8 price ratio 0.25, echo = FALSE}
# set up the parameter space
p_s8 <- 1
p_w8 <- 10
```

```{r, echo = FALSE}
#tset <- seq(from = 0, to = 500, length.out = 10000)

N_w_simu8 <- NaN*tset; N_w_simu8[1] <- N_w

N_s_simu8 <- NaN*tset; N_s_simu8[1] <- N_s

#N_w_test_8 <- NaN*tset; N_w_test_8[1] <- N_w

#N_s_test_8 <- NaN*tset; N_s_test_8[1] <- N_s

E_simu8 <- NaN*tset; E_simu8[1] <- E

#E_test8 <- NaN*tset; E_test8[1] <- E

C_s_simu8 <- NaN*tset; C_s_simu8[1] <- 1

C_w_simu8 <- NaN*tset; C_w_simu8[1] <- 1

cpue_s_simu8 <- NaN*tset; cpue_s_simu8[1] <- 1

cpue_w_simu8 <- NaN*tset; cpue_w_simu8[1] <- 1

Pi_sum_simu8 <- NaN*tset; Pi_sum_simu8[1] <- 2

Pi_s_simu8 <- NaN*tset; Pi_s_simu8[1] <- 1

Pi_w_simu8 <- NaN*tset; Pi_w_simu8[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w8 <- N_w_simu8[i-1]
  N_s8 <- N_s_simu8[i-1]
  #N_wt8 <- N_w_test_8[i-1]
  #N_st8 <- N_s_test_8[i-1]
  E8 <- E_simu8[i-1]
  #E_t8 <- E_test8[i-1]
  C_s8 <- C_s_simu8[i-1]
  C_w8 <- C_w_simu8[i-1]
  cpue_s8 <- cpue_s_simu8[i-1]
  cpue_w8 <- cpue_w_simu8[i-1]
  pi8 <- Pi_sum_simu8[i-1]
  pi_s8 <- Pi_s_simu8[i-1]
  pi_w8 <- Pi_w_simu8[i-1]

  # Calculate change in variable size at each time step
  dN_s8 <- (N_s8 * (r_s * (1 - (N_s8/k_s)) - q_s * E8)) * dt
  dN_w8 <- (N_w8 * (r_w * (1 - (N_w8/k_w)) - q_w * E8)) * dt
  #dN_st8 <- (N_st8 * (r_s8 * (1 - (N_st8/k_s8)) - q_s8 * E_t8)) * dt
  #dN_wt8 <- (N_wt8 * (r_w8 * (1 - (N_wt8/k_w8)) - q_w8 * E_t8)) * dt
  dE8 <- (alpha * E8 * (p_s8 * q_s * N_s8 + p_w8 * q_w * N_w8 - c)) * dt
  #dE_test8 <- ((p_s8 * q_s8 * N_st8 + p_w8 * q_w8 * N_wt8) - c) * dt
  dC_s8 <- (q_s * N_s8 * E8) * dt
  dC_w8 <- (q_w * N_w8 * E8) * dt
  dcpue_s8 <- (C_s8 / E8) * dt
  dcpue_w8 <- (C_w8 / E8) * dt
  dPi_s8 <- (C_s8 * p_s8 - C_s8 * c) * dt
  dPi_w8 <- (C_w8 * p_w8 - C_w8 * c) * dt
  dPi8 <- (C_s8 * p_s8 + C_w8 * p_w8 - ((C_s8 + C_w8) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu8[i] <- N_w8 + dN_w8
  N_s_simu8[i] <- N_s8 + dN_s8
  #N_w_test_8[i] <- N_wt8 + dN_wt8
  #N_s_test_8[i] <- N_st8 + dN_st8
  E_simu8[i] <- E8 + dE8
  #E_test8[i] <- E_t8 + dE_test8
  C_s_simu8[i] <- C_s8 + dC_s8
  C_w_simu8[i] <- C_w8 + dC_w8
  cpue_s_simu8[i] <- cpue_s8 + dcpue_s8
  cpue_w_simu8[i] <- cpue_w8 + dcpue_w8
  Pi_sum_simu8[i] <- pi8 + dPi8
  Pi_s_simu8[i] <- pi_s8 + dPi_s8
  Pi_w_simu8[i] <- pi_w8 + dPi_w8  
  
  
}
```


```{r, echo = FALSE}
run_model <- function(r_s, k_s, q_s, p_s, r_w, k_w, q_w, p_w, c){
 
  # Derive effort
 E <- ((- c + k_s * p_s * q_s + k_w * p_w * q_w) * r_s * r_w)  /
   (k_w * p_w * q_w^2 * r_s + k_s * p_s * q_s^2 * r_w) 
  
  # Derive weak stock biomass
 
  N_w <- (k_w * (c * q_w * r_s + k_s * p_s * q_s * (- q_w * r_s + q_s * r_w))) / 
    (k_w * p_w * q_w^2 * r_s + k_s * p_s * q_s^2 * r_w)
  
 # Derive strong stock biomass
 
   N_s <- (k_s * (c * q_s * r_w + k_w * p_w * q_w * (q_w * r_s - q_s * r_w))) /
     (k_w * p_w * q_w^2 * r_s + k_s * p_s * q_s^2 * r_w)
  
  # Build output
  output <- data.frame(E = E, N_s = N_s, N_w = N_w)
 
  # Return
  return(output)
 
 
}

sc_1 <- run_model(q_s = 0.05, q_w = 0.05, k_s = 4, k_w = 2, r_s = 1, r_w = 0.75, p_s = 1, p_w = 0.1, c = 0.05)
sc_2 <- run_model(q_s = 0.05, q_w = 0.05, k_s = 4, k_w = 2, r_s = 1, r_w = 0.75, p_s = 1, p_w = 0.2, c = 0.05)
sc_3 <- run_model(q_s = 0.05, q_w = 0.05, k_s = 4, k_w = 2, r_s = 1, r_w = 0.75, p_s = 1, p_w = 0.4, c = 0.05)
sc_4 <- run_model(q_s = 0.05, q_w = 0.05, k_s = 4, k_w = 2, r_s = 1, r_w = 0.75, p_s = 1, p_w = 1, c = 0.05)
sc_5 <- run_model(q_s = 0.05, q_w = 0.05, k_s = 4, k_w = 2, r_s = 1, r_w = 0.75, p_s = 1, p_w = 1.33, c = 0.05)
sc_6 <- run_model(q_s = 0.05, q_w = 0.05, k_s = 4, k_w = 2, r_s = 1, r_w = 0.75, p_s = 1, p_w = 12, c = 0.05)
sc_7 <- run_model(q_s = 0.05, q_w = 0.05, k_s = 4, k_w = 2, r_s = 1, r_w = 0.75, p_s = 1, p_w = 14, c = 0.05)
sc_8 <- run_model(q_s = 0.05, q_w = 0.05, k_s = 4, k_w = 2, r_s = 1, r_w = 0.75, p_s = 1, p_w = 10, c = 0.05)

sc_all <- bind_rows(sc_1, sc_2, sc_3, sc_4, sc_5, sc_6, sc_7, sc_8) %>% 
  rownames_to_column() %>% 
  rename(scenario = rowname) %>% 
  mutate(tset = 200) %>% 
  pivot_longer(cols = E:N_w,
               names_to = "variable",
               values_to = "value") %>% 
  mutate(price_ratio = case_when(
    scenario == "1" ~ "PR = 10",
    scenario == "2" ~ "PR = 5",
    scenario == "3" ~ "PR = 2.5",
    scenario == "4" ~ "PR = 1",
    scenario == "5" ~ "PR = 0.75",
    scenario == "6" ~ "PR = 0.5",
    scenario == "7" ~ "PR = 0.25",
    scenario == "8" ~ "PR = 0.1"
  )) %>% 
  pivot_wider(names_from = "variable",
              values_from = "value") %>% 
  mutate(b_values_s = N_s / k_s,
         b_values_w = N_w / k_w) %>% 
  pivot_longer(cols = N_s:N_w,
               names_to = "variable",
               values_to = "value") %>%
  pivot_longer(cols = b_values_s:b_values_w,
               names_to = "b_values",
               values_to = "b_v_k") %>% 
  pivot_longer(cols = E,
               names_to = "effort",
               values_to = "ef_value") %>% 
  mutate(variable = case_when(
    variable == "N_s" ~ "Ns*",
    variable == "N_w" ~ "Nw*"
  )) %>% 
  mutate(effort = case_when(
    effort == "E" ~ "E*"
  )) %>% 
  mutate(b_values = case_when(
    str_detect(b_values, "_w") ~ "Nw/Kw*",
    str_detect(b_values, "_s") ~ "Ns/Ks*"
  ))
```

```{r building df for the parameter space, echo = FALSE}
eq_par <- data.frame(parameter = c("q_w", "q_s", "k_w", "k_s", "r_w", "r_s", "p_s", "p_w", "c"),
                     "PR_10" =  c(0.05, 0.05, 4, 2, 1, 0.75, 1, 0.1, 0.05),
                     "PR_5" =   c(0.05, 0.05, 4, 2, 1, 0.75, 1, 0.2, 0.05),
                     "PR_2.5" = c(0.05, 0.05, 4, 2, 1, 0.75, 1, 0.4, 0.05),
                     "PR_1" =   c(0.05, 0.05, 4, 2, 1, 0.75, 1, 1, 0.05),
                     "PR_0.75" =c(0.05, 0.05, 4, 2, 1, 0.75, 1, 1.33, 0.05),
                     "PR_0.5" = c(0.05, 0.05, 4, 2, 1, 0.75, 1, 2, 0.05),
                     "PR_0.25" =c(0.05, 0.05, 4, 2, 1, 0.75, 1, 4, 0.05),
                     "PR_0.1" = c(0.05, 0.05, 4, 2, 1, 0.75, 1, 10, 0.05))

eq_par %>% 
  gt() %>%
  tab_header(title = "Parameter space for equilibrium points") %>% 
  cols_align(align = "center")
  
```


```{r, echo = FALSE}
effort_df <- cbind(E_simu1, E_simu2, E_simu3, E_simu4, E_simu5, E_simu6, E_simu7, E_simu8, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("E_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "7",
    str_detect(variable, "8") ~ "8")
         )

# effort_test_df <- cbind(E_test1, E_test2, E_test3, E_test4, E_test5, E_test6, E_test7, E_test8, tset) %>% 
#   as.data.frame() %>% 
#   pivot_longer(cols = starts_with("E_"),
#                names_to = "variable",
#                values_to = "value") %>% 
#   mutate(scenario_id = case_when(
#     str_detect(variable, "1") ~ "1",
#     str_detect(variable, "2") ~ "2",
#     str_detect(variable, "3") ~ "3",
#     str_detect(variable, "4") ~ "4",
#     str_detect(variable, "5") ~ "5",
#     str_detect(variable, "6") ~ "6",
#     str_detect(variable, "7") ~ "7",
#     str_detect(variable, "8") ~ "8")
#     )

nw_df <- cbind(N_w_simu1, N_w_simu2, N_w_simu3, N_w_simu4, N_w_simu5, N_w_simu6, N_w_simu7,N_w_simu8, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("N_w_simu"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "7",
    str_detect(variable, "8") ~ "8")) %>% 
  mutate(b_v_k = value/k_w)


ns_df <- cbind(N_s_simu1, N_s_simu2, N_s_simu3, N_s_simu4, N_s_simu5, N_s_simu6, N_s_simu7, N_s_simu8, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("N_s_simu"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "7",
    str_detect(variable, "8") ~ "8")) %>% 
  mutate(b_v_k = value/k_s)

# ns_t_df <- cbind(N_s_test_1, N_s_test_2, N_s_test_3, N_s_test_4, N_s_test_5, N_s_test_6, N_s_test_7, N_s_test_8, tset) %>% 
#   as.data.frame() %>% 
#   pivot_longer(cols = starts_with("N_s_test_"),
#                names_to = "variable",
#                values_to = "value") %>% 
#   mutate(scenario_id = case_when(
#     str_detect(variable, "1") ~ "1",
#     str_detect(variable, "2") ~ "2",
#     str_detect(variable, "3") ~ "3",
#     str_detect(variable, "4") ~ "4",
#     str_detect(variable, "5") ~ "5",
#     str_detect(variable, "6") ~ "6",
#     str_detect(variable, "7") ~ "7",
#     str_detect(variable, "8") ~ "8")) %>% 
#   mutate(b_v_k = value/4)
# 
# nw_t_df <- cbind(N_w_test_1, N_w_test_2, N_w_test_3, N_w_test_4, N_w_test_5, N_w_test_6, N_w_test_7, N_w_test_8, tset) %>% 
#   as.data.frame() %>% 
#   pivot_longer(cols = starts_with("N_w_test_"),
#                names_to = "variable",
#                values_to = "value") %>% 
#   mutate(scenario_id = case_when(
#     str_detect(variable, "1") ~ "1",
#     str_detect(variable, "2") ~ "2",
#     str_detect(variable, "3") ~ "3",
#     str_detect(variable, "4") ~ "4",
#     str_detect(variable, "5") ~ "5",
#     str_detect(variable, "6") ~ "6",
#     str_detect(variable, "7") ~ "7",
#     str_detect(variable, "8") ~ "8")) %>% 
#   mutate(b_v_k = value/2)

catch_s_df <- cbind(C_s_simu1, C_s_simu2, C_s_simu3, C_s_simu4, C_s_simu5, C_s_simu6, C_s_simu7, C_s_simu8, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("C_s_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "7",
    str_detect(variable, "8") ~ "8"))

catch_w_df <- cbind(C_w_simu1, C_w_simu2, C_w_simu3, C_w_simu4, C_w_simu5, C_w_simu6, C_w_simu7, C_w_simu8, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("C_w_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "7",
    str_detect(variable, "8") ~ "8"))


cpue_s_df <- cbind(cpue_s_simu1, cpue_s_simu2, cpue_s_simu3, cpue_s_simu4, cpue_s_simu5, cpue_s_simu6, cpue_s_simu7, cpue_s_simu8, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("cpue_s_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "7",
    str_detect(variable, "8") ~ "8"))


cpue_w_df <- cbind(cpue_w_simu1, cpue_w_simu2, cpue_w_simu3, cpue_w_simu4, cpue_w_simu5, cpue_w_simu6, cpue_w_simu7, cpue_w_simu8, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("cpue_w_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "7",
    str_detect(variable, "8") ~ "8"))

profits_df <- cbind(Pi_sum_simu1, Pi_sum_simu2, Pi_sum_simu3, Pi_sum_simu4, Pi_sum_simu5, Pi_sum_simu6, Pi_sum_simu7, Pi_sum_simu8, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("Pi_sum"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "7",
    str_detect(variable, "8") ~ "8"))

profits_s_df <- cbind(Pi_s_simu1, Pi_s_simu2, Pi_s_simu3, Pi_s_simu4, Pi_s_simu5, Pi_s_simu6, Pi_s_simu7, Pi_s_simu8, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("Pi_s_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "7",
    str_detect(variable, "8") ~ "8"))

profits_w_df <- cbind(Pi_w_simu1, Pi_w_simu2, Pi_w_simu3, Pi_w_simu4, Pi_w_simu5, Pi_w_simu6, Pi_w_simu7, Pi_w_simu8, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("Pi_w_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6",
    str_detect(variable, "7") ~ "7",
    str_detect(variable, "8") ~ "8"))

# Gathered the results from each model scenario run into a single df

var_full <- bind_rows(effort_df, nw_df, ns_df, catch_s_df, catch_w_df, cpue_s_df, cpue_w_df, profits_df, profits_w_df, profits_s_df)

# Tidy dataset for plotting

var_plot <- var_full %>%
  mutate(price_ratio = case_when(
    str_detect(scenario_id, "1") ~ "PR = 10",
    str_detect(scenario_id, "2") ~ "PR = 5",
    str_detect(scenario_id, "3") ~ "PR = 2.5",
    str_detect(scenario_id, "4") ~ "PR = 1",
    str_detect(scenario_id, "5") ~ "PR = 0.75",
    str_detect(scenario_id, "6") ~ "PR = 0.5",
    str_detect(scenario_id, "7") ~ "PR = 0.25",
    str_detect(scenario_id, "8") ~ "PR = 0.1"
  )) %>% 
  mutate(variable_clean = case_when(
    str_detect(variable, "N_w_test") ~ "Weak stock test",
    str_detect(variable, "N_s_test") ~ "Strong stock test",    
    str_detect(variable, "N_w") ~ "Weak stock",
    str_detect(variable, "N_s") ~ "Strong stock",
    str_detect(variable, "E_simu") ~ "Effort simulation",
    str_detect(variable, "E_test") ~ "Effort test",
    str_detect(variable, "Pi_sum_") ~ "Profit sum",
    str_detect(variable, "Pi_s") ~ "Strong stock profits",
    str_detect(variable, "Pi_w") ~ "Weak stock profits",
    str_detect(variable, "cpue_w") ~ "Weak stock CPUE",
    str_detect(variable, "cpue_s") ~ "Strong stock CPUE",
    str_detect(variable, "C_w") ~ "Weak stock catch",
    str_detect(variable, "C_s") ~ "Strong stock catch"
  ))
```

```{r, echo = FALSE, fig.height=4, fig.width=8}
equal_scales_EWS <-
  var_plot %>% 
  filter(variable_clean %in% c("Effort simulation", "Weak stock", "Strong stock")) %>% 
  ggplot() +
  geom_line(aes(x = tset, y = value, color = variable_clean),
            size = .8,
            alpha = .8,
            show.legend = T) +
  geom_point(data = sc_all, 
             aes(x = tset, y = value, color = variable)) +
  geom_point(data = sc_all,
             aes(x = tset, y = ef_value, color = effort)) +
  facet_wrap(~ factor(price_ratio, 
                      levels = c("PR = 10",
                                 "PR = 5",
                                 "PR = 2.5",
                                 "PR = 1",
                                 "PR = 0.75",
                                 "PR = 0.5",
                                 "PR = 0.25",
                                 "PR = 0.1")),
             nrow = 1) +
  scale_color_manual(values = c("#1B9E77", "#1B9E77", "#D95F02", "#7570B3",  "#D95F02", "#7570B3")) +
  scale_x_continuous(breaks = seq(0, 200, 100)) +
  labs(x = "",
       y = "Nw, Ns, E",
       color = "") +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        strip.text = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 12),
        axis.title.y = element_text(color = "black", size = 12, vjust = 2),
        axis.text = element_text(color = "black", size = 10),
        legend.position = "bottom")

# equal_scales_EWS_test <-
#   var_plot %>% 
#   filter(variable_clean %in% c("Effort test", "Weak stock test", "Strong stock test")) %>% 
#   ggplot() +
#   geom_line(aes(x = tset/100, y = value, color = variable_clean),
#             size = .8,
#             alpha = .8,
#             show.legend = T) +
#   geom_point(data = sc_all, 
#              aes(x = tset, y = value, color = variable)) +
#   geom_point(data = sc_all, 
#              aes(x = tset, y = ef_value, color = effort)) +
#   facet_wrap(~ factor(price_ratio, 
#                       levels = c("PR = 10",
#                                  "PR = 5",
#                                  "PR = 2.5",
#                                  "PR = 1",
#                                  "PR = 0.75",
#                                  "PR = 0.5",
#                                  "PR = 0.25",
#                                  "PR = 0.1")),
#              nrow = 1) +
#   scale_color_manual(values = c("#1B9E77", "#1B9E77", "#D95F02", "#7570B3",  "#D95F02", "#7570B3")) +
# #  scale_y_continuous(breaks = seq(0, 50, 10)) +
#   labs(x = "",
#        y = "Nw, Ns, E",
#        color = "") +
#   theme_bw() +
#   theme(panel.grid.major.x = element_blank(),
#         panel.grid.minor.x = element_blank(),
#         panel.grid.minor.y = element_blank(),
#         strip.background = element_rect(fill = "transparent"),
#         strip.text = element_text(color = "black", size = 11),
#         axis.title.x = element_text(color = "black", size = 12),
#         axis.title.y = element_text(color = "black", size = 12, vjust = 2),
#         axis.text = element_text(color = "black", size = 10),
#         legend.position = "bottom")

dif_scales <-
  var_plot %>% 
  filter(variable_clean %in% c("Strong stock", "Weak stock")) %>% 
  ggplot() +
  geom_line(aes(x = tset, y = b_v_k, color = variable_clean),
            size = .8,
            alpha = .8,
            show.legend = F) +
  geom_point(data = sc_all %>% filter(!variable == "E"), 
             aes(x = tset, y = b_v_k, color = b_values)) +
  facet_wrap(~ factor(price_ratio, 
                      levels = c("PR = 10",
                                 "PR = 5",
                                 "PR = 2.5",
                                 "PR = 1",
                                 "PR = 0.75",
                                 "PR = 0.5",
                                 "PR = 0.25",
                                 "PR = 0.1")),
             nrow = 1) +
  scale_color_manual(values = c("#D95F02", "#7570B3", "#D95F02", "#7570B3")) +
  scale_x_continuous(breaks = seq(0, 200, 100)) +
  labs(x = "",
       y = "N/K (Nw, Ns)",
       color = "") +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        strip.text = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 12, vjust = -2),
        axis.title.y = element_text(color = "black", size = 12, vjust = 2),
        axis.text = element_text(color = "black", size = 10),
        legend.position = "bottom")

equal_scales_CPE <-
  var_plot %>% 
  filter(variable_clean %in% c("Weak stock catch", "Strong stock catch", "Weak stock CPUE", "Strong stock CPUE")) %>% 
  ggplot() +
  geom_line(aes(x = tset, y = value, color = variable_clean),
            size = .8,
            alpha = .8,
            show.legend = T) +
  facet_wrap(~ factor(price_ratio, 
                      levels = c("PR = 10",
                                 "PR = 5",
                                 "PR = 2.5",
                                 "PR = 1",
                                 "PR = 0.75",
                                 "PR = 0.5",
                                 "PR = 0.25",
                                 "PR = 0.1")),
             nrow = 1) +
  scale_color_manual(values = c("#33A02C", "#FB9A99", "#E31A1C", "#FDBF6F")) +
  scale_x_continuous(breaks = seq(0, 200, 100)) +
  labs(x = "",
       y = "CPUE, Catch (S and W)",
       color = "") +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        strip.text = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 12),
        axis.title.y = element_text(color = "black", size = 12, vjust = 2),
        axis.text = element_text(color = "black", size = 10),
        legend.position = "bottom")

equal_scales_pi <-
  var_plot %>% 
  filter(variable_clean %in% c("Profit sum", "Weak stock profits", "Strong stock profits")) %>% 
  ggplot() +
  geom_line(aes(x = tset, y = value, color = variable_clean),
            size = .8,
            alpha = .8,
            show.legend = T) +
  facet_wrap(~ factor(price_ratio, 
                      levels = c("PR = 10",
                                 "PR = 5",
                                 "PR = 2.5",
                                 "PR = 1",
                                 "PR = 0.75",
                                 "PR = 0.5",
                                 "PR = 0.25",
                                 "PR = 0.1")),
             nrow = 1) +
  scale_color_manual(values = c("#FF7F00", "#CAB2D6", "#6A3D9A")) +
  scale_x_continuous(breaks = seq(0, 200, 100)) +
  labs(x = "Time",
       y = "Profits",
       color = "") +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        strip.text = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 12),
        axis.title.y = element_text(color = "black", size = 12, vjust = 2),
        axis.text = element_text(color = "black", size = 10),
        legend.position = "bottom")
```

```{r, fig.height=15, fig.width=10, echo = FALSE}
equal_scales_EWS /
  dif_scales /
  equal_scales_CPE /
  equal_scales_pi +
  plot_annotation(tag_level = "A") 
```

Panel A shows the time series dynamics for the strong and weak stocks, and effort. Panel B shows the same data but without effort for better comparison. Panel C shows the CPUE and catch for the strong and weak stocks separately. Panel D shows the profits for the strong and weak stocks, and the total profits for the fishery through time.

**Negative equilibrium points for the weak stock only occur at high enough prices of the strong stock. If the price ratio ($PR = P_s/P_w$) is smaller than 0.25, both stock have positive equilibrium points (at a growth rate ratio ($r_s/r_w$) of ~2).**

- I think this figure (or a better version of it) should also go in the paper, because it clearly shows how effort increases a lot when we consider two species, and how it drives both of them to extremely low levels for most of the scenarios, but not all. 


### Scenarios for a range of productivity ratios:

```{r scenario 1 productivity ratio 0.7, echo = FALSE}
# set up the parameter space
q_s <- 0.05
q_w <- 0.05
k_s <- 4
k_w <- 2
r_s1 <- 1
r_w1 <- 0.75
p_s <- 1
p_w <- 1
alpha <- 1
c <- 0.05

# Initial values for the variables
N_w <- k_w

N_s <- k_s

E <- 0.1
```

```{r, echo = FALSE}
tset <- seq(from = 0, to = 200, length.out = 1000)

N_w_simu1 <- NaN*tset; N_w_simu1[1] <- N_w

N_s_simu1 <- NaN*tset; N_s_simu1[1] <- N_s

#N_w_test_1 <- NaN*tset; N_w_test_1[1] <- N_w

#N_s_test_1 <- NaN*tset; N_s_test_1[1] <- N_s

E_simu1 <- NaN*tset; E_simu1[1] <- E

#E_test1 <- NaN*tset; E_test1[1] <- E

C_s_simu1 <- NaN*tset; C_s_simu1[1] <- 1

C_w_simu1 <- NaN*tset; C_w_simu1[1] <- 1

cpue_s_simu1 <- NaN*tset; cpue_s_simu1[1] <- 1

cpue_w_simu1 <- NaN*tset; cpue_w_simu1[1] <- 1

Pi_sum_simu1 <- NaN*tset; Pi_sum_simu1[1] <- 2

Pi_s_simu1 <- NaN*tset; Pi_s_simu1[1] <- 1

Pi_w_simu1 <- NaN*tset; Pi_w_simu1[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w1 <- N_w_simu1[i-1]
  N_s1 <- N_s_simu1[i-1]
  #N_wt1 <- N_w_test_1[i-1]
  #N_st1 <- N_s_test_1[i-1]
  E1 <- E_simu1[i-1]
  #E_t1 <- E_test1[i-1]
  C_s1 <- C_s_simu1[i-1]
  C_w1 <- C_w_simu1[i-1]
  cpue_s1 <- cpue_s_simu1[i-1]
  cpue_w1 <- cpue_w_simu1[i-1]
  pi1 <- Pi_sum_simu1[i-1]
  pi_s1 <- Pi_s_simu1[i-1]
  pi_w1 <- Pi_w_simu1[i-1]
    
  # Calculate change in variable size at each time step
  dN_s1 <- (N_s1 * (r_s1 * (1 - (N_s1/k_s)) - q_s * E1)) * dt
  dN_w1 <- (N_w1 * (r_w1 * (1 - (N_w1/k_w)) - q_w * E1)) * dt
  #dN_st1 <- (N_st1 * (r_s * (1 - (N_st1/k_s)) - q_s * E_t1)) * dt
  #dN_wt1 <- (N_wt1 * (r_w * (1 - (N_wt1/k_w)) - q_w * E_t1)) * dt
  dE1 <- (alpha * E1 * (p_s * q_s * N_s1 + p_w * q_w * N_w1 - c)) * dt
  #dE_test1 <- ((p_s1 * q_s1 * N_st1 + p_w1 * q_w1 * N_wt1) - c) * dt
  dC_s1 <- (q_s * N_s1 * E1) * dt
  dC_w1 <- (q_w * N_w1 * E1) * dt
  dcpue_s1 <- (C_s1 / E1) * dt
  dcpue_w1 <- (C_w1 / E1) * dt
  dPi_s1 <- (C_s1 * p_s - C_s1 * c) * dt
  dPi_w1 <- (C_w1 * p_w - C_w1 * c) * dt
  dPi1 <- (C_s1 * p_s + C_w1 * p_w - ((C_s1 + C_w1) * c)) * dt
  # calculate total variable size and store in holding vectors
  
  N_w_simu1[i] <- N_w1 + dN_w1
  N_s_simu1[i] <- N_s1 + dN_s1
  #N_w_test_1[i] <- N_wt1 + dN_wt1
  #N_s_test_1[i] <- N_st1 + dN_st1
  E_simu1[i] <- E1 + dE1
  #E_test1[i] <- E_t1 + dE_test1
  C_s_simu1[i] <- C_s1 + dC_s1
  C_w_simu1[i] <- C_w1 + dC_w1
  cpue_s_simu1[i] <- cpue_s1 + dcpue_s1
  cpue_w_simu1[i] <- cpue_w1 + dcpue_w1
  Pi_sum_simu1[i] <- pi1 + dPi1
  Pi_s_simu1[i] <- pi_s1 + dPi_s1
  Pi_w_simu1[i] <- pi_w1 + dPi_w1
  
}
  

```


```{r scenario 2 productivity ratio 0.88, echo = FALSE}
r_s2 <- 1
r_w2 <- 0.88
```

```{r, echo = FALSE}
#tset <- seq(from = 0, to = 500, length.out = 10000)

N_w_simu2 <- NaN*tset; N_w_simu2[1] <- N_w

N_s_simu2 <- NaN*tset; N_s_simu2[1] <- N_s

#N_w_test_2 <- NaN*tset; N_w_test_2[1] <- N_w

#N_s_test_2 <- NaN*tset; N_s_test_2[1] <- N_s

E_simu2 <- NaN*tset; E_simu2[1] <- E

#E_test2 <- NaN*tset; E_test2[1] <- E

C_s_simu2 <- NaN*tset; C_s_simu2[1] <- 1

C_w_simu2 <- NaN*tset; C_w_simu2[1] <- 1

cpue_s_simu2 <- NaN*tset; cpue_s_simu2[1] <- 1

cpue_w_simu2 <- NaN*tset; cpue_w_simu2[1] <- 1

Pi_sum_simu2 <- NaN*tset; Pi_sum_simu2[1] <- 2

Pi_s_simu2 <- NaN*tset; Pi_s_simu2[1] <- 1

Pi_w_simu2 <- NaN*tset; Pi_w_simu2[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w2 <- N_w_simu2[i-1]
  N_s2 <- N_s_simu2[i-1]
  #N_wt2 <- N_w_test_2[i-1]
  #N_st2 <- N_s_test_2[i-1]
  E2 <- E_simu2[i-1]
  #E_t2 <- E_test2[i-1]
  C_s2 <- C_s_simu2[i-1]
  C_w2 <- C_w_simu2[i-1]
  cpue_s2 <- cpue_s_simu2[i-1]
  cpue_w2 <- cpue_w_simu2[i-1]
  pi2 <- Pi_sum_simu2[i-1]
  pi_s2 <- Pi_s_simu2[i-1]
  pi_w2 <- Pi_w_simu2[i-1]

  # Calculate change in variable size at each time step
  dN_s2 <- (N_s2 * (r_s2 * (1 - (N_s2/k_s)) - q_s * E2)) * dt
  dN_w2 <- (N_w2 * (r_w2 * (1 - (N_w2/k_w)) - q_w * E2)) * dt
  #dN_st2 <- (N_st2 * (r_s2 * (1 - (N_st2/k_s2)) - q_s2 * E_t2)) * dt
  #dN_wt2 <- (N_wt2 * (r_w2 * (1 - (N_wt2/k_w2)) - q_w2 * E_t2)) * dt
  dE2 <- (alpha * E2 * (p_s * q_s * N_s2 + p_w * q_w * N_w2 - c)) * dt
  #dE_test2 <- ((p_s2 * q_s2 * N_st2 + p_w2 * q_w2 * N_wt2) - c) * dt
  dC_s2 <- (q_s * N_s2 * E2) * dt
  dC_w2 <- (q_w * N_w2 * E2) * dt
  dcpue_s2 <- (C_s2 / E2) * dt
  dcpue_w2 <- (C_w2 / E2) * dt
  dPi_s2 <- (C_s2 * p_s - C_s2 * c) * dt
  dPi_w2 <- (C_w2 * p_w - C_w2 * c) * dt
  dPi2 <- (C_s2 * p_s + C_w2 * p_w - ((C_s2 + C_w2) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu2[i] <- N_w2 + dN_w2
  N_s_simu2[i] <- N_s2 + dN_s2
  #N_w_test_2[i] <- N_wt2 + dN_wt2
  #N_s_test_2[i] <- N_st2 + dN_st2
  E_simu2[i] <- E2 + dE2
  #E_test2[i] <- E_t2 + dE_test2
  C_s_simu2[i] <- C_s2 + dC_s2
  C_w_simu2[i] <- C_w2 + dC_w2
  cpue_s_simu2[i] <- cpue_s2 + dcpue_s2
  cpue_w_simu2[i] <- cpue_w2 + dcpue_w2
  Pi_sum_simu2[i] <- pi2 + dPi2
  Pi_s_simu2[i] <- pi_s2 + dPi_s2
  Pi_w_simu2[i] <- pi_w2 + dPi_w2
}
```



```{r scenario 3 productivity ratio 0.9, echo = FALSE}
# set up the parameter space
r_s3 <- 1
r_w3 <- 0.9
```

```{r, echo = FALSE}
#tset <- seq(from = 0, to = 500, length.out = 10000)

N_w_simu3 <- NaN*tset; N_w_simu3[1] <- N_w

N_s_simu3 <- NaN*tset; N_s_simu3[1] <- N_s

#N_w_test_3 <- NaN*tset; N_w_test_3[1] <- N_w

#N_s_test_3 <- NaN*tset; N_s_test_3[1] <- N_s

E_simu3 <- NaN*tset; E_simu3[1] <- E

#E_test3 <- NaN*tset; E_test3[1] <- E

C_s_simu3 <- NaN*tset; C_s_simu3[1] <- 1

C_w_simu3 <- NaN*tset; C_w_simu3[1] <- 1

cpue_s_simu3 <- NaN*tset; cpue_s_simu3[1] <- 1

cpue_w_simu3 <- NaN*tset; cpue_w_simu3[1] <- 1

Pi_sum_simu3 <- NaN*tset; Pi_sum_simu3[1] <- 2

Pi_s_simu3 <- NaN*tset; Pi_s_simu3[1] <- 1

Pi_w_simu3 <- NaN*tset; Pi_w_simu3[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w3 <- N_w_simu3[i-1]
  N_s3 <- N_s_simu3[i-1]
  #N_wt3 <- N_w_test_3[i-1]
  #N_st3 <- N_s_test_3[i-1]
  E3 <- E_simu3[i-1]
  #E_t3 <- E_test3[i-1]
  C_s3 <- C_s_simu3[i-1]
  C_w3 <- C_w_simu3[i-1]
  cpue_s3 <- cpue_s_simu3[i-1]
  cpue_w3 <- cpue_w_simu3[i-1]
  pi3 <- Pi_sum_simu3[i-1]
  pi_s3 <- Pi_s_simu3[i-1]
  pi_w3 <- Pi_w_simu3[i-1]

  # Calculate change in variable size at each time step
  dN_s3 <- (N_s3 * (r_s2 * (1 - (N_s3/k_s)) - q_s * E3)) * dt
  dN_w3 <- (N_w3 * (r_w2 * (1 - (N_w3/k_w)) - q_w * E3)) * dt
  #dN_st3 <- (N_st3 * (r_s3 * (1 - (N_st3/k_s3)) - q_s3 * E_t3)) * dt
  #dN_wt3 <- (N_wt3 * (r_w3 * (1 - (N_wt3/k_w3)) - q_w3 * E_t3)) * dt
  dE3 <- (alpha * E3 * (p_s * q_s * N_s3 + p_w * q_w * N_w3 - c)) * dt
  #dE_test3 <- ((p_s3 * q_s3 * N_st3 + p_w3 * q_w3 * N_wt3) - c) * dt
  dC_s3 <- (q_s * N_s3 * E3) * dt
  dC_w3 <- (q_w * N_w3 * E3) * dt
  dcpue_s3 <- (C_s3 / E3) * dt
  dcpue_w3 <- (C_w3 / E3) * dt
  dPi_s3 <- (C_s3 * p_s - C_s3 * c) * dt
  dPi_w3 <- (C_w3 * p_w - C_w3 * c) * dt
  dPi3 <- (C_s3 * p_s + C_w3 * p_w - ((C_s3 + C_w3) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu3[i] <- N_w3 + dN_w3
  N_s_simu3[i] <- N_s3 + dN_s3
  #N_w_test_3[i] <- N_wt3 + dN_wt3
  #N_s_test_3[i] <- N_st3 + dN_st3
  E_simu3[i] <- E3 + dE3
  #E_test3[i] <- E_t3 + dE_test3
  C_s_simu3[i] <- C_s3 + dC_s3
  C_w_simu3[i] <- C_w3 + dC_w3
  cpue_s_simu3[i] <- cpue_s3 + dcpue_s3
  cpue_w_simu3[i] <- cpue_w3 + dcpue_w3
  Pi_sum_simu3[i] <- pi3 + dPi3
  Pi_s_simu3[i] <- pi_s3 + dPi_s3
  Pi_w_simu3[i] <- pi_w3 + dPi_w3

}
```


```{r scenario 4 productivity ratio 0.92, echo = FALSE}
# set up the parameter space
r_s4 <- 1
r_w4 <- 0.92
```

```{r, echo = FALSE}
#tset <- seq(from = 0, to = 500, length.out = 10000)

N_w_simu4 <- NaN*tset; N_w_simu4[1] <- N_w

N_s_simu4 <- NaN*tset; N_s_simu4[1] <- N_s

#N_w_test_4 <- NaN*tset; N_w_test_4[1] <- N_w

#N_s_test_4 <- NaN*tset; N_s_test_4[1] <- N_s

E_simu4 <- NaN*tset; E_simu4[1] <- E

#E_test4 <- NaN*tset; E_test4[1] <- E

C_s_simu4 <- NaN*tset; C_s_simu4[1] <- 1

C_w_simu4 <- NaN*tset; C_w_simu4[1] <- 1

cpue_s_simu4 <- NaN*tset; cpue_s_simu4[1] <- 1

cpue_w_simu4 <- NaN*tset; cpue_w_simu4[1] <- 1

Pi_sum_simu4 <- NaN*tset; Pi_sum_simu4[1] <- 2

Pi_s_simu4 <- NaN*tset; Pi_s_simu4[1] <- 1

Pi_w_simu4 <- NaN*tset; Pi_w_simu4[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w4 <- N_w_simu4[i-1]
  N_s4 <- N_s_simu4[i-1]
  #N_wt4 <- N_w_test_4[i-1]
  #N_st4 <- N_s_test_4[i-1]
  E4 <- E_simu4[i-1]
  #E_t4 <- E_test4[i-1]
  C_s4 <- C_s_simu4[i-1]
  C_w4 <- C_w_simu4[i-1]
  cpue_s4 <- cpue_s_simu4[i-1]
  cpue_w4 <- cpue_w_simu4[i-1]
  pi4 <- Pi_sum_simu4[i-1]
  pi_s4 <- Pi_s_simu4[i-1]
  pi_w4 <- Pi_w_simu4[i-1]

  # Calculate change in variable size at each time step
  dN_s4 <- (N_s4 * (r_s4 * (1 - (N_s4/k_s)) - q_s * E4)) * dt
  dN_w4 <- (N_w4 * (r_w4 * (1 - (N_w4/k_w)) - q_w * E4)) * dt
  #dN_st4 <- (N_st4 * (r_s4 * (1 - (N_st4/k_s4)) - q_s4 * E_t4)) * dt
  #dN_wt4 <- (N_wt4 * (r_w4 * (1 - (N_wt4/k_w4)) - q_w4 * E_t4)) * dt
  dE4 <- (alpha * E4 * (p_s * q_s * N_s4 + p_w * q_w * N_w4 - c)) * dt
  #dE_test4 <- ((p_s4 * q_s4 * N_st4 + p_w4 * q_w4 * N_wt4) - c) * dt
  dC_s4 <- (q_s * N_s4 * E4) * dt
  dC_w4 <- (q_w * N_w4 * E4) * dt
  dcpue_s4 <- (C_s4 / E4) * dt
  dcpue_w4 <- (C_w4 / E4) * dt
  dPi_s4 <- (C_s4 * p_s - C_s4 * c) * dt
  dPi_w4 <- (C_w4 * p_w - C_w4 * c) * dt
  dPi4 <- (C_s4 * p_s + C_w4 * p_w - ((C_s4 + C_w4) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu4[i] <- N_w4 + dN_w4
  N_s_simu4[i] <- N_s4 + dN_s4
  #N_w_test_4[i] <- N_wt4 + dN_wt4
  #N_s_test_4[i] <- N_st4 + dN_st4
  E_simu4[i] <- E4 + dE4
  #E_test4[i] <- E_t4 + dE_test4
  C_s_simu4[i] <- C_s4 + dC_s4
  C_w_simu4[i] <- C_w4 + dC_w4
  cpue_s_simu4[i] <- cpue_s4 + dcpue_s4
  cpue_w_simu4[i] <- cpue_w4 + dcpue_w4
  Pi_sum_simu4[i] <- pi4 + dPi4
  Pi_s_simu4[i] <- pi_s4 + dPi_s4
  Pi_w_simu4[i] <- pi_w4 + dPi_w4
  
}
```



```{r scenario 5 productivity ratio 1.1, echo = FALSE}
# set up the parameter space
r_s5 <- 1
r_w5 <- 0.95
```

```{r, echo = FALSE}
#tset <- seq(from = 0, to = 500, length.out = 10000)

N_w_simu5 <- NaN*tset; N_w_simu5[1] <- N_w

N_s_simu5 <- NaN*tset; N_s_simu5[1] <- N_s

#N_w_test_5 <- NaN*tset; N_w_test_5[1] <- N_w

#N_s_test_5 <- NaN*tset; N_s_test_5[1] <- N_s

E_simu5 <- NaN*tset; E_simu5[1] <- E

#E_test5 <- NaN*tset; E_test5[1] <- E

C_s_simu5 <- NaN*tset; C_s_simu5[1] <- 1

C_w_simu5 <- NaN*tset; C_w_simu5[1] <- 1

cpue_s_simu5 <- NaN*tset; cpue_s_simu5[1] <- 1

cpue_w_simu5 <- NaN*tset; cpue_w_simu5[1] <- 1

Pi_sum_simu5 <- NaN*tset; Pi_sum_simu5[1] <- 2

Pi_s_simu5 <- NaN*tset; Pi_s_simu5[1] <- 1

Pi_w_simu5 <- NaN*tset; Pi_w_simu5[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w5 <- N_w_simu5[i-1]
  N_s5 <- N_s_simu5[i-1]
  #N_wt5 <- N_w_test_5[i-1]
  #N_st5 <- N_s_test_5[i-1]
  E5 <- E_simu5[i-1]
  #E_t5 <- E_test5[i-1]
  C_s5 <- C_s_simu5[i-1]
  C_w5 <- C_w_simu5[i-1]
  cpue_s5 <- cpue_s_simu5[i-1]
  cpue_w5 <- cpue_w_simu5[i-1]
  pi5 <- Pi_sum_simu5[i-1]
  pi_s5 <- Pi_s_simu5[i-1]
  pi_w5 <- Pi_w_simu5[i-1]

  # Calculate change in variable size at each time step
  dN_s5 <- (N_s5 * (r_s5 * (1 - (N_s5/k_s)) - q_s * E5)) * dt
  dN_w5 <- (N_w5 * (r_w5 * (1 - (N_w5/k_w)) - q_w * E5)) * dt
  #dN_st5 <- (N_st5 * (r_s5 * (1 - (N_st5/k_s5)) - q_s5 * E_t5)) * dt
  #dN_wt5 <- (N_wt5 * (r_w5 * (1 - (N_wt5/k_w5)) - q_w5 * E_t5)) * dt
  dE5 <- (alpha * E5 * (p_s * q_s * N_s5 + p_w * q_w * N_w5 - c)) * dt
  #dE_test5 <- ((p_s5 * q_s5 * N_st5 + p_w5 * q_w5 * N_wt5) - c) * dt
  dC_s5 <- (q_s * N_s5 * E5) * dt
  dC_w5 <- (q_w * N_w5 * E5) * dt
  dcpue_s5 <- (C_s5 / E5) * dt
  dcpue_w5 <- (C_w5 / E5) * dt
  dPi_s5 <- (C_s5 * p_s - C_s5 * c) * dt
  dPi_w5 <- (C_w5 * p_w - C_w5 * c) * dt
  dPi5 <- (C_s5 * p_s + C_w5 * p_w - ((C_s5 + C_w5) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu5[i] <- N_w5 + dN_w5
  N_s_simu5[i] <- N_s5 + dN_s5
  #N_w_test_5[i] <- N_wt5 + dN_wt5
  #N_s_test_5[i] <- N_st5 + dN_st5
  E_simu5[i] <- E5 + dE5
  #E_test5[i] <- E_t5 + dE_test5
  C_s_simu5[i] <- C_s5 + dC_s5
  C_w_simu5[i] <- C_w5 + dC_w5
  cpue_s_simu5[i] <- cpue_s5 + dcpue_s5
  cpue_w_simu5[i] <- cpue_w5 + dcpue_w5
  Pi_sum_simu5[i] <- pi5 + dPi5
  Pi_s_simu5[i] <- pi_s5 + dPi_s5
  Pi_w_simu5[i] <- pi_w5 + dPi_w5  
}
```




```{r scenario 6 productivity ratio 1, echo = FALSE}
r_s6 <- 1
r_w6 <- 0.97
```

```{r, echo = FALSE}
#tset <- seq(from = 0, to = 500, length.out = 10000)

N_w_simu6 <- NaN*tset; N_w_simu6[1] <- N_w

N_s_simu6 <- NaN*tset; N_s_simu6[1] <- N_s

#N_w_test_6 <- NaN*tset; N_w_test_6[1] <- N_w

#N_s_test_6 <- NaN*tset; N_s_test_6[1] <- N_s

E_simu6 <- NaN*tset; E_simu6[1] <- E

#E_test6 <- NaN*tset; E_test6[1] <- E

C_s_simu6 <- NaN*tset; C_s_simu6[1] <- 1

C_w_simu6 <- NaN*tset; C_w_simu6[1] <- 1

cpue_s_simu6 <- NaN*tset; cpue_s_simu6[1] <- 1

cpue_w_simu6 <- NaN*tset; cpue_w_simu6[1] <- 1

Pi_sum_simu6 <- NaN*tset; Pi_sum_simu6[1] <- 2

Pi_s_simu6 <- NaN*tset; Pi_s_simu6[1] <- 1

Pi_w_simu6 <- NaN*tset; Pi_w_simu6[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w6 <- N_w_simu6[i-1]
  N_s6 <- N_s_simu6[i-1]
  #N_wt6 <- N_w_test_6[i-1]
  #N_st6 <- N_s_test_6[i-1]
  E6 <- E_simu6[i-1]
  #E_t6 <- E_test6[i-1]
  C_s6 <- C_s_simu6[i-1]
  C_w6 <- C_w_simu6[i-1]
  cpue_s6 <- cpue_s_simu6[i-1]
  cpue_w6 <- cpue_w_simu6[i-1]
  pi6 <- Pi_sum_simu6[i-1]
  pi_s6 <- Pi_s_simu6[i-1]
  pi_w6 <- Pi_w_simu6[i-1]

  # Calculate change in variable size at each time step
  dN_s6 <- (N_s6 * (r_s6 * (1 - (N_s6/k_s)) - q_s * E6)) * dt
  dN_w6 <- (N_w6 * (r_w6 * (1 - (N_w6/k_w)) - q_w * E6)) * dt
  #dN_st6 <- (N_st6 * (r_s6 * (1 - (N_st6/k_s6)) - q_s6 * E_t6)) * dt
  #dN_wt6 <- (N_wt6 * (r_w6 * (1 - (N_wt6/k_w6)) - q_w6 * E_t6)) * dt
  dE6 <- (alpha * E6 * (p_s * q_s * N_s6 + p_w * q_w * N_w6 - c)) * dt
  #dE_test6 <- ((p_s6 * q_s6 * N_st6 + p_w6 * q_w6 * N_wt6) - c) * dt
  dC_s6 <- (q_s * N_s6 * E6) * dt
  dC_w6 <- (q_w * N_w6 * E6) * dt
  dcpue_s6 <- (C_s6 / E6) * dt
  dcpue_w6 <- (C_w6 / E6) * dt
  dPi_s6 <- (C_s6 * p_s - C_s6 * c) * dt
  dPi_w6 <- (C_w6 * p_w - C_w6 * c) * dt
  dPi6 <- (C_s6 * p_s + C_w6 * p_w - ((C_s6 + C_w6) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  N_w_simu6[i] <- N_w6 + dN_w6
  N_s_simu6[i] <- N_s6 + dN_s6
  #N_w_test_6[i] <- N_wt6 + dN_wt6
  #N_s_test_6[i] <- N_st6 + dN_st6
  E_simu6[i] <- E6 + dE6
  #E_test6[i] <- E_t6 + dE_test6
  C_s_simu6[i] <- C_s6 + dC_s6
  C_w_simu6[i] <- C_w6 + dC_w6
  cpue_s_simu6[i] <- cpue_s6 + dcpue_s6
  cpue_w_simu6[i] <- cpue_w6 + dcpue_w6
  Pi_sum_simu6[i] <- pi6 + dPi6
  Pi_s_simu6[i] <- pi_s6 + dPi_s6
  Pi_w_simu6[i] <- pi_w6 + dPi_w6  
  
}
```

```{r, echo = FALSE}
run_model <- function(r_s, k_s, q_s, p_s, r_w, k_w, q_w, p_w, c){
 
  # Derive effort
 E <- ((- c + k_s * p_s * q_s + k_w * p_w * q_w) * r_s * r_w)  /
   (k_w * p_w * q_w^2 * r_s + k_s * p_s * q_s^2 * r_w) 
  
  # Derive weak stock biomass
 
  N_w <- (k_w * (c * q_w * r_s + k_s * p_s * q_s * (- q_w * r_s + q_s * r_w))) / 
    (k_w * p_w * q_w^2 * r_s + k_s * p_s * q_s^2 * r_w)
  
 # Derive strong stock biomass
 
   N_s <- (k_s * (c * q_s * r_w + k_w * p_w * q_w * (q_w * r_s - q_s * r_w))) /
     (k_w * p_w * q_w^2 * r_s + k_s * p_s * q_s^2 * r_w)
  
  # Build output
  output <- data.frame(E = E, N_s = N_s, N_w = N_w)
 
  # Return
  return(output)
 
 
}

sc_r_1 <- run_model(q_s = 0.05, q_w = 0.05, k_s = 4, k_w = 2, r_s = 1, r_w = 0.75, p_s = 1, p_w = 1, c = 0.05)
sc_r_2 <- run_model(q_s = 0.05, q_w = 0.05, k_s = 4, k_w = 2, r_s = 1, r_w = 0.88, p_s = 1, p_w = 1, c = 0.05)
sc_r_3 <- run_model(q_s = 0.05, q_w = 0.05, k_s = 4, k_w = 2, r_s = 1, r_w = 0.9, p_s = 1, p_w = 1, c = 0.05)
sc_r_4 <- run_model(q_s = 0.05, q_w = 0.05, k_s = 4, k_w = 2, r_s = 1, r_w = 0.92, p_s = 1, p_w = 1, c = 0.05)
sc_r_5 <- run_model(q_s = 0.05, q_w = 0.05, k_s = 4, k_w = 2, r_s = 1, r_w = 0.95, p_s = 1, p_w = 1, c = 0.05)
sc_r_6 <- run_model(q_s = 0.05, q_w = 0.05, k_s = 4, k_w = 2, r_s = 1, r_w = 0.97, p_s = 1, p_w = 1, c = 0.05)

sc_r_all <- bind_rows(sc_r_1, sc_r_2, sc_r_3, sc_r_4, sc_r_5, sc_r_6) %>% 
  rownames_to_column() %>% 
  rename(scenario = rowname) %>% 
  mutate(tset = 200) %>% 
  pivot_longer(cols = E:N_w,
               names_to = "variable",
               values_to = "value") %>% 
  mutate(price_ratio = case_when(
    scenario == "1" ~ "Rw/Rs = 0.75",
    scenario == "2" ~ "Rw/Rs = 0.88",
    scenario == "3" ~ "Rw/Rs = 0.9",
    scenario == "4" ~ "Rw/Rs = 0.92",
    scenario == "5" ~ "Rw/Rs = 0.95",
    scenario == "6" ~ "Rw/Rs = 0.97"
  )) %>% 
  pivot_wider(names_from = "variable",
              values_from = "value") %>% 
  mutate(b_values_s = N_s / k_s,
         b_values_w = N_w / k_w) %>% 
  pivot_longer(cols = N_s:N_w,
               names_to = "variable",
               values_to = "value") %>%
  pivot_longer(cols = b_values_s:b_values_w,
               names_to = "b_values",
               values_to = "b_v_k") %>% 
  pivot_longer(cols = E,
               names_to = "effort",
               values_to = "ef_value") %>% 
  mutate(variable = case_when(
    variable == "N_s" ~ "Ns*",
    variable == "N_w" ~ "Nw*"
  )) %>% 
  mutate(effort = case_when(
    effort == "E" ~ "E*"
  )) %>% 
  mutate(b_values = case_when(
    str_detect(b_values, "_w") ~ "Nw/Kw*",
    str_detect(b_values, "_s") ~ "Ns/Ks*"
  ))
```

```{r building df for the growth rate parameter space, echo = FALSE}
eq_par <- data.frame(parameter = c("q_w", "q_s", "k_w", "k_s", "r_s", "r_w", "p_w", "p_s", "c"),
                     "Rw/Rs_0.75" = c(0.05, 0.05, 4, 2, 1, 0.75, 1, 1, 0.05),
                     "Rw/Rs_0.88" = c(0.05, 0.05, 4, 2, 1, 0.88, 1, 1, 0.05),
                     "Rw/Rs_0.90" = c(0.05, 0.05, 4, 2, 1, 0.9, 1, 1, 0.05),
                     "Rw/Rs_0.92" = c(0.05, 0.05, 4, 2, 1, 0.92, 1, 1, 0.05),
                     "Rw/Rs_0.95" = c(0.05, 0.05, 4, 2, 1, 0.95, 1, 1, 0.05),
                     "Rw/Rs_0.97" = c(0.05, 0.05, 4, 2, 1, 0.97, 1, 1, 0.05))

eq_par %>% 
  gt() %>%
  tab_header(title = "Parameter space for equilibrium points") %>% 
  cols_align(align = "center")
  
```


```{r, echo = FALSE}
effort_df <- cbind(E_simu1, E_simu2, E_simu3, E_simu4, E_simu5, E_simu6, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("E_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6")
         )

# effort_test_df <- cbind(E_test1, E_test2, E_test3, E_test4, E_test5, E_test6, E_test7, E_test8, tset) %>% 
#   as.data.frame() %>% 
#   pivot_longer(cols = starts_with("E_"),
#                names_to = "variable",
#                values_to = "value") %>% 
#   mutate(scenario_id = case_when(
#     str_detect(variable, "1") ~ "1",
#     str_detect(variable, "2") ~ "2",
#     str_detect(variable, "3") ~ "3",
#     str_detect(variable, "4") ~ "4",
#     str_detect(variable, "5") ~ "5",
#     str_detect(variable, "6") ~ "6",
#     str_detect(variable, "7") ~ "7",
#     str_detect(variable, "8") ~ "8")
#     )

nw_df <- cbind(N_w_simu1, N_w_simu2, N_w_simu3, N_w_simu4, N_w_simu5, N_w_simu6, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("N_w_simu"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6")) %>% 
  mutate(b_v_k = value/k_w)


ns_df <- cbind(N_s_simu1, N_s_simu2, N_s_simu3, N_s_simu4, N_s_simu5, N_s_simu6, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("N_s_simu"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6")) %>% 
  mutate(b_v_k = value/k_s)

# ns_t_df <- cbind(N_s_test_1, N_s_test_2, N_s_test_3, N_s_test_4, N_s_test_5, N_s_test_6, N_s_test_7, N_s_test_8, tset) %>% 
#   as.data.frame() %>% 
#   pivot_longer(cols = starts_with("N_s_test_"),
#                names_to = "variable",
#                values_to = "value") %>% 
#   mutate(scenario_id = case_when(
#     str_detect(variable, "1") ~ "1",
#     str_detect(variable, "2") ~ "2",
#     str_detect(variable, "3") ~ "3",
#     str_detect(variable, "4") ~ "4",
#     str_detect(variable, "5") ~ "5",
#     str_detect(variable, "6") ~ "6",
#     str_detect(variable, "7") ~ "7",
#     str_detect(variable, "8") ~ "8")) %>% 
#   mutate(b_v_k = value/4)
# 
# nw_t_df <- cbind(N_w_test_1, N_w_test_2, N_w_test_3, N_w_test_4, N_w_test_5, N_w_test_6, N_w_test_7, N_w_test_8, tset) %>% 
#   as.data.frame() %>% 
#   pivot_longer(cols = starts_with("N_w_test_"),
#                names_to = "variable",
#                values_to = "value") %>% 
#   mutate(scenario_id = case_when(
#     str_detect(variable, "1") ~ "1",
#     str_detect(variable, "2") ~ "2",
#     str_detect(variable, "3") ~ "3",
#     str_detect(variable, "4") ~ "4",
#     str_detect(variable, "5") ~ "5",
#     str_detect(variable, "6") ~ "6",
#     str_detect(variable, "7") ~ "7",
#     str_detect(variable, "8") ~ "8")) %>% 
#   mutate(b_v_k = value/2)

catch_s_df <- cbind(C_s_simu1, C_s_simu2, C_s_simu3, C_s_simu4, C_s_simu5, C_s_simu6, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("C_s_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6"))

catch_w_df <- cbind(C_w_simu1, C_w_simu2, C_w_simu3, C_w_simu4, C_w_simu5, C_w_simu6, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("C_w_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6"))


cpue_s_df <- cbind(cpue_s_simu1, cpue_s_simu2, cpue_s_simu3, cpue_s_simu4, cpue_s_simu5, cpue_s_simu6, 
                   tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("cpue_s_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6"))


cpue_w_df <- cbind(cpue_w_simu1, cpue_w_simu2, cpue_w_simu3, cpue_w_simu4, cpue_w_simu5, cpue_w_simu6, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("cpue_w_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6"))

profits_df <- cbind(Pi_sum_simu1, Pi_sum_simu2, Pi_sum_simu3, Pi_sum_simu4, Pi_sum_simu5, Pi_sum_simu6,tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("Pi_sum"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6"))

profits_s_df <- cbind(Pi_s_simu1, Pi_s_simu2, Pi_s_simu3, Pi_s_simu4, Pi_s_simu5, Pi_s_simu6,tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("Pi_s_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6"))

profits_w_df <- cbind(Pi_w_simu1, Pi_w_simu2, Pi_w_simu3, Pi_w_simu4, Pi_w_simu5, Pi_w_simu6, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("Pi_w_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6"))

# Gathered the results from each model scenario run into a single df

var_full_r <- bind_rows(effort_df, nw_df, ns_df, catch_s_df, catch_w_df, cpue_s_df, cpue_w_df, profits_df, profits_w_df, profits_s_df)

# Tidy dataset for plotting

var_plot_r <- var_full_r %>%
  mutate(price_ratio = case_when(
    str_detect(scenario_id, "1") ~ "Rw/Rs = 0.75",
    str_detect(scenario_id, "2") ~ "Rw/Rs = 0.88",
    str_detect(scenario_id, "3") ~ "Rw/Rs = 0.90",
    str_detect(scenario_id, "4") ~ "Rw/Rs = 0.92",
    str_detect(scenario_id, "5") ~ "Rw/Rs = 0.95",
    str_detect(scenario_id, "6") ~ "Rw/Rs = 0.97"
  )) %>% 
  mutate(variable_clean = case_when(
    str_detect(variable, "N_w") ~ "Weak stock",
    str_detect(variable, "N_s") ~ "Strong stock",
    str_detect(variable, "E_simu") ~ "Effort simulation",
    str_detect(variable, "Pi_sum_") ~ "Profit sum",
    str_detect(variable, "Pi_s") ~ "Strong stock profits",
    str_detect(variable, "Pi_w") ~ "Weak stock profits",
    str_detect(variable, "cpue_w") ~ "Weak stock CPUE",
    str_detect(variable, "cpue_s") ~ "Strong stock CPUE",
    str_detect(variable, "C_w") ~ "Weak stock catch",
    str_detect(variable, "C_s") ~ "Strong stock catch"
  ))
```

```{r, echo = FALSE, fig.height=4, fig.width=8}
equal_scales_EWS_r <-
  var_plot_r %>% 
  filter(variable_clean %in% c("Effort simulation", "Weak stock", "Strong stock")) %>% 
  ggplot() +
  geom_line(aes(x = tset, y = value, color = variable_clean),
            size = .8,
            alpha = .8,
            show.legend = T) +
  geom_point(data = sc_r_all, 
             aes(x = tset, y = value, color = variable)) +
  geom_point(data = sc_r_all,
             aes(x = tset, y = ef_value, color = effort)) +
  facet_wrap(~ factor(price_ratio, 
                      levels = c("Rw/Rs = 0.75",
                                 "Rw/Rs = 0.88",
                                 "Rw/Rs = 0.90",
                                 "Rw/Rs = 0.92",
                                 "Rw/Rs = 0.95",
                                 "Rw/Rs = 0.97")),
             nrow = 1) +
  scale_color_manual(values = c("#1B9E77", "#1B9E77", "#D95F02", "#7570B3",  "#D95F02", "#7570B3")) +
  scale_x_continuous(breaks = seq(0, 200, 50)) +
  labs(x = "",
       y = "Nw, Ns, E",
       color = "") +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        strip.text = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 12),
        axis.title.y = element_text(color = "black", size = 12, vjust = 2),
        axis.text = element_text(color = "black", size = 10),
        legend.position = "bottom")

# equal_scales_EWS_test <-
#   var_plot %>% 
#   filter(variable_clean %in% c("Effort test", "Weak stock test", "Strong stock test")) %>% 
#   ggplot() +
#   geom_line(aes(x = tset/100, y = value, color = variable_clean),
#             size = .8,
#             alpha = .8,
#             show.legend = T) +
#   geom_point(data = sc_all, 
#              aes(x = tset, y = value, color = variable)) +
#   geom_point(data = sc_all, 
#              aes(x = tset, y = ef_value, color = effort)) +
#   facet_wrap(~ factor(price_ratio, 
#                       levels = c("PR = 10",
#                                  "PR = 5",
#                                  "PR = 2.5",
#                                  "PR = 1",
#                                  "PR = 0.75",
#                                  "PR = 0.5",
#                                  "PR = 0.25",
#                                  "PR = 0.1")),
#              nrow = 1) +
#   scale_color_manual(values = c("#1B9E77", "#1B9E77", "#D95F02", "#7570B3",  "#D95F02", "#7570B3")) +
# #  scale_y_continuous(breaks = seq(0, 50, 10)) +
#   labs(x = "",
#        y = "Nw, Ns, E",
#        color = "") +
#   theme_bw() +
#   theme(panel.grid.major.x = element_blank(),
#         panel.grid.minor.x = element_blank(),
#         panel.grid.minor.y = element_blank(),
#         strip.background = element_rect(fill = "transparent"),
#         strip.text = element_text(color = "black", size = 11),
#         axis.title.x = element_text(color = "black", size = 12),
#         axis.title.y = element_text(color = "black", size = 12, vjust = 2),
#         axis.text = element_text(color = "black", size = 10),
#         legend.position = "bottom")

dif_scales_r <-
  var_plot_r %>% 
  filter(variable_clean %in% c("Strong stock", "Weak stock")) %>% 
  ggplot() +
  geom_line(aes(x = tset, y = b_v_k, color = variable_clean),
            size = .8,
            alpha = .8,
            show.legend = F) +
  geom_point(data = sc_r_all %>% filter(!variable == "E"), 
             aes(x = tset, y = b_v_k, color = b_values)) +
  facet_wrap(~ factor(price_ratio, 
                      levels = c("Rw/Rs = 0.75",
                                 "Rw/Rs = 0.88",
                                 "Rw/Rs = 0.90",
                                 "Rw/Rs = 0.92",
                                 "Rw/Rs = 0.95",
                                 "Rw/Rs = 0.97")),
             nrow = 1) +
  scale_color_manual(values = c("#D95F02", "#7570B3", "#D95F02", "#7570B3")) +
  scale_x_continuous(breaks = seq(0, 200, 50)) +
  labs(x = "",
       y = "N/K (Nw, Ns)",
       color = "") +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        strip.text = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 12, vjust = -2),
        axis.title.y = element_text(color = "black", size = 12, vjust = 2),
        axis.text = element_text(color = "black", size = 10),
        legend.position = "bottom")

equal_scales_CPE_r <-
  var_plot_r %>% 
  filter(variable_clean %in% c("Weak stock catch", "Strong stock catch", "Weak stock CPUE", "Strong stock CPUE")) %>% 
  ggplot() +
  geom_line(aes(x = tset, y = value, color = variable_clean),
            size = .8,
            alpha = .8,
            show.legend = T) +
  facet_wrap(~ factor(price_ratio, 
                      levels = c("Rw/Rs = 0.75",
                                 "Rw/Rs = 0.88",
                                 "Rw/Rs = 0.90",
                                 "Rw/Rs = 0.92",
                                 "Rw/Rs = 0.95",
                                 "Rw/Rs = 0.97")),
             nrow = 1) +
  scale_color_manual(values = c("#33A02C", "#FB9A99", "#E31A1C", "#FDBF6F")) +
  scale_x_continuous(breaks = seq(0, 200, 50)) +
  labs(x = "",
       y = "CPUE, Catch (S and W)",
       color = "") +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        strip.text = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 12),
        axis.title.y = element_text(color = "black", size = 12, vjust = 2),
        axis.text = element_text(color = "black", size = 10),
        legend.position = "bottom")

equal_scales_pi_r <-
  var_plot_r %>% 
  filter(variable_clean %in% c("Profit sum", "Weak stock profits", "Strong stock profits")) %>% 
  ggplot() +
  geom_line(aes(x = tset, y = value, color = variable_clean),
            size = .8,
            alpha = .8,
            show.legend = T) +
  facet_wrap(~ factor(price_ratio, 
                      levels = c("Rw/Rs = 0.75",
                                 "Rw/Rs = 0.88",
                                 "Rw/Rs = 0.90",
                                 "Rw/Rs = 0.92",
                                 "Rw/Rs = 0.95",
                                 "Rw/Rs = 0.97")),
             nrow = 1) +
  scale_color_manual(values = c("#FF7F00", "#CAB2D6", "#6A3D9A")) +
  scale_x_continuous(breaks = seq(0, 200, 50)) +
  labs(x = "Time (x100)",
       y = "Profits",
       color = "") +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        strip.text = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 12),
        axis.title.y = element_text(color = "black", size = 12, vjust = 2),
        axis.text = element_text(color = "black", size = 10),
        legend.position = "bottom")
```

```{r, fig.height=15, fig.width=10, echo = FALSE}
equal_scales_EWS_r /
  dif_scales_r /
  equal_scales_CPE_r /
  equal_scales_pi_r +
  plot_annotation(tag_level = "A") 
```

### Estimating equilibria for when prices vary as a function of catch

```{r scenario 1 catchability ratio 10, echo = FALSE}
# set up the parameter space
q_s <- 0.01
q_w <- 0.01
k_s <- 4
k_w <- 2
r_s <- 1
r_w <- 0.5
p_s <- 1
p_w <- 1
alpha <- 1
c <- 0.05
A_w <- 1
A_s <- 1
beta_w1 <- 0.6
beta_s1 <- 0.5
f_w1 <- 0.2
f_s1 <- 0.3

# Initial values for the variables
N_w <- k_w

N_s <- k_s

E <- 0.1
```

```{r, echo = FALSE}
tset <- seq(from = 0, to = 200, length.out = 1000)

N_w_simu1 <- NaN*tset; N_w_simu1[1] <- N_w

N_s_simu1 <- NaN*tset; N_s_simu1[1] <- N_s

E_simu1 <- NaN*tset; E_simu1[1] <- E

C_s_simu1 <- NaN*tset; C_s_simu1[1] <- 1

C_w_simu1 <- NaN*tset; C_w_simu1[1] <- 1

cpue_s_simu1 <- NaN*tset; cpue_s_simu1[1] <- 1

cpue_w_simu1 <- NaN*tset; cpue_w_simu1[1] <- 1

Pi_sum_simu1 <- NaN*tset; Pi_sum_simu1[1] <- 2

Pi_s_simu1 <- NaN*tset; Pi_s_simu1[1] <- 1

Pi_w_simu1 <- NaN*tset; Pi_w_simu1[1] <- 1
```

```{r, echo = FALSE}
for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w1 <- N_w_simu1[i-1]
  N_s1 <- N_s_simu1[i-1]
  E <- E_simu1[i-1]
  C_s1 <- C_s_simu1[i-1]
  C_w1 <- C_w_simu1[i-1]
  cpue_s1 <- cpue_s_simu1[i-1]
  cpue_w1 <- cpue_w_simu1[i-1]
  pi1 <- Pi_sum_simu1[i-1]
  pi_s1 <- Pi_s_simu1[i-1]
  pi_w1 <- Pi_w_simu1[i-1]

  # Calculate change in variable size at each time step
  dN_s1 <- (N_s1 * r_s * (1 - (N_s1/k_s)) - q_s * N_s1^beta_s1 * E) * dt
  dN_w1 <- (N_w1 * r_w * (1 - (N_w1/k_w)) - q_w * N_w1^beta_w1 * E) * dt
  dE <- (alpha * E * (A_s * (q_s * N_s1^beta_s1 * E)^-f_s1 * q_s * N_s1^beta_s1 + A_w * (q_w * N_w1^beta_w1 * E)^-f_w1 * q_w * N_w1^beta_w1) - c) * dt
  dC_s1 <- (q_s * N_s1 * E) * dt
  dC_w1 <- (q_w * N_w1 * E) * dt
  dcpue_s1 <- (C_s1 / E) * dt
  dcpue_w1 <- (C_w1 / E) * dt
  dPi_s1 <- (C_s1 * A_s * (q_s * N_s1^beta_s1 * E)^-f_s1 - C_s1 * c) * dt
  dPi_w1 <- (C_w1 * A_w * (q_w * N_w1^beta_w1 * E)^-f_w1 - C_w1 * c) * dt
  dPi1 <- (C_s1 * A_s * (q_s * N_s1^beta_s1 * E)^-f_s1 + C_w1 * A_w * (q_w * N_w1^beta_w1 * E)^-f_w1 - ((C_s1 + C_w1) * c)) * dt
  
  # calculate total variable size and store in holding vectors
  
  N_w_simu1[i] <- N_w1 + dN_w1
  N_s_simu1[i] <- N_s1 + dN_s1
  E_simu1[i] <- E + dE
  C_s_simu1[i] <- C_s1 + dC_s1
  C_w_simu1[i] <- C_w1 + dC_w1
  cpue_s_simu1[i] <- cpue_s1 + dcpue_s1
  cpue_w_simu1[i] <- cpue_w1 + dcpue_w1
  Pi_sum_simu1[i] <- pi1 + dPi1
  Pi_s_simu1[i] <- pi_s1 + dPi_s1
  Pi_w_simu1[i] <- pi_w1 + dPi_w1  
  
}

for(i in 2:length(tset)) {
  
  # change in time
  dt <- tset[i] - tset[i-1]
  
  # placeholder variables to plug into the equations
  N_w1 <- N_w_simu1[i-1]
  N_s1 <- N_s_simu1[i-1]
  #N_wt1 <- N_w_test_1[i-1]
  #N_st1 <- N_s_test_1[i-1]
  E1 <- E_simu1[i-1]
  #E_t1 <- E_test1[i-1]
  C_s1 <- C_s_simu1[i-1]
  C_w1 <- C_w_simu1[i-1]
  cpue_s1 <- cpue_s_simu1[i-1]
  cpue_w1 <- cpue_w_simu1[i-1]
  pi1 <- Pi_sum_simu1[i-1]
  pi_s1 <- Pi_s_simu1[i-1]
  pi_w1 <- Pi_w_simu1[i-1]
    
  # Calculate change in variable size at each time step
  dN_s1 <- (N_s1 * (r_s1 * (1 - (N_s1/k_s)) - q_s * E1)) * dt
  dN_w1 <- (N_w1 * (r_w1 * (1 - (N_w1/k_w)) - q_w * E1)) * dt
  #dN_st1 <- (N_st1 * (r_s * (1 - (N_st1/k_s)) - q_s * E_t1)) * dt
  #dN_wt1 <- (N_wt1 * (r_w * (1 - (N_wt1/k_w)) - q_w * E_t1)) * dt
  dE1 <- (alpha * E1 * (p_s * q_s * N_s1 + p_w * q_w * N_w1 - c)) * dt
  #dE_test1 <- ((p_s1 * q_s1 * N_st1 + p_w1 * q_w1 * N_wt1) - c) * dt
  dC_s1 <- (q_s * N_s1 * E1) * dt
  dC_w1 <- (q_w * N_w1 * E1) * dt
  dcpue_s1 <- (C_s1 / E1) * dt
  dcpue_w1 <- (C_w1 / E1) * dt
  dPi_s1 <- (C_s1 * p_s - C_s1 * c) * dt
  dPi_w1 <- (C_w1 * p_w - C_w1 * c) * dt
  dPi1 <- (C_s1 * p_s + C_w1 * p_w - ((C_s1 + C_w1) * c)) * dt
  # calculate total variable size and store in holding vectors
  
  N_w_simu1[i] <- N_w1 + dN_w1
  N_s_simu1[i] <- N_s1 + dN_s1
  #N_w_test_1[i] <- N_wt1 + dN_wt1
  #N_s_test_1[i] <- N_st1 + dN_st1
  E_simu1[i] <- E1 + dE1
  #E_test1[i] <- E_t1 + dE_test1
  C_s_simu1[i] <- C_s1 + dC_s1
  C_w_simu1[i] <- C_w1 + dC_w1
  cpue_s_simu1[i] <- cpue_s1 + dcpue_s1
  cpue_w_simu1[i] <- cpue_w1 + dcpue_w1
  Pi_sum_simu1[i] <- pi1 + dPi1
  Pi_s_simu1[i] <- pi_s1 + dPi_s1
  Pi_w_simu1[i] <- pi_w1 + dPi_w1
  
}

```


```{r, echo = FALSE}
effort_df <- cbind(E_simu1, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("E_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6")
         )
#, E_simu2, E_simu3, E_simu4, E_simu5, E_simu6,
# effort_test_df <- cbind(E_test1, E_test2, E_test3, E_test4, E_test5, E_test6, E_test7, E_test8, tset) %>% 
#   as.data.frame() %>% 
#   pivot_longer(cols = starts_with("E_"),
#                names_to = "variable",
#                values_to = "value") %>% 
#   mutate(scenario_id = case_when(
#     str_detect(variable, "1") ~ "1",
#     str_detect(variable, "2") ~ "2",
#     str_detect(variable, "3") ~ "3",
#     str_detect(variable, "4") ~ "4",
#     str_detect(variable, "5") ~ "5",
#     str_detect(variable, "6") ~ "6",
#     str_detect(variable, "7") ~ "7",
#     str_detect(variable, "8") ~ "8")
#     )

nw_df <- cbind(N_w_simu1, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("N_w_simu"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6")) %>% 
  mutate(b_v_k = value/k_w)
#N_w_simu2, N_w_simu3, N_w_simu4, N_w_simu5, N_w_simu6, 

ns_df <- cbind(N_s_simu1,tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("N_s_simu"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6")) %>% 
  mutate(b_v_k = value/k_s)
# N_s_simu2, N_s_simu3, N_s_simu4, N_s_simu5, N_s_simu6, 
# ns_t_df <- cbind(N_s_test_1, N_s_test_2, N_s_test_3, N_s_test_4, N_s_test_5, N_s_test_6, N_s_test_7, N_s_test_8, tset) %>% 
#   as.data.frame() %>% 
#   pivot_longer(cols = starts_with("N_s_test_"),
#                names_to = "variable",
#                values_to = "value") %>% 
#   mutate(scenario_id = case_when(
#     str_detect(variable, "1") ~ "1",
#     str_detect(variable, "2") ~ "2",
#     str_detect(variable, "3") ~ "3",
#     str_detect(variable, "4") ~ "4",
#     str_detect(variable, "5") ~ "5",
#     str_detect(variable, "6") ~ "6",
#     str_detect(variable, "7") ~ "7",
#     str_detect(variable, "8") ~ "8")) %>% 
#   mutate(b_v_k = value/4)
# 
# nw_t_df <- cbind(N_w_test_1, N_w_test_2, N_w_test_3, N_w_test_4, N_w_test_5, N_w_test_6, N_w_test_7, N_w_test_8, tset) %>% 
#   as.data.frame() %>% 
#   pivot_longer(cols = starts_with("N_w_test_"),
#                names_to = "variable",
#                values_to = "value") %>% 
#   mutate(scenario_id = case_when(
#     str_detect(variable, "1") ~ "1",
#     str_detect(variable, "2") ~ "2",
#     str_detect(variable, "3") ~ "3",
#     str_detect(variable, "4") ~ "4",
#     str_detect(variable, "5") ~ "5",
#     str_detect(variable, "6") ~ "6",
#     str_detect(variable, "7") ~ "7",
#     str_detect(variable, "8") ~ "8")) %>% 
#   mutate(b_v_k = value/2)

catch_s_df <- cbind(C_s_simu1,tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("C_s_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6"))
#  C_s_simu2, C_s_simu3, C_s_simu4, C_s_simu5, C_s_simu6, 
catch_w_df <- cbind(C_w_simu1,tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("C_w_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6"))
# C_w_simu2, C_w_simu3, C_w_simu4, C_w_simu5, C_w_simu6, 

cpue_s_df <- cbind(cpue_s_simu1,  tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("cpue_s_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6"))

#cpue_s_simu2, cpue_s_simu3, cpue_s_simu4, cpue_s_simu5, cpue_s_simu6,

cpue_w_df <- cbind(cpue_w_simu1,  tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("cpue_w_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6"))
#cpue_w_simu2, cpue_w_simu3, cpue_w_simu4, cpue_w_simu5, cpue_w_simu6,
profits_df <- cbind(Pi_sum_simu1,tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("Pi_sum"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6"))
# Pi_sum_simu2, Pi_sum_simu3, Pi_sum_simu4, Pi_sum_simu5, Pi_sum_simu6,

profits_s_df <- cbind(Pi_s_simu1, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("Pi_s_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6"))

#Pi_s_simu2, Pi_s_simu3, Pi_s_simu4, Pi_s_simu5, Pi_s_simu6,

profits_w_df <- cbind(Pi_w_simu1, tset) %>% 
  as.data.frame() %>% 
  pivot_longer(cols = starts_with("Pi_w_"),
               names_to = "variable",
               values_to = "value") %>% 
  mutate(scenario_id = case_when(
    str_detect(variable, "1") ~ "1",
    str_detect(variable, "2") ~ "2",
    str_detect(variable, "3") ~ "3",
    str_detect(variable, "4") ~ "4",
    str_detect(variable, "5") ~ "5",
    str_detect(variable, "6") ~ "6"))
# Pi_w_simu2, Pi_w_simu3, Pi_w_simu4, Pi_w_simu5, Pi_w_simu6,
# Gathered the results from each model scenario run into a single df

var_full_price <- bind_rows(effort_df, nw_df, ns_df, catch_s_df, catch_w_df, cpue_s_df, cpue_w_df, profits_df, profits_w_df, profits_s_df)

# Tidy dataset for plotting

var_plot_price <- var_full_price %>%
  # mutate(price_ratio = case_when(
  #   str_detect(scenario_id, "1") ~ "Rw/Rs = 0.75",
  #   str_detect(scenario_id, "2") ~ "Rw/Rs = 0.88",
  #   str_detect(scenario_id, "3") ~ "Rw/Rs = 0.90",
  #   str_detect(scenario_id, "4") ~ "Rw/Rs = 0.92",
  #   str_detect(scenario_id, "5") ~ "Rw/Rs = 0.95",
  #   str_detect(scenario_id, "6") ~ "Rw/Rs = 0.97"
  # )) %>% 
  mutate(variable_clean = case_when(
    str_detect(variable, "N_w") ~ "Weak stock",
    str_detect(variable, "N_s") ~ "Strong stock",
    str_detect(variable, "E_simu") ~ "Effort simulation",
    str_detect(variable, "Pi_sum_") ~ "Profit sum",
    str_detect(variable, "Pi_s") ~ "Strong stock profits",
    str_detect(variable, "Pi_w") ~ "Weak stock profits",
    str_detect(variable, "cpue_w") ~ "Weak stock CPUE",
    str_detect(variable, "cpue_s") ~ "Strong stock CPUE",
    str_detect(variable, "C_w") ~ "Weak stock catch",
    str_detect(variable, "C_s") ~ "Strong stock catch"
  ))

```


```{r, echo = FALSE}
#equal_scales_EWS_r <-
  var_plot_price %>% 
  filter(variable_clean %in% c("Effort simulation", "Weak stock", "Strong stock")) %>% 
  ggplot() +
  geom_line(aes(x = tset, y = value, color = variable_clean),
            size = .8,
            alpha = .8,
            show.legend = T) +
  # geom_point(data = sc_r_all, 
  #            aes(x = tset, y = value, color = variable)) +
  # geom_point(data = sc_r_all,
  #            aes(x = tset, y = ef_value, color = effort)) +
  # facet_wrap(~ factor(price_ratio, 
  #                     levels = c("Rw/Rs = 0.75",
  #                                "Rw/Rs = 0.88",
  #                                "Rw/Rs = 0.90",
  #                                "Rw/Rs = 0.92",
  #                                "Rw/Rs = 0.95",
  #                                "Rw/Rs = 0.97")),
  #            nrow = 1) +
  scale_color_manual(values = c("#1B9E77", "black", "#D95F02")) +
  #scale_x_continuous(breaks = seq(0, 200, 50)) +
  labs(x = "",
       y = "Nw, Ns, E",
       color = "") +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        strip.background = element_rect(fill = "transparent"),
        strip.text = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 12),
        axis.title.y = element_text(color = "black", size = 12, vjust = 2),
        axis.text = element_text(color = "black", size = 10),
        legend.position = "bottom")
```







